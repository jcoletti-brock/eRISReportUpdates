[{"item":"{\n  \"name\" : \"Data Gap Rule\",\n  \"description\" : \"\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"48f81568-5a96-4853-b4da-646197e10eaa\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.LBMIL001RF01QVA.F_CV:raw:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.LBMIL001RF01QVA.F_CV\\\",\\\"mode\\\":\\\"raw\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Flag Data Gaps based on bad quality\\r\\nfor(Data myTag : __source__.array){\\r\\n    if(myTag.quality != 100){\\r\\n        myTag.addFlag(\\\"Gap\\\");\\r\\n    }\\r\\n}\",\n    \"version\" : 1,\n    \"start\" : \"2020-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"48f81568-5a96-4853-b4da-646197e10eaa\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"1970-01-01T00:00:01.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"dependant\":[],\"id\":\"42e5b795-bc99-44e2-befe-9c96e911d050\",\"source\":\"Data Gap Rule\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"bd669345-8e89-4f36-9aca-8708e7838f1c\",\n  \"description\" : \"Reservoir Difference - no specific station\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"bd669345-8e89-4f36-9aca-8708e7838f1c\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"ET.ReservoirVolTotal:average:P1D\",\n    \"name\" : \"inResDifference\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.ResLevelDifference2\",\n    \"name\" : \"outResLevelDiff2\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"BigDecimal levelDiff = 0;\\r\\nBigDecimal lastLevel = null;\\r\\n//Loop over all data points of Reservoir Level\\r\\nfor (Data level: inResDifference.array){\\r\\n    if (null !=level.value && 100 == level.quality){\\r\\n        //Check last level for value\\r\\n        if (null !=lastLevel){\\r\\n            //Calculate level difference\\r\\n            levelDiff = level.value - lastLevel;\\r\\n            outResLevelDiff1.add(new Data(level.time, levelDiff, level.quality));\\r\\n        }\\r\\n        //Save current value as last level\\r\\n        lastLevel = level.value;\\r\\n    }\\r\\n}\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2017-05-19T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : false\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"bd669345-8e89-4f36-9aca-8708e7838f1c\",\n  \"owner\" : \"ralbasel@regionofwaterloo.ca\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2017-01-01T13:22:24.000\",\n  \"enabled\" : false,\n  \"type\" : \"DIRECT\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.ResLevelDifference2\",\"name\":\"outResLevelDiff2\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Average Flow Rate Midnight to 4 am\",\n  \"description\" : \"Provides workaround for Daylight Saving Time changeovers\",\n  \"schedule\" : \"0 5 * * *\",\n  \"lastRunMessage\" : \"0b01431a-733f-48d8-acea-e63c1ea4b0ae\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"ET.MDPH.MDPSCDA.ATPT_NET_FLOW:average:PT4H\",\n    \"name\" : \"ayrNetFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.BMSTWL1FIQ01.F_CV:average:PT4H\",\n    \"name\" : \"branchtonFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.BMSTWL01FI01QVA.F_CV:average:PT4H\",\n    \"name\" : \"BranchtonFlow_WATH\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"SJPH.LINOIT1.LINTWL1FIQ01:average:PT4H\",\n    \"name\" : \"linwoodFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.LINTWL01FI01QVA.F_CV:average:PT4H\",\n    \"name\" : \"linwoodFlow_WATH\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.LBMIL01FIQ01.F_CV:average:PT4H\",\n    \"name\" : \"lloydBrownFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.LBMIL001FI01QVA.F_CV:average:PT4H\",\n    \"name\" : \"LloydBrownFlow_WATH\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.WMHTWL1FIQ01.F_CV:average:PT4H\",\n    \"name\" : \"westMontroseFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.WMHTWL01FI01QVA.F_CV:average:PT4H\",\n    \"name\" : \"WMFlow_WATH\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.WMHTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"average\\\",\\\"interval\\\":\\\"PT4H\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MDPH.MDPSCDA.ATPT_NET_FLOW_00_04\",\n    \"name\" : \"ayrNetOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"Ayr Net Average Flow Midnight to 4 am\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.KWCRH.KWCR_BMSTWL1FIQ01.F_CV_00_04\",\n    \"name\" : \"branchtonOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"Branchton Discharge Average Flow Midnight to 4 am\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MDPH.MDPSCDA.BMSTWL1FIQ01.F_CV_00_04\",\n    \"name\" : \"branchtonOut_New\",\n    \"type\" : \"tag\",\n    \"description\" : \"Branchton Discharge Average Flow 12 am to 4 am (L/s)\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.SJPH.LINOIT1.LINTWL1FIQ01_00_04\",\n    \"name\" : \"linwoodOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"Linwood Discharge Average Flow Rate Midnight to 4 am\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.WATH.MTPSVR2.LINTWL1FIQ01_00_04\",\n    \"name\" : \"linwoodOut_WATH\",\n    \"type\" : \"tag\",\n    \"description\" : \"Linwood Discharge Flow - 12AM to 4AM\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.KWCRH.KWCR_LBMIL01FIQ01.F_CV_00_04\",\n    \"name\" : \"lloydBrownOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"Lloyd Brown Average Flow Midnight to 4 am\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MDPH.MDPSCDA.LBMIL01FIQ01.F_CV_00_04\",\n    \"name\" : \"lloydBrownOut_New\",\n    \"type\" : \"tag\",\n    \"description\" : \"Lloyd Brown Average Flow 12 am to 4 am (L/s)\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MTPH.MTPSCDA.WMHTWL1FIQ01.F_CV_00_04\",\n    \"name\" : \"westMontroseOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"West Montrose Average Flow Midnight to 4 am\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"if(branchtonFlow.value!=null){\\r\\n    branchtonOut_New.value=branchtonFlow.value;\\r\\n}\\r\\nif(linwoodFlow.value!=null){\\r\\n    linwoodOut.value= linwoodFlow.value;\\r\\n}\\r\\nif(lloydBrownFlow.value!=null){\\r\\n    lloydBrownOut_New.value=lloydBrownFlow.value;\\r\\n}\\r\\nif(westMontroseFlow.value!=null){\\r\\n    westMontroseOut.value=westMontroseFlow.value;\\r\\n}\\r\\nif(ayrNetFlow.value!=null){\\r\\n    ayrNetOut.value=ayrNetFlow.value;\\r\\n}\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2016-01-01T00:00:00.000\",\n    \"end\" : \"2020-09-09T00:00:00.000\",\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : false\n  }, {\n    \"value\" : \"if(BranchtonFlow_WATH.value!=null){\\r\\n    branchtonOut_New.value=BranchtonFlow_WATH.value;\\r\\n}\\r\\nif(linwoodFlow_WATH.value!=null){\\r\\n    linwoodOut_WATH.value= linwoodFlow_WATH.value;\\r\\n}\\r\\nif(LloydBrownFlow_WATH.value!=null){\\r\\n    lloydBrownOut_New.value=LloydBrownFlow_WATH.value;\\r\\n}\\r\\nif(westMontroseFlow.value!=null){\\r\\n    westMontroseOut.value=westMontroseFlow.value;\\r\\n}\\r\\nif(ayrNetFlow.value!=null){\\r\\n    ayrNetOut.value=ayrNetFlow.value;\\r\\n}\\r\\n\",\n    \"version\" : 2,\n    \"start\" : \"2018-09-28T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : false\n  }, {\n    \"value\" : \"if(BranchtonFlow_WATH.value!=null){\\r\\n    branchtonOut_New.value=BranchtonFlow_WATH.value;\\r\\n}\\r\\nif(linwoodFlow_WATH.value!=null){\\r\\n    linwoodOut_WATH.value= linwoodFlow_WATH.value;\\r\\n}\\r\\nif(LloydBrownFlow_WATH.value!=null){\\r\\n    lloydBrownOut_New.value=LloydBrownFlow_WATH.value;\\r\\n}\\r\\nif(WMFlow_WATH.value!=null){\\r\\n    westMontroseOut.value=WMFlow_WATH.value;\\r\\n}\\r\\nif(ayrNetFlow.value!=null){\\r\\n    ayrNetOut.value=ayrNetFlow.value;\\r\\n}\\r\\n\",\n    \"version\" : 3,\n    \"start\" : \"2020-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",linwoodFlow,ayrNetFlow,LloydBrownFlow_WATH,westMontroseFlow,WMFlow_WATH,branchtonFlow,linwoodFlow_WATH,__results__,BranchtonFlow_WATH,lloydBrownFlow\",\n    \"outputs\" : \",westMontroseOut,ayrNetOut,branchtonOut_New,lloydBrownOut_New,linwoodOut_WATH\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"0b01431a-733f-48d8-acea-e63c1ea4b0ae\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MDPH.MDPSCDA.ATPT_NET_FLOW_00_04\",\"name\":\"ayrNetOut\",\"type\":\"tag\",\"description\":\"Ayr Net Average Flow Midnight to 4 am\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.KWCRH.KWCR_BMSTWL1FIQ01.F_CV_00_04\",\"name\":\"branchtonOut\",\"type\":\"tag\",\"description\":\"Branchton Discharge Average Flow Midnight to 4 am\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPH.MDPSCDA.BMSTWL1FIQ01.F_CV_00_04\",\"name\":\"branchtonOut_New\",\"type\":\"tag\",\"description\":\"Branchton Discharge Average Flow 12 am to 4 am (L/s)\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.SJPH.LINOIT1.LINTWL1FIQ01_00_04\",\"name\":\"linwoodOut\",\"type\":\"tag\",\"description\":\"Linwood Discharge Average Flow Rate Midnight to 4 am\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.WATH.MTPSVR2.LINTWL1FIQ01_00_04\",\"name\":\"linwoodOut_WATH\",\"type\":\"tag\",\"description\":\"Linwood Discharge Flow - 12AM to 4AM\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.KWCRH.KWCR_LBMIL01FIQ01.F_CV_00_04\",\"name\":\"lloydBrownOut\",\"type\":\"tag\",\"description\":\"Lloyd Brown Average Flow Midnight to 4 am\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPH.MDPSCDA.LBMIL01FIQ01.F_CV_00_04\",\"name\":\"lloydBrownOut_New\",\"type\":\"tag\",\"description\":\"Lloyd Brown Average Flow 12 am to 4 am (L/s)\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MTPH.MTPSCDA.WMHTWL1FIQ01.F_CV_00_04\",\"name\":\"westMontroseOut\",\"type\":\"tag\",\"description\":\"West Montrose Average Flow Midnight to 4 am\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Average Flow Rate 6 am to 8 pm\",\n  \"description\" : \"Stores average instataneous flow rates during peak hours\",\n  \"schedule\" : \"15 4 * * *\",\n  \"lastRunMessage\" : \"16d2e71d-4b13-4fac-b3fc-538ee7d81366\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"ET.MDPH.MDPSCDA.ATPT_NET_FLOW:average:PT14H\",\n    \"name\" : \"ayrNetFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D,+PT6H\",\n    \"duration\" : \"PT14H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.BMSTWL01FI01QVA.F_CV:average:PT14H\",\n    \"name\" : \"branchtonFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D,+PT6H\",\n    \"duration\" : \"PT14H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"SJPH.LINOIT1.LINTWL1FIQ01:average:PT14H\",\n    \"name\" : \"linwoodFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D,+PT6H\",\n    \"duration\" : \"PT14H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.LBMIL01FIQ01.F_CV:average:PT14H\",\n    \"name\" : \"lloydBrownFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D,+PT6H\",\n    \"duration\" : \"PT14H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.WMHTWL1FIQ01.F_CV:average:PT14H\",\n    \"name\" : \"westMontroseFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D,+PT6H\",\n    \"duration\" : \"PT14H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MDPH.MDPSCDA.ATPT_NET_FLOW_6_20\",\n    \"name\" : \"ayrNetOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.KWCRH.KWCR_BMSTWL1FIQ01.F_CV_6_20\",\n    \"name\" : \"branchtonOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MDPH.MDPSCDA.BMSTWL1FIQ01.F_CV_6_20\",\n    \"name\" : \"branchtonOut_New\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.SJPH.LINOIT1.LINTWL1FIQ01_06_20\",\n    \"name\" : \"linwoodOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.KWCRH.KWCR_LBMIL01FIQ01.F_CV_6_20\",\n    \"name\" : \"lloydBrownOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MDPH.MDPSCDA.LBMIL01FIQ01.F_CV_6_20\",\n    \"name\" : \"lloydBrownOut_New\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MTPH.MTPSCDA.WMHTWL1FIQ01.F_CV_6_20\",\n    \"name\" : \"westMontroseOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"if(branchtonFlow.value!=null){\\r\\n    branchtonOut_New.value=branchtonFlow.value;\\r\\n}\\r\\nif(linwoodFlow.value!=null){\\r\\n    linwoodOut.value= linwoodFlow.value;\\r\\n}\\r\\nif(lloydBrownFlow.value!=null){\\r\\n    lloydBrownOut_New.value=lloydBrownFlow.value;\\r\\n}\\r\\nif(westMontroseFlow.value!=null){\\r\\n    westMontroseOut.value=westMontroseFlow.value;\\r\\n}\\r\\nif(ayrNetFlow.value!=null){\\r\\n    ayrNetOut.value=ayrNetFlow.value;\\r\\n}\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",linwoodFlow,ayrNetFlow,westMontroseFlow,branchtonFlow,__results__,lloydBrownFlow\",\n    \"outputs\" : \",westMontroseOut,linwoodOut,branchtonOut_New,ayrNetOut,lloydBrownOut_New\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"16d2e71d-4b13-4fac-b3fc-538ee7d81366\",\n  \"owner\" : \"ralbasel@regionofwaterloo.ca\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MDPH.MDPSCDA.ATPT_NET_FLOW_6_20\",\"name\":\"ayrNetOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.KWCRH.KWCR_BMSTWL1FIQ01.F_CV_6_20\",\"name\":\"branchtonOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPH.MDPSCDA.BMSTWL1FIQ01.F_CV_6_20\",\"name\":\"branchtonOut_New\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.SJPH.LINOIT1.LINTWL1FIQ01_06_20\",\"name\":\"linwoodOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.KWCRH.KWCR_LBMIL01FIQ01.F_CV_6_20\",\"name\":\"lloydBrownOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPH.MDPSCDA.LBMIL01FIQ01.F_CV_6_20\",\"name\":\"lloydBrownOut_New\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MTPH.MTPSCDA.WMHTWL1FIQ01.F_CV_6_20\",\"name\":\"westMontroseOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Average Flow Rate 6 am to 10 am\",\n  \"description\" : \"Stores average instataneous flow rates during peak hours\",\n  \"schedule\" : \"30 4 * * *\",\n  \"lastRunMessage\" : \"16d2e71d-4b13-4fac-b3fc-538ee7d81388\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"ET.MDPH.MDPSCDA.ATPT_NET_FLOW:average:PT4H\",\n    \"name\" : \"ayrNetFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D,+PT6H\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.BMSTWL01FI01QVA.F_CV:average:PT4H\",\n    \"name\" : \"BranchtonFlow_WATH\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D,+PT6H\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.LINTWL01FI01QVA.F_CV:average:PT4H\",\n    \"name\" : \"linwoodFlow_WATH\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D,+PT6H\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.LBMIL001FI01QVA.F_CV:average:PT4H\",\n    \"name\" : \"LloydBrownFlow_WATH\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D,+PT6H\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.WMHTWL01FI01QVA.F_CV:average:PT4H\",\n    \"name\" : \"westMontroseFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D,+PT6H\",\n    \"duration\" : \"PT4H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.WMHTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"average\\\",\\\"interval\\\":\\\"PT4H\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MDPH.MDPSCDA.ATPT_NET_FLOW_6_10\",\n    \"name\" : \"ayrNetOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"Ayr Net Average Flow 6 am to 10 am\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.KWCRH.KWCR_BMSTWL1FIQ01.F_CV_6_10\",\n    \"name\" : \"branchtonOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"Branchton Discharge Average Flow 6 am to 10 am\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MDPH.MDPSCDA.BMSTWL1FIQ01.F_CV_6_10\",\n    \"name\" : \"branchtonOut_New\",\n    \"type\" : \"tag\",\n    \"description\" : \"Branchton Discharge Average Flow 6 am to 10 am (L/s)\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.SJPH.LINOIT1.LINTWL1FIQ01_06_10\",\n    \"name\" : \"linwoodOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"Linwood Discharge Average Flow Rate 6 am to 10 am\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.WATH.MTPSVR2.LINTWL1FIQ01_06_10\",\n    \"name\" : \"linwoodOut_WATH\",\n    \"type\" : \"tag\",\n    \"description\" : \"Linwood Discharge Flow - 6AM to 10AM\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.KWCRH.KWCR_LBMIL01FIQ01.F_CV_6_10\",\n    \"name\" : \"lloydBrownOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"Lloyd Brown Average Flow 6 am to 10 am\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MDPH.MDPSCDA.LBMIL01FIQ01.F_CV_6_10\",\n    \"name\" : \"lloydBrownOut_New\",\n    \"type\" : \"tag\",\n    \"description\" : \"Lloyd Brown Average Flow 6 am to 10 am (L/s)\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MTPH.MTPSCDA.WMHTWL1FIQ01.F_CV_6_10\",\n    \"name\" : \"westMontroseOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"West Montrose Average Flow 6 am to 10 am\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"if(branchtonFlow.value!=null){\\r\\n    branchtonOut_New.value=branchtonFlow.value;\\r\\n}\\r\\nif(linwoodFlow.value!=null){\\r\\n    linwoodOut.value= linwoodFlow.value;\\r\\n}\\r\\nif(lloydBrownFlow.value!=null){\\r\\n    lloydBrownOut_New.value=lloydBrownFlow.value;\\r\\n}\\r\\nif(westMontroseFlow.value!=null){\\r\\n    westMontroseOut.value=westMontroseFlow.value;\\r\\n}\\r\\nif(ayrNetFlow.value!=null){\\r\\n    ayrNetOut.value=ayrNetFlow.value;\\r\\n}\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : false\n  }, {\n    \"value\" : \"if(BranchtonFlow_WATH.value!=null){\\r\\n    branchtonOut_New.value=BranchtonFlow_WATH.value;\\r\\n}\\r\\nif(linwoodFlow_WATH.value!=null){\\r\\n    linwoodOut_WATH.value= linwoodFlow_WATH.value;\\r\\n}\\r\\nif(LloydBrownFlow_WATH.value!=null){\\r\\n    lloydBrownOut_New.value=LloydBrownFlow_WATH.value;\\r\\n}\\r\\nif(westMontroseFlow.value!=null){\\r\\n    westMontroseOut.value=westMontroseFlow.value;\\r\\n}\\r\\nif(ayrNetFlow.value!=null){\\r\\n    ayrNetOut.value=ayrNetFlow.value;\\r\\n}\\r\\n\",\n    \"version\" : 2,\n    \"start\" : \"2018-10-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",ayrNetFlow,LloydBrownFlow_WATH,westMontroseFlow,linwoodFlow_WATH,__results__,BranchtonFlow_WATH\",\n    \"outputs\" : \",westMontroseOut,ayrNetOut,branchtonOut_New,lloydBrownOut_New,linwoodOut_WATH\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"16d2e71d-4b13-4fac-b3fc-538ee7d81388\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MDPH.MDPSCDA.ATPT_NET_FLOW_6_10\",\"name\":\"ayrNetOut\",\"type\":\"tag\",\"description\":\"Ayr Net Average Flow 6 am to 10 am\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.KWCRH.KWCR_BMSTWL1FIQ01.F_CV_6_10\",\"name\":\"branchtonOut\",\"type\":\"tag\",\"description\":\"Branchton Discharge Average Flow 6 am to 10 am\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPH.MDPSCDA.BMSTWL1FIQ01.F_CV_6_10\",\"name\":\"branchtonOut_New\",\"type\":\"tag\",\"description\":\"Branchton Discharge Average Flow 6 am to 10 am (L/s)\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.SJPH.LINOIT1.LINTWL1FIQ01_06_10\",\"name\":\"linwoodOut\",\"type\":\"tag\",\"description\":\"Linwood Discharge Average Flow Rate 6 am to 10 am\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.WATH.MTPSVR2.LINTWL1FIQ01_06_10\",\"name\":\"linwoodOut_WATH\",\"type\":\"tag\",\"description\":\"Linwood Discharge Flow - 6AM to 10AM\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.KWCRH.KWCR_LBMIL01FIQ01.F_CV_6_10\",\"name\":\"lloydBrownOut\",\"type\":\"tag\",\"description\":\"Lloyd Brown Average Flow 6 am to 10 am\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPH.MDPSCDA.LBMIL01FIQ01.F_CV_6_10\",\"name\":\"lloydBrownOut_New\",\"type\":\"tag\",\"description\":\"Lloyd Brown Average Flow 6 am to 10 am (L/s)\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MTPH.MTPSCDA.WMHTWL1FIQ01.F_CV_6_10\",\"name\":\"westMontroseOut\",\"type\":\"tag\",\"description\":\"West Montrose Average Flow 6 am to 10 am\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"COMM LOSS: New Dundee WTP\",\n  \"description\" : \"Communication Loss - Rural Compliance/Regulatory Items\",\n  \"schedule\" : \"0 2 * * *\",\n  \"lastRunMessage\" : \"8cd803f1-7c9c-4a8e-8e2d-6fce8606b3f4\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MTPH.MTPSCDA.NDPCFR1AIQ01.F_CV:lab:PT5M\",\n    \"name\" : \"inNDPCFR1AIQ\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.NDPNDB0FIQ01.F_CV:lab:PT5M\",\n    \"name\" : \"inNDPNDB0FIQ01\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.NDPRES1LIQ01.F_CV:lab:PT5M\",\n    \"name\" : \"inNDPRES1LIQ01\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.NDPRES2LIQ01.F_CV:lab:PT5M\",\n    \"name\" : \"inNDPRES2LIQ01\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.CL_NDPCFR1AIQ01\",\n    \"name\" : \"CL_NDPCFR1AIQ01\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.CL_NDPNDB0FIQ01\",\n    \"name\" : \"CL_NDPNDB0FIQ01\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.CL_NDPRES1LIQ01\",\n    \"name\" : \"CL_NDPRES1LIQ01\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.CL_NDPRES2LIQ01\",\n    \"name\" : \"CL_NDPRES2LIQ01\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Comm_NDPCFR1AIQ\",\n    \"name\" : \"CommNDPCFR1AIQ\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 3\n  } ],\n  \"code\" : [ {\n    \"value\" : \"BigDecimal commLoss = 0;\\nfor (Data a: inNDPCFR1AIQ.array){\\n    if (null != a.value && 100 != a.quality)\\n        CommNDPCFR1AIQ.add(new Data(a.time, 1, a.quality));\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2017-05-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",inNDPCFR1AIQ\",\n    \"outputs\" : \",CommNDPCFR1AIQ\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"BigDecimal commLoss = 0;\\nfor (Data a: inNDPCFR1AIQ.array){\\n    if (null != a.value && 100 != a.quality)\\n        CommNDPCFR1AIQ.add(new Data(a.time, 1, a.quality));\\n    else (null != a.value && 100 == a.quality)\\n        CommNDPCFR1AIQ.add(new Data(a.time, 0, a.quality));\\n}\\n\",\n    \"version\" : 2,\n    \"start\" : \"2017-06-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",inNDPRES2LIQ01,inNDPNDB0FIQ01,inNDPRES1LIQ01,inNDPCFR1AIQ\",\n    \"outputs\" : \",CommNDPCFR1AIQ\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"for (Data a: inNDPCFR1AIQ.array){\\n    if (null != a.value && 100 != a.quality)\\n        CL_NDPCFR1AIQ01.add(new Data(a.time, 1, a.quality));\\n    else (null != a.value && 100 == a.quality)\\n        CL_NDPCFR1AIQ01.add(new Data(a.time, 0, a.quality));\\n}\\nfor (Data b: inNDPNDB0FIQ01.array){\\n    if (null != b.value && 100 != b.quality)\\n        CL_NDPNDB0FIQ01.add(new Data(b.time, 1, b.quality));\\n    else (null != b.value && 100 == b.quality)\\n        CL_NDPNDB0FIQ01.add(new Data(b.time, 0, b.quality));\\n}\\nfor (Data c: inNDPRES1LIQ01.array){\\n    if (null != c.value && 100 != c.quality)\\n        CL_NDPRES1LIQ01.add(new Data(c.time, 1, c.quality));\\n    else (null != c.value && 100 == c.quality)\\n        CL_NDPRES1LIQ01.add(new Data(c.time, 0, c.quality));\\n}\\nfor (Data d: inNDPRES2LIQ01.array){\\n    if (null != d.value && 100 != d.quality)\\n        CL_NDPRES2LIQ01.add(new Data(d.time, 1, d.quality));\\n    else (null != d.value && 100 == d.quality)\\n        CL_NDPRES2LIQ01.add(new Data(d.time, 0, d.quality));\\n}\\n\",\n    \"version\" : 3,\n    \"start\" : \"2017-07-06T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",inNDPRES2LIQ01,inNDPNDB0FIQ01,inNDPRES1LIQ01,__results__,inNDPCFR1AIQ\",\n    \"outputs\" : \",CL_NDPCFR1AIQ01,CL_NDPRES2LIQ01,CL_NDPNDB0FIQ01,CL_NDPRES1LIQ01\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"8cd803f1-7c9c-4a8e-8e2d-6fce8606b3f4\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.CL_NDPCFR1AIQ01\",\"name\":\"CL_NDPCFR1AIQ01\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.CL_NDPNDB0FIQ01\",\"name\":\"CL_NDPNDB0FIQ01\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.CL_NDPRES1LIQ01\",\"name\":\"CL_NDPRES1LIQ01\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.CL_NDPRES2LIQ01\",\"name\":\"CL_NDPRES2LIQ01\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Comm_NDPCFR1AIQ\",\"name\":\"CommNDPCFR1AIQ\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":3}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Discharge Valve Closed\",\n  \"description\" : \"Flags SNF when discharge valve is closed\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"05612a9f-7675-4d59-a49b-5dea3972d4b8\",\n  \"constant\" : [ \"DischargeValveClosed\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MTPH.MTPSCDA.MTPUV01UVQ02.F_CV:rawByTime:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"KWCRH.WTP_MTPUV01OVMDI.F_CV:sample:PT2M\",\n    \"name\" : \"DischargeValve\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(__source__, DischargeValve, 30);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs) {\\n    //If value of secondary tag shows discharge valve is closed\\n    if($(DischargeValveClosed)==pair.b.value){\\n        //Add \\\"Status No Flow\\\" flag to primary tag\\n        pair.a.addFlag(\\\"SNF\\\");\\n    }\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2014-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"05612a9f-7675-4d59-a49b-5dea3972d4b8\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2014-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ {\n    \"value\" : 0,\n    \"start\" : \"2025-08-10T00:00:00.000\",\n    \"end\" : null,\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"DischargeValveClosed\",\n  \"description\" : \"Value signifying that a discharge valve is closed\",\n  \"units\" : \"\",\n  \"defaultValue\" : 2,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_CambridgeCombinedFlowTags\",\n  \"description\" : \"Calculation to combine tags for flow summary\",\n  \"schedule\" : \"0 1 * * *\",\n  \"lastRunMessage\" : \"ce6e816e-0d1e-414a-88d2-8712ce69a2e4\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.G15W0015FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"G15\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G15W0015FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.CBWG016FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"G16\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.CBWG016FIQ01.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G17W0017FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"G17\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G17W0017FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G18W0018FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"G18\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G18W0018FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G06W0006FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"G6\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G06W0006FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.MDPWELLFXQ01.F_CV:raw:P1D\",\n    \"name\" : \"MiddletonWell\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.MDPWELLFXQ01.F_CV\\\",\\\"mode\\\":\\\"raw\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.P10W0010FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"P10\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.P10W0010FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.P11W0011FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"P11\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.P11W0011FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.P11W0017FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"P17\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.P11W0017FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.G16_17_18CombinedFlow\",\n    \"name\" : \"G16_17_18CombinedFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"G16,G17, G18 Combined flow\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Middleton_G15CombinedFlow\",\n    \"name\" : \"Middleton_G15CombinedFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"Middleton Well G15 combined flow\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.P10_11_17CombinedFlow\",\n    \"name\" : \"P10_11_17CombinedFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"P10, P11, P17 Combined flow\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"def crunchInputs(tagOut, inPuts, mode, interval){\\r\\n    TagInputGroup myGroup = new TagInputGroup();\\r\\n    for (TagInput input: inPuts){\\r\\n        myGroup.add(input);\\r\\n        //context.info('bug: ', input);\\r\\n    }\\r\\n    myGroup.alignData(mode, '', interval);\\r\\n    for (Data x: myGroup.getTotalIntervals()){\\r\\n        //context.info('bug: ', x);\\r\\n        tagOut.add(x);\\r\\n    }\\r\\n}\\r\\n//Region specific calls\\r\\ncrunchInputs(Middleton_G15CombinedFlow, [MiddletonWell,G15], 'total', 'PT2M');\\r\\ncrunchInputs(P10_11_17CombinedFlow, [P10, P11, P17], 'total', 'PT2M');\\r\\ncrunchInputs(G16_17_18CombinedFlow, [G6, G16, G17, G18], 'total', 'PT2M');\",\n    \"version\" : 1,\n    \"start\" : \"2019-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",P11,P17,MiddletonWell,G15,G17,__results__,G16,P10,G18,G6\",\n    \"outputs\" : \",G16_17_18CombinedFlow,Middleton_G15CombinedFlow,P10_11_17CombinedFlow\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"ce6e816e-0d1e-414a-88d2-8712ce69a2e4\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.G16_17_18CombinedFlow\",\"name\":\"G16_17_18CombinedFlow\",\"type\":\"tag\",\"description\":\"G16,G17, G18 Combined flow\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Middleton_G15CombinedFlow\",\"name\":\"Middleton_G15CombinedFlow\",\"type\":\"tag\",\"description\":\"Middleton Well G15 combined flow\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.P10_11_17CombinedFlow\",\"name\":\"P10_11_17CombinedFlow\",\"type\":\"tag\",\"description\":\"P10, P11, P17 Combined flow\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_CambridgeExceedances_Discharge\",\n  \"description\" : \"\",\n  \"schedule\" : \"5 1 * * *\",\n  \"lastRunMessage\" : \"37387d9f-f11d-4f9a-ac0f-0bae27f2364a\",\n  \"constant\" : [ \"Middleton_G15Discharge\", \"G9Discharge\", \"G4_4ADischarge\", \"P10_11_17Discharge\", \"H3_3ADischarge\", \"H4ADischarge\", \"H5_5ADischarge\", \"G7_8_38_39_40Discharge\", \"G6Discharge\", \"G16_17_18Discharge\", \"G5_5ADischarge\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.TTPTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"G16_17_18\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.TTPTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G09TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"G9\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G09TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.MDPTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"Middleton_G15\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.MDPTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"ET.P10_11_17CombinedFlow:raw:P1D\",\n    \"name\" : \"P10_11_17\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.G16_17_18Discharge\",\n    \"name\" : \"G16_17_18Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.G4_4ADischarge\",\n    \"name\" : \"G4_4ADischarge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.G5_5ADischarge\",\n    \"name\" : \"G5_5ADischarge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.G6Discharge\",\n    \"name\" : \"G6Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.G7_8_38_39_40Discharge\",\n    \"name\" : \"G7_8_38_39_40Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.G9Discharge\",\n    \"name\" : \"G9Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.H3_3ADischarge\",\n    \"name\" : \"H3_3ADischarge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.H4ADischarge\",\n    \"name\" : \"H4ADischarge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.H5_5ADischarge\",\n    \"name\" : \"H5_5ADischarge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Middleton_G15Discharge\",\n    \"name\" : \"Middleton_G15Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.P10_11_17Discharge\",\n    \"name\" : \"P10_11_17Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//FOR THIS CALCULATION TO WORK all inputs, outputs, and constants must follow the following naming convention\\r\\n// FOR EACH SITE - Two output tags are required:\\r\\n//output name must be: SITE (i.e. K33Flow) and 'SITE' + 'Constant' (i.e. K33Constant)\\r\\n//input name must be :'SITE' + 'Flow' (i.e. K33Flow)\\r\\n//constant name must be: 'SITE' + 'TYPE' - where type is PTTW, Discharge, MDWL\\r\\n//input name must be: SITE\\r\\n\\r\\n/****FUNCTIONS*******/\\r\\n\\r\\ndef findInputs(output, typeString){\\r\\n    for (TagInput input: inputs){\\r\\n        if (input.name + typeString == output.name){\\r\\n            return input;\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef findConstants(output){\\r\\n    BigDecimal smallest = null;\\r\\n    ConstantInput toReturn = null;\\r\\n    for (ConstantInput con: constants){\\r\\n        //context.info(\\\"Debug:\\\", con.name + \\\" \\\" + con.value);\\r\\n        if(output.name == con.name ){\\r\\n            //context.info(\\\"Debug:\\\", \\\"added \\\" + con.name);\\r\\n            toReturn = con;\\r\\n        }\\r\\n    }\\r\\n    return toReturn;\\r\\n}\\r\\n\\r\\ndef makeRunSet(output, typeString){\\r\\n    if (output != null){\\r\\n        //context.info(\\\"Debug:\\\", \\\"Finding inputs for: \\\"+output.name);\\r\\n        con = findConstants(output);\\r\\n        input = findInputs(output, typeString);\\r\\n        if (con != null && input != null){\\r\\n            //context.info(\\\"Debug:\\\", output.name + input.name + con.name);\\r\\n            return [output, input, con];\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef addOverFlowData(outputTag, inputTag, constantTag){\\r\\n\\tcon = constantTag.value;\\r\\n\\tBoolean eventFlag = false;\\r\\n\\tBigDecimal eventStart = 0.0;\\r\\n\\teventDate = null;\\r\\n\\tBigDecimal eventEnd = 0.0;\\r\\n\\tBigDecimal eventDuration = 0.0;\\r\\n        //context.info(outputTag);\\r\\n\\tfor (Data myData : inputTag.array){\\r\\n\\t    if (myData.value != null && myData.value >= con && eventFlag == false){\\r\\n\\t\\t\\t//note datetime\\r\\n\\t\\t\\teventStart = myData.timeInSeconds;\\r\\n\\t\\t\\teventDate = myData.time;\\r\\n\\t\\t\\teventFlag = true;\\r\\n\\t\\t}\\r\\n\\t\\telse if (myData.value != null && myData.value < con && eventFlag == true){\\r\\n\\t\\t\\t//note endTime\\r\\n\\t\\t\\teventEnd = myData.timeInSeconds;\\r\\n\\t\\t\\teventDuration = (eventEnd - eventStart)/60;\\r\\n\\t\\t\\t//add data\\r\\n\\t\\t\\tDate date = new Date();\\r\\n\\t\\t\\toutData = eventDate + \\\":\\\" + eventDuration.toString();\\r\\n\\t\\t\\t//context.info(outputTag.name + \\\":\\\", date + \\\",\\\" + outData);\\r\\n            outputTag.add(new Data(eventDate, eventDuration, 100));\\r\\n\\t\\t\\teventFlag = false;\\r\\n\\t\\t}\\r\\n\\t}\\t\\r\\n}\\r\\n\\r\\ndef calcRunner(typeString){\\r\\n\\tArrayList toRun = new ArrayList();\\r\\n    var runSet = [];\\r\\n\\tfor (TagOutput output: outputs){\\r\\n        runSet = makeRunSet(output, typeString);\\r\\n        if (runSet != null){\\r\\n\\t\\t\\ttoRun.add(runSet);\\r\\n        }\\r\\n\\t}\\r\\n\\tfor (x : toRun){\\r\\n        //context.info(\\\"Proof: \\\", x);\\r\\n        if (x != null){\\r\\n\\t\\t    //context.info(\\\"Proof: \\\", x[0].name + \\\" \\\" + x[1].name + \\\" \\\" + x[2].name);\\r\\n\\t\\t    addOverFlowData(x[0],x[1],x[2]);\\r\\n        }\\r\\n\\t}\\r\\n}\\r\\n/*******MAIN********/\\r\\n//calcRunner(\\\"PTTW\\\");\\r\\ncalcRunner(\\\"Discharge\\\");\\r\\n//calcRunner(\\\"MDWL\\\");\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2000-08-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",G9,Middleton_G15,G16_17_18,P10_11_17,__results__\",\n    \"outputs\" : \",G16_17_18Discharge\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"37387d9f-f11d-4f9a-ac0f-0bae27f2364a\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"Middleton_G15Discharge\",\n  \"description\" : \"Middleton, G15 combined discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 444,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"G9Discharge\",\n  \"description\" : \"G9 discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 37.9,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"G4_4ADischarge\",\n  \"description\" : \"G4 discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 22,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"P10_11_17Discharge\",\n  \"description\" : \"P10, P11, P17 discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 120,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"H3_3ADischarge\",\n  \"description\" : \"H3/3A Discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 19,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"H4ADischarge\",\n  \"description\" : \"H4A Discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 24,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"H5_5ADischarge\",\n  \"description\" : \"H5/5A discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 23,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"G7_8_38_39_40Discharge\",\n  \"description\" : \"G7, G8, G38, G39, G40 discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 142.5,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"G6Discharge\",\n  \"description\" : \"G6 discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 20.9,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"G16_17_18Discharge\",\n  \"description\" : \"G6, 16, 17, 18 combined discharge\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 120,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"G5_5ADischarge\",\n  \"description\" : \"G5/5A discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 50,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G16_17_18Discharge\",\"name\":\"G16_17_18Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G4_4ADischarge\",\"name\":\"G4_4ADischarge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G5_5ADischarge\",\"name\":\"G5_5ADischarge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G6Discharge\",\"name\":\"G6Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G7_8_38_39_40Discharge\",\"name\":\"G7_8_38_39_40Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G9Discharge\",\"name\":\"G9Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.H3_3ADischarge\",\"name\":\"H3_3ADischarge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.H4ADischarge\",\"name\":\"H4ADischarge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.H5_5ADischarge\",\"name\":\"H5_5ADischarge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Middleton_G15Discharge\",\"name\":\"Middleton_G15Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.P10_11_17Discharge\",\"name\":\"P10_11_17Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"c0251206-1cf1-49b9-a1d9-fc7b3f5aaaca\",\"source\":\"EEI_CambridgeExceedances_Discharge\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_CambridgeExceedances_PTTW\",\n  \"description\" : \"Overflow summary (PTTW) for Cambridge sites\",\n  \"schedule\" : \"5 1 * * *\",\n  \"lastRunMessage\" : \"a5aa7342-22c0-415d-9c3a-ae373eb5e352\",\n  \"constant\" : [ \"MiddletonWellPTTW\", \"G15PTTW\", \"G4_4APTTW\", \"P9_15_15APTTW\", \"P11PTTW\", \"P17PTTW\", \"H3_3APTTW\", \"H5_5APTTW\", \"H4APTTW\", \"G7_8_38_39_40PTTW\", \"G6PTTW\", \"G17PTTW\", \"G18PTTW\", \"G5_5APTTW\", \"G16PTTW\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.G15W0015FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"G15\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G15W0015FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.CBWG016FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"G16\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.CBWG016FIQ01.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G17W0017FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"G17\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G17W0017FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.CBWG018FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"G18\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.CBWG018FIQ01.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.CBWG004FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"G4_4A\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.CBWG004FIQ01.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G05TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"G5_5A\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G05TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.CBWG006FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"G6\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.STPW000XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"G7_8_38_39_40\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.H03TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"H3_3A\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.H03TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.H04TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"H4A\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.H04TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.H05TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"H5_5A\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.H05TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"@.MDP_Well_Sum:raw:P1D\",\n    \"name\" : \"MiddletonWell\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"@.MDP_Well_Sum\\\",\\\"mode\\\":\\\"raw\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.P11W0011FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"P11\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.P11W0011FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.P11W0017FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"P17\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.P11W0017FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.RAPP000FXQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"P9_15_15A\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.RAPP000FXQ01.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.G15PTTW\",\n    \"name\" : \"G15PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.G16_17_18PTTW\",\n    \"name\" : \"G16_17_18PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.G16PTTW\",\n    \"name\" : \"G16PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.G17PTTW\",\n    \"name\" : \"G17PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.G18PTTW\",\n    \"name\" : \"G18PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.G4_4APTTW\",\n    \"name\" : \"G4_4APTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.G5_5APTTW\",\n    \"name\" : \"G5_5APTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.G6PTTW\",\n    \"name\" : \"G6PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.G7_8_38_39_40PTTW\",\n    \"name\" : \"G7_8_38_39_40PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.H3_3APTTW\",\n    \"name\" : \"H3_3APTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.H4APTTW\",\n    \"name\" : \"H4APTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.H5_5APTTW\",\n    \"name\" : \"H5_5APTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MiddletonWellPTTW\",\n    \"name\" : \"MiddletonWellPTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.P11PTTW\",\n    \"name\" : \"P11PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.P17PTTW\",\n    \"name\" : \"P17PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.P9_15_15APTTW\",\n    \"name\" : \"P9_15_15APTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//FOR THIS CALCULATION TO WORK all inputs, outputs, and constants must follow the following naming convention\\r\\n// FOR EACH SITE - Two output tags are required:\\r\\n//output name must be: SITE (i.e. K33Flow) and 'SITE' + 'Constant' (i.e. K33Constant)\\r\\n//input name must be :'SITE' + 'Flow' (i.e. K33Flow)\\r\\n//constant name must be: 'SITE' + 'TYPE' - where type is PTTW, Discharge, MDWL\\r\\n//input name must be: SITE\\r\\n\\r\\n/****FUNCTIONS*******/\\r\\n\\r\\ndef findInputs(output, typeString){\\r\\n    for (TagInput input: inputs){\\r\\n        if (input.name + typeString == output.name){\\r\\n            return input;\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef findConstants(output){\\r\\n    BigDecimal smallest = null;\\r\\n    ConstantInput toReturn = null;\\r\\n    for (ConstantInput con: constants){\\r\\n        //context.info(\\\"Debug:\\\", con.name + \\\" \\\" + con.value);\\r\\n        if(output.name == con.name ){\\r\\n            //context.info(\\\"Debug:\\\", \\\"added \\\" + con.name);\\r\\n            toReturn = con;\\r\\n        }\\r\\n    }\\r\\n    return toReturn;\\r\\n}\\r\\n\\r\\ndef makeRunSet(output, typeString){\\r\\n    if (output != null){\\r\\n        //context.info(\\\"Debug:\\\", \\\"Finding inputs for: \\\"+output.name);\\r\\n        con = findConstants(output);\\r\\n        input = findInputs(output, typeString);\\r\\n        if (con != null && input != null){\\r\\n            //context.info(\\\"Debug:\\\", output.name + input.name + con.name);\\r\\n            return [output, input, con];\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef addOverFlowData(outputTag, inputTag, constantTag){\\r\\n\\tcon = constantTag.value;\\r\\n\\tBoolean eventFlag = false;\\r\\n\\tBigDecimal eventStart = 0.0;\\r\\n\\teventDate = null;\\r\\n\\tBigDecimal eventEnd = 0.0;\\r\\n\\tBigDecimal eventDuration = 0.0;\\r\\n    context.info(outputTag);\\r\\n\\tfor (Data myData : inputTag.array){\\r\\n\\t    if (myData.value != null && myData.value >= con && eventFlag == false){\\r\\n\\t\\t\\t//note datetime\\r\\n\\t\\t\\teventStart = myData.timeInSeconds;\\r\\n\\t\\t\\teventDate = myData.time;\\r\\n\\t\\t\\teventFlag = true;\\r\\n\\t\\t}\\r\\n\\t\\telse if (myData.value != null && myData.value < con && eventFlag == true){\\r\\n\\t\\t\\t//note endTime\\r\\n\\t\\t\\teventEnd = myData.timeInSeconds;\\r\\n\\t\\t\\teventDuration = (eventEnd - eventStart)/60;\\r\\n\\t\\t\\t//add data\\r\\n\\t\\t\\tDate date = new Date();\\r\\n\\t\\t\\toutData = eventDate + \\\":\\\" + eventDuration.toString();\\r\\n\\t\\t\\t//context.info(outputTag.name + \\\":\\\", date + \\\",\\\" + outData);\\r\\n            outputTag.add(new Data(eventDate, eventDuration, 100));\\r\\n            eventFlag = false;\\r\\n\\t\\t}\\r\\n\\t}\\t\\r\\n}\\r\\n\\r\\ndef calcRunner(typeString){\\r\\n\\tArrayList toRun = new ArrayList();\\r\\n    var runSet = [];\\r\\n\\tfor (TagOutput output: outputs){\\r\\n        runSet = makeRunSet(output, typeString);\\r\\n        if (runSet != null){\\r\\n\\t\\t\\ttoRun.add(runSet);\\r\\n        }\\r\\n\\t}\\r\\n\\tfor (x : toRun){\\r\\n        //context.info(\\\"Proof: \\\", x);\\r\\n        if (x != null){\\r\\n\\t\\t    //context.info(\\\"Proof: \\\", x[0].name + \\\" \\\" + x[1].name + \\\" \\\" + x[2].name);\\r\\n\\t\\t    addOverFlowData(x[0],x[1],x[2]);\\r\\n        }\\r\\n\\t}\\r\\n}\\r\\n/*******MAIN********/\\r\\ncalcRunner(\\\"PTTW\\\");\\r\\n//calcRunner(\\\"Discharge\\\");\\r\\n//calcRunner(\\\"MDWL\\\");\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-07-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",G7_8_38_39_40,G15,G17,G16,H3_3A,H5_5A,G18,G6,P11,P9_15_15A,H4A,P17,MiddletonWell,__results__,G4_4A,G5_5A\",\n    \"outputs\" : \",G17PTTW,G15PTTW\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"a5aa7342-22c0-415d-9c3a-ae373eb5e352\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MiddletonWellPTTW\",\n  \"description\" : \"Middleton PTTW limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 420,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"G15PTTW\",\n  \"description\" : \"G15 PTTW limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 75,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"G4_4APTTW\",\n  \"description\" : \"G4 pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 22,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"P9_15_15APTTW\",\n  \"description\" : \"P9, 15, 15A combined pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 42,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 160,\n    \"start\" : \"2020-12-01T00:00:00.000\",\n    \"end\" : null,\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"P11PTTW\",\n  \"description\" : \"P11 pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 60,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"P17PTTW\",\n  \"description\" : \"P17 pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 60,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"H3_3APTTW\",\n  \"description\" : \"H3/3A pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 19,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"H5_5APTTW\",\n  \"description\" : \"H5/5A pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 23,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"H4APTTW\",\n  \"description\" : \"H4A pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 24,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"G7_8_38_39_40PTTW\",\n  \"description\" : \"G7, G8, G38, G39, G40 pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 146,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"G6PTTW\",\n  \"description\" : \"G6 pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 25,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"G17PTTW\",\n  \"description\" : \"G17 pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 50,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"G18PTTW\",\n  \"description\" : \"G18 pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 37,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"G5_5APTTW\",\n  \"description\" : \"G5/5A pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 50,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 150,\n    \"start\" : \"2020-12-01T00:00:00.000\",\n    \"end\" : null,\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  }, {\n    \"value\" : 130.4,\n    \"start\" : \"2022-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"G16PTTW\",\n  \"description\" : \"G6, 16, 17, 18 PTTW limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 38,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G15PTTW\",\"name\":\"G15PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G16_17_18PTTW\",\"name\":\"G16_17_18PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G16PTTW\",\"name\":\"G16PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G17PTTW\",\"name\":\"G17PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G18PTTW\",\"name\":\"G18PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G4_4APTTW\",\"name\":\"G4_4APTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G5_5APTTW\",\"name\":\"G5_5APTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G6PTTW\",\"name\":\"G6PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.G7_8_38_39_40PTTW\",\"name\":\"G7_8_38_39_40PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.H3_3APTTW\",\"name\":\"H3_3APTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.H4APTTW\",\"name\":\"H4APTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.H5_5APTTW\",\"name\":\"H5_5APTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MiddletonWellPTTW\",\"name\":\"MiddletonWellPTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.P11PTTW\",\"name\":\"P11PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.P17PTTW\",\"name\":\"P17PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.P9_15_15APTTW\",\"name\":\"P9_15_15APTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"b21e0a3e-c90b-4bca-99c9-5722d08fa0d6\",\"source\":\"EEI_CambridgeExceedances_PTTW\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_KitchenerExceedances_Discharge\",\n  \"description\" : \"\",\n  \"schedule\" : \"5 1 * * *\",\n  \"lastRunMessage\" : \"0140189f-9bbb-4ff3-9d4f-bf9b3b6b428d\",\n  \"constant\" : [ \"K50_51Discharge\", \"StrangeStreetDischarge\", \"K34_36Discharge\", \"K1A_2A_4B_5A_8Discharge\", \"K31_33Discharge\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR3.GBPKB00FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"K1A_2A_4B_8\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.PKPTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K31_33\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.PKPTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K34TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K34_36\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K34TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K50W000XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K50_51\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K50W000XFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.SSPTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"StrangeStreet\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.SSPTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.K1A_2A_4B_8Discharge\",\n    \"name\" : \"K1A_2A_4B_8Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K31_33Discharge\",\n    \"name\" : \"K31_33Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K34_36Discharge\",\n    \"name\" : \"K34_36Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K50_51Discharge\",\n    \"name\" : \"K50_51Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.StrangeStreetDischarge\",\n    \"name\" : \"StrangeStreetDischarge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//FOR THIS CALCULATION TO WORK all inputs, outputs, and constants must follow the following naming convention\\r\\n// FOR EACH SITE - Two output tags are required:\\r\\n//output name must be: SITE (i.e. K33Flow) and 'SITE' + 'Constant' (i.e. K33Constant)\\r\\n//input name must be :'SITE' + 'Flow' (i.e. K33Flow)\\r\\n//constant name must be: 'SITE' + 'TYPE' - where type is PTTW, Discharge, MDWL\\r\\n//input name must be: SITE\\r\\n\\r\\n/****FUNCTIONS*******/\\r\\n\\r\\ndef findInputs(output, typeString){\\r\\n    for (TagInput input: inputs){\\r\\n        if (input.name + typeString == output.name){\\r\\n            return input;\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef findConstants(output){\\r\\n    BigDecimal smallest = null;\\r\\n    ConstantInput toReturn = null;\\r\\n    for (ConstantInput con: constants){\\r\\n        //context.info(\\\"Debug:\\\", con.name + \\\" \\\" + con.value);\\r\\n        if(output.name == con.name ){\\r\\n            //context.info(\\\"Debug:\\\", \\\"added \\\" + con.name);\\r\\n            toReturn = con;\\r\\n        }\\r\\n    }\\r\\n    return toReturn;\\r\\n}\\r\\n\\r\\ndef makeRunSet(output, typeString){\\r\\n    if (output != null){\\r\\n        //context.info(\\\"Debug:\\\", \\\"Finding inputs for: \\\"+output.name);\\r\\n        con = findConstants(output);\\r\\n        input = findInputs(output, typeString);\\r\\n        if (con != null && input != null){\\r\\n            //context.info(\\\"Debug:\\\", output.name + input.name + con.name);\\r\\n            return [output, input, con];\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef addOverFlowData(outputTag, inputTag, constantTag){\\r\\n\\tcon = constantTag.value;\\r\\n\\tBoolean eventFlag = false;\\r\\n\\tBigDecimal eventStart = 0.0;\\r\\n\\teventDate = null;\\r\\n\\tBigDecimal eventEnd = 0.0;\\r\\n\\tBigDecimal eventDuration = 0.0;\\r\\n        //context.info(outputTag);\\r\\n\\tfor (Data myData : inputTag.array){\\r\\n\\t    if (myData.value != null && myData.value >= con && eventFlag == false){\\r\\n\\t\\t\\t//note datetime\\r\\n\\t\\t\\teventStart = myData.timeInSeconds;\\r\\n\\t\\t\\teventDate = myData.time;\\r\\n\\t\\t\\teventFlag = true;\\r\\n\\t\\t}\\r\\n\\t\\telse if (myData.value != null && myData.value < con && eventFlag == true){\\r\\n\\t\\t\\t//note endTime\\r\\n\\t\\t\\teventEnd = myData.timeInSeconds;\\r\\n\\t\\t\\teventDuration = (eventEnd - eventStart)/60;\\r\\n\\t\\t\\t//add data\\r\\n\\t\\t\\tDate date = new Date();\\r\\n\\t\\t\\toutData = eventDate + \\\":\\\" + eventDuration.toString();\\r\\n\\t\\t\\t//context.info(outputTag.name + \\\":\\\", date + \\\",\\\" + outData);\\r\\n            outputTag.add(new Data(eventDate, eventDuration, 100));\\r\\n\\t\\t\\teventFlag = false;\\r\\n\\t\\t}\\r\\n\\t}\\t\\r\\n}\\r\\n\\r\\ndef calcRunner(typeString){\\r\\n\\tArrayList toRun = new ArrayList();\\r\\n    var runSet = [];\\r\\n\\tfor (TagOutput output: outputs){\\r\\n        runSet = makeRunSet(output, typeString);\\r\\n        if (runSet != null){\\r\\n\\t\\t\\ttoRun.add(runSet);\\r\\n        }\\r\\n\\t}\\r\\n\\tfor (x : toRun){\\r\\n        //context.info(\\\"Proof: \\\", x);\\r\\n        if (x != null){\\r\\n\\t\\t    //context.info(\\\"Proof: \\\", x[0].name + \\\" \\\" + x[1].name + \\\" \\\" + x[2].name);\\r\\n\\t\\t    addOverFlowData(x[0],x[1],x[2]);\\r\\n        }\\r\\n\\t}\\r\\n}\\r\\n/*******MAIN********/\\r\\n//calcRunner(\\\"PTTW\\\");\\r\\ncalcRunner(\\\"Discharge\\\");\\r\\n//calcRunner(\\\"MDWL\\\");\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2000-08-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",K34_36,K1A_2A_4B_8,K31_33,K50_51,StrangeStreet,__results__\",\n    \"outputs\" : \",K34_36Discharge,K50_51Discharge\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"0140189f-9bbb-4ff3-9d4f-bf9b3b6b428d\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K50_51Discharge\",\n  \"description\" : \"K50 + K51 discharge flag value\",\n  \"units\" : \"l/s\",\n  \"defaultValue\" : 158,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 75,\n    \"start\" : \"2011-11-01T00:00:00.000\",\n    \"end\" : \"2021-11-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"StrangeStreetDischarge\",\n  \"description\" : \"Strange Street discharge flag value\",\n  \"units\" : \"l/s\",\n  \"defaultValue\" : 250,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K34_36Discharge\",\n  \"description\" : \"K34 + K36 discharge flag value\",\n  \"units\" : \"l/s\",\n  \"defaultValue\" : 76,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K1A_2A_4B_5A_8Discharge\",\n  \"description\" : \"K1A K2A K4B K5A K8 Discharge flag value\",\n  \"units\" : \"l/s\",\n  \"defaultValue\" : 142,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K31_33Discharge\",\n  \"description\" : \"K31 + K33 discharge flag value\",\n  \"units\" : \"l/s\",\n  \"defaultValue\" : 285,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K1A_2A_4B_8Discharge\",\"name\":\"K1A_2A_4B_8Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K31_33Discharge\",\"name\":\"K31_33Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K34_36Discharge\",\"name\":\"K34_36Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K50_51Discharge\",\"name\":\"K50_51Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.StrangeStreetDischarge\",\"name\":\"StrangeStreetDischarge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"5bfccec7-4035-4d1f-8cff-5e43affe1098\",\"source\":\"EEI_KitchenerExceedances_Discharge\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_KitchenerExceedances_PTTW\",\n  \"description\" : \"Flow summary (PTTW and Discharge) for Kitchener sites\",\n  \"schedule\" : \"5 1 * * *\",\n  \"lastRunMessage\" : \"ac822de1-258e-42c4-9e59-495632bc77f6\",\n  \"constant\" : [ \"StrangeStreetPTTW\", \"K50_51PTTW\", \"K33PTTW\", \"K34PTTW\", \"K36PTTW\", \"K1A_2A_4B_5A_8PTTW\", \"K34_36PTTW\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR3.GBPRES1FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"K1A_2A_4B_5A_8\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K31W0033FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K33\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K31W0033FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K34W0034FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K34\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K34W0034FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K34W000XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K34_36\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K34W000XFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K36W0036FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K36\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K36W0036FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K50W000XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K50_51\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K50W000XFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.SSPK001XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"StrangeStreet\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.SSPK001XFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.K1A_2A_4B_5A_8PTTW\",\n    \"name\" : \"K1A_2A_4B_5A_8PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K33PTTW\",\n    \"name\" : \"K33PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K34_36PTTW\",\n    \"name\" : \"K34_36PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"k34/36 pttw exceedance\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K34PTTW\",\n    \"name\" : \"K34PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K36PTTW\",\n    \"name\" : \"K36PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K50_51PTTW\",\n    \"name\" : \"K50_51PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.StrangeStreetPTTW\",\n    \"name\" : \"StrangeStreetPTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//FOR THIS CALCULATION TO WORK all inputs, outputs, and constants must follow the following naming convention\\r\\n// FOR EACH SITE - Two output tags are required:\\r\\n//output name must be: SITE (i.e. K33) and 'SITE' + 'Constant' (i.e. K33Constant)\\r\\n//input name must be :'SITE' + 'Flow' (i.e. K33)\\r\\n//constant name must be: 'SITE' + 'TYPE' - where type is PTTW, Discharge, MDWL\\r\\n//input name must be: SITE\\r\\n\\r\\n/****FUNCTIONS*******/\\r\\n\\r\\ndef findInputs(output, typeString){\\r\\n    for (TagInput input: inputs){\\r\\n        if (input.name + typeString == output.name){\\r\\n            return input;\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef findConstants(output){\\r\\n    BigDecimal smallest = null;\\r\\n    ConstantInput toReturn = null;\\r\\n    for (ConstantInput con: constants){\\r\\n        //context.info(\\\"Debug:\\\", con.name + \\\" \\\" + con.value);\\r\\n        if(output.name == con.name ){\\r\\n            //context.info(\\\"Debug:\\\", \\\"added \\\" + con.name);\\r\\n            toReturn = con;\\r\\n        }\\r\\n    }\\r\\n    return toReturn;\\r\\n}\\r\\n\\r\\ndef makeRunSet(output, typeString){\\r\\n    if (output != null){\\r\\n        //context.info(\\\"Debug:\\\", \\\"Finding inputs for: \\\"+output.name);\\r\\n        con = findConstants(output);\\r\\n        input = findInputs(output, typeString);\\r\\n        if (con != null && input != null){\\r\\n            //context.info(\\\"Debug:\\\", output.name + input.name + con.name);\\r\\n            return [output, input, con];\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef addOverFlowData(outputTag, inputTag, constantTag){\\r\\n\\tcon = constantTag.value;\\r\\n\\tBoolean eventFlag = false;\\r\\n\\tBigDecimal eventStart = 0.0;\\r\\n\\teventDate = null;\\r\\n\\tBigDecimal eventEnd = 0.0;\\r\\n\\tBigDecimal eventDuration = 0.0;\\r\\n    //context.info(outputTag);\\r\\n\\tfor (Data myData : inputTag.array){\\r\\n\\t    if (myData.value != null && myData.value >= con && eventFlag == false){\\r\\n\\t\\t\\t//note datetime\\r\\n\\t\\t\\teventStart = myData.timeInSeconds;\\r\\n\\t\\t\\teventDate = myData.time;\\r\\n\\t\\t\\teventFlag = true;\\r\\n\\t\\t}\\r\\n\\t\\telse if (myData.value != null && myData.value < con && eventFlag == true){\\r\\n\\t\\t\\t//note endTime\\r\\n\\t\\t\\teventEnd = myData.timeInSeconds;\\r\\n\\t\\t\\teventDuration = (eventEnd - eventStart)/60;\\r\\n\\t\\t\\t//add data\\r\\n\\t\\t\\tDate date = new Date();\\r\\n\\t\\t\\toutData = eventDate + \\\":\\\" + eventDuration.toString();\\r\\n\\t\\t\\t//context.info(outputTag.name + \\\":\\\", date + \\\",\\\" + outData);\\r\\n            outputTag.add(new Data(eventDate, eventDuration, 100));\\r\\n\\t\\t\\teventFlag = false;\\r\\n\\t\\t}\\r\\n\\t}\\t\\r\\n}\\r\\n\\r\\ndef calcRunner(typeString){\\r\\n\\tArrayList toRun = new ArrayList();\\r\\n    var runSet = [];\\r\\n\\tfor (TagOutput output: outputs){\\r\\n        runSet = makeRunSet(output, typeString);\\r\\n        if (runSet != null){\\r\\n\\t\\t\\ttoRun.add(runSet);\\r\\n        }\\r\\n\\t}\\r\\n\\tfor (x : toRun){\\r\\n        //context.info(\\\"Proof: \\\", x);\\r\\n        if (x != null){\\r\\n\\t\\t    //context.info(\\\"Proof: \\\", x[0].name + \\\" \\\" + x[1].name + \\\" \\\" + x[2].name);\\r\\n\\t\\t    addOverFlowData(x[0],x[1],x[2]);\\r\\n        }\\r\\n\\t}\\r\\n}\\r\\n/*******MAIN********/\\r\\ncalcRunner(\\\"PTTW\\\");\\r\\n//calcRunner(\\\"Discharge\\\");\\r\\n//calcRunner(\\\"MDWL\\\");\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-06-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",K34_36,K50_51,K33,StrangeStreet,__results__,K1A_2A_4B_5A_8,K34,K36\",\n    \"outputs\" : \",StrangeStreetPTTW,K50_51PTTW\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"ac822de1-258e-42c4-9e59-495632bc77f6\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ {\n    \"value\" : 116,\n    \"start\" : \"2023-08-01T00:00:00.000\",\n    \"end\" : null,\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"StrangeStreetPTTW\",\n  \"description\" : \"StrangeStreet PTTW flag value\",\n  \"units\" : \"l/s\",\n  \"defaultValue\" : 191,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K50_51PTTW\",\n  \"description\" : \"K50 + K51 PTTW flag value\",\n  \"units\" : \"l/s\",\n  \"defaultValue\" : 159,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K33PTTW\",\n  \"description\" : \"K33 pttw flag value\",\n  \"units\" : \"l/s\",\n  \"defaultValue\" : 53,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K34PTTW\",\n  \"description\" : \"K34 pttw flag value\",\n  \"units\" : \"l/s\",\n  \"defaultValue\" : 79,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K36PTTW\",\n  \"description\" : \"K36 pttw flag value\",\n  \"units\" : \"l/s\",\n  \"defaultValue\" : 79,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K1A_2A_4B_5A_8PTTW\",\n  \"description\" : \"K1A K2A K4B K5A K8 pttw flag value\",\n  \"units\" : \"l/s\",\n  \"defaultValue\" : 432,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K34_36PTTW\",\n  \"description\" : \"k34/36 pttw limit\",\n  \"units\" : \"l/s\",\n  \"defaultValue\" : 79,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K1A_2A_4B_5A_8PTTW\",\"name\":\"K1A_2A_4B_5A_8PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K33PTTW\",\"name\":\"K33PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K34_36PTTW\",\"name\":\"K34_36PTTW\",\"type\":\"tag\",\"description\":\"k34/36 pttw exceedance\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K34PTTW\",\"name\":\"K34PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K36PTTW\",\"name\":\"K36PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K50_51PTTW\",\"name\":\"K50_51PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.StrangeStreetPTTW\",\"name\":\"StrangeStreetPTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"1f0b6775-417f-4b0d-81eb-3f9edd5639ac\",\"source\":\"EEI_KitchenerExceedances_PTTW\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_KitchenerFlowCombinedTags\",\n  \"description\" : \"Calculation to combine tags for flow summary\",\n  \"schedule\" : \"0 1 * * *\",\n  \"lastRunMessage\" : \"37a8282e-1d5e-47e0-830f-e429e42e02c0\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR3.PKPK031FIQ01.F_CV:raw:P1D\",\n    \"name\" : \"K31\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.PKPK032FIQ01.F_CV:raw:P1D\",\n    \"name\" : \"K32\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.PKPK033FIQ01.F_CV:raw:P1D\",\n    \"name\" : \"K33\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.KIWK034FIQ01.F_CV:raw:P1D\",\n    \"name\" : \"K34\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.KIWK036FIQ01.F_CV:raw:P1D\",\n    \"name\" : \"K36\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.K31_33CombinedFlow\",\n    \"name\" : \"K31_33CombinedFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"combined flow for K31, K32, K33\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 1\n  }, {\n    \"value\" : \"ET.K34_36CombinedFlow\",\n    \"name\" : \"K34_36CombinedFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"Combined flow for K34, K36\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 1\n  } ],\n  \"code\" : [ {\n    \"value\" : \"def crunchInputs(tagOut, inPuts, mode, interval){\\r\\n    TagInputGroup myGroup = new TagInputGroup();\\r\\n    for (TagInput input: inPuts){\\r\\n        myGroup.add(input);\\r\\n        //context.info('bug: ', input);\\r\\n    }\\r\\n    myGroup.alignData(mode, '', interval);\\r\\n    for (Data x: myGroup.getTotalIntervals()){\\r\\n        //context.info('bug: ', x);\\r\\n        tagOut.add(x);\\r\\n    }\\r\\n}\\r\\n//Region specific calls\\r\\ncrunchInputs(K31_33CombinedFlow, [K31, K32, K33], 'total', 'PT2M');\\r\\ncrunchInputs(K34_36CombinedFlow, [K34, K36], 'total', 'PT2M');\",\n    \"version\" : 1,\n    \"start\" : \"2009-06-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",K31,K33,K32,__results__,K34,K36\",\n    \"outputs\" : \",K34_36CombinedFlow,K31_33CombinedFlow\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"37a8282e-1d5e-47e0-830f-e429e42e02c0\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.K31_33CombinedFlow\",\"name\":\"K31_33CombinedFlow\",\"type\":\"tag\",\"description\":\"combined flow for K31, K32, K33\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":1}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K34_36CombinedFlow\",\"name\":\"K34_36CombinedFlow\",\"type\":\"tag\",\"description\":\"Combined flow for K34, K36\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":1}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_ManaheimCombinedFlowTags\",\n  \"description\" : \"Calculation to combine tags for flow summary\",\n  \"schedule\" : \"0 1 * * *\",\n  \"lastRunMessage\" : \"d304801b-ef56-4469-8474-af3c2c1df8f9\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR1.SR01ASR01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"ASR1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.SR01ASR01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.SR02ASR02FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"ASR2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.SR02ASR02FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.SR03ASR03FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"ASR3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.SR03ASR03FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.SR04ASR04FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"ASR4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.SR04ASR04FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.SR05ASR05FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"ASR5\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.SR05ASR05FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K21W0021FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K21\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K21W0021FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K21W021AFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K21A\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K21W021AFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K23TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K23\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K23TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K24TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K24\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K25TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K25\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K25TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K26W0026FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K26\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K26W0026FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K29TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K29\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K29TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K91W0091FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K91\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K91W0091FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K91W0092FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K92\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K91W0092FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K93W0093FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K93\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K93W0093FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K93W0094FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K94\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K93W0094FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.RW02RCW02FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"RCW2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.RW02RCW02FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.SR04RCW03FIC1QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"RCW3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.SR04RCW03FIC1QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.RW02RCW04FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"RCW4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.RW02RCW04FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.ASR1_2_3RCW_1_2CombinedFlow\",\n    \"name\" : \"ASR1_2_3RCW_1_2CombinedFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"ASR1, 2, 3 RCW1, 2 combined flow\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.ManaheimKSitesCombinedFlow\",\n    \"name\" : \"ManaheimKSitesCombinedFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"K21,23,24,25,26,29,91,92,93,94 combined flow\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"def crunchInputs(tagOut, inPuts, mode, interval){\\r\\n    TagInputGroup myGroup = new TagInputGroup();\\r\\n    for (TagInput input: inPuts){\\r\\n        myGroup.add(input);\\r\\n        //context.info('bug: ', input);\\r\\n    }\\r\\n    myGroup.alignData(mode, '', interval);\\r\\n    for (Data x: myGroup.getTotalIntervals()){\\r\\n        //context.info('bug: ', x);\\r\\n        tagOut.add(x);\\r\\n    }\\r\\n}\\r\\n//Region specific calls\\r\\ncrunchInputs(ManaheimKSitesCombinedFlow, [K21,K21A,K25,K29,K23,K24,K26,K91,K92,K93,K94], 'total', 'PT2M');\\r\\ncrunchInputs(ASR1_2_3RCW_1_2CombinedFlow, [ASR1,ASR2,ASR3,ASR4,ASR5,RCW2,RCW3,RCW4], 'total', 'PT2M');\",\n    \"version\" : 1,\n    \"start\" : \"2009-07-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",K91,K93,K92,K94,RCW4,ASR4,RCW2,ASR5,K21,RCW3,ASR2,K24,ASR3,K23,K26,ASR1,K25,K29,K21A,__results__\",\n    \"outputs\" : \",ManaheimKSitesCombinedFlow,ASR1_2_3RCW_1_2CombinedFlow\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"d304801b-ef56-4469-8474-af3c2c1df8f9\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.ASR1_2_3RCW_1_2CombinedFlow\",\"name\":\"ASR1_2_3RCW_1_2CombinedFlow\",\"type\":\"tag\",\"description\":\"ASR1, 2, 3 RCW1, 2 combined flow\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.ManaheimKSitesCombinedFlow\",\"name\":\"ManaheimKSitesCombinedFlow\",\"type\":\"tag\",\"description\":\"K21,23,24,25,26,29,91,92,93,94 combined flow\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"f8578a83-3976-4665-85cc-a96f3de701eb\",\"source\":\"EEI_ManaheimCombinedFlowTags\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_MannheimExceedances_Discharge\",\n  \"description\" : \"\",\n  \"schedule\" : \"5 1 * * *\",\n  \"lastRunMessage\" : \"f88ce7e4-4c75-4c38-b957-db8b18a1af77\",\n  \"constant\" : [ \"ASR1MDWL\", \"ASR2MDWL\", \"ASR3MDWL\", \"ASR4MDWL\", \"K23MDWL\", \"K24MDWL\", \"K25MDWL\", \"K26MDWL\", \"K29MDWL\", \"RCW2MDWL\", \"K21AMDWL\", \"K21MDWL\", \"ASR5MDWL\", \"RCW3MDWL\", \"RCW4MDWL\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR1.SR01ASR01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"ASR1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.SR01ASR01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.SR02ASR02FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"ASR2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.SR02ASR02FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.SR03ASR03FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"ASR3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.SR03ASR03FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.SR04ASR04FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"ASR4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.SR04ASR04FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.SR05ASR05FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"ASR5\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.SR05ASR05FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K21W0021FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K21\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K21W0021FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K21W021AFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K21A\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K21W021AFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K23TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K23\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K23TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K24TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K24\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K25TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K25\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K25TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K26W0026FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K26\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K26W0026FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K29TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K29\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K29TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.RW02RCW02FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"RCW2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.RW02RCW02FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.SR04RCW03FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"RCW3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.SR04RCW03FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.RW02RCW04FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"RCW4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.RW02RCW04FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.ASR1MDWL\",\n    \"name\" : \"ASR1MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.ASR2MDWL\",\n    \"name\" : \"ASR2MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.ASR3MDWL\",\n    \"name\" : \"ASR3MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.ASR4MDWL\",\n    \"name\" : \"ASR4MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.ASR5MDWL\",\n    \"name\" : \"ASR5MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K21AMDWL\",\n    \"name\" : \"K21AMDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K21MDWL\",\n    \"name\" : \"K21MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K23MDWL\",\n    \"name\" : \"K23MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K24MDWL\",\n    \"name\" : \"K24MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K25MDWL\",\n    \"name\" : \"K25MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K26MDWL\",\n    \"name\" : \"K26MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K29MDWL\",\n    \"name\" : \"K29MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.RCW2MDWL\",\n    \"name\" : \"RCW2MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.RCW3MDWL\",\n    \"name\" : \"RCW3MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.RCW4MDWL\",\n    \"name\" : \"RCW4MDWL\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//FOR THIS CALCULATION TO WORK all inputs, outputs, and constants must follow the following naming convention\\r\\n// FOR EACH SITE - Two output tags are required:\\r\\n//output name must be: SITE (i.e. K33Flow) and 'SITE' + 'Constant' (i.e. K33Constant)\\r\\n//input name must be :'SITE' + 'Flow' (i.e. K33Flow)\\r\\n//constant name must be: 'SITE' + 'TYPE' - where type is PTTW, Discharge, MDWL\\r\\n//input name must be: SITE\\r\\n\\r\\n/****FUNCTIONS*******/\\r\\n\\r\\ndef findInputs(output, typeString){\\r\\n    for (TagInput input: inputs){\\r\\n        if (input.name + typeString == output.name){\\r\\n            return input;\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef findConstants(output){\\r\\n    BigDecimal smallest = null;\\r\\n    ConstantInput toReturn = null;\\r\\n    for (ConstantInput con: constants){\\r\\n        //context.info(\\\"Debug:\\\", con.name + \\\" \\\" + con.value);\\r\\n        if(output.name == con.name ){\\r\\n            //context.info(\\\"Debug:\\\", \\\"added \\\" + con.name);\\r\\n            toReturn = con;\\r\\n        }\\r\\n    }\\r\\n    return toReturn;\\r\\n}\\r\\n\\r\\ndef makeRunSet(output, typeString){\\r\\n    if (output != null){\\r\\n        //context.info(\\\"Debug:\\\", \\\"Finding inputs for: \\\"+output.name);\\r\\n        con = findConstants(output);\\r\\n        input = findInputs(output, typeString);\\r\\n        if (con != null && input != null){\\r\\n            //context.info(\\\"Debug:\\\", output.name + input.name + con.name);\\r\\n            return [output, input, con];\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef addOverFlowData(outputTag, inputTag, constantTag){\\r\\n\\tcon = constantTag.value;\\r\\n\\tBoolean eventFlag = false;\\r\\n\\tBigDecimal eventStart = 0.0;\\r\\n\\teventDate = null;\\r\\n\\tBigDecimal eventEnd = 0.0;\\r\\n\\tBigDecimal eventDuration = 0.0;\\r\\n        //context.info(outputTag);\\r\\n\\tfor (Data myData : inputTag.array){\\r\\n\\t    if (myData.value != null && myData.value >= con && eventFlag == false){\\r\\n\\t\\t\\t//note datetime\\r\\n\\t\\t\\teventStart = myData.timeInSeconds;\\r\\n\\t\\t\\teventDate = myData.time;\\r\\n\\t\\t\\teventFlag = true;\\r\\n\\t\\t}\\r\\n\\t\\telse if (myData.value != null && myData.value < con && eventFlag == true){\\r\\n\\t\\t\\t//note endTime\\r\\n\\t\\t\\teventEnd = myData.timeInSeconds;\\r\\n\\t\\t\\teventDuration = (eventEnd - eventStart)/60;\\r\\n\\t\\t\\t//add data\\r\\n\\t\\t\\tDate date = new Date();\\r\\n\\t\\t\\toutData = eventDate + \\\":\\\" + eventDuration.toString();\\r\\n\\t\\t\\t//context.info(outputTag.name + \\\":\\\", date + \\\",\\\" + outData);\\r\\n            outputTag.add(new Data(eventDate, eventDuration, 100));\\r\\n\\t\\t\\teventFlag = false;\\r\\n\\t\\t}\\r\\n\\t}\\t\\r\\n}\\r\\n\\r\\ndef calcRunner(typeString){\\r\\n\\tArrayList toRun = new ArrayList();\\r\\n    var runSet = [];\\r\\n\\tfor (TagOutput output: outputs){\\r\\n        output.deleteData(ASR1.startDate,ASR1.endDate);\\r\\n        runSet = makeRunSet(output, typeString);\\r\\n        if (runSet != null){\\r\\n\\t\\t\\ttoRun.add(runSet);\\r\\n        }\\r\\n\\t}\\r\\n\\tfor (x : toRun){\\r\\n        //context.info(\\\"Proof: \\\", x);\\r\\n        if (x != null){\\r\\n\\t\\t    //context.info(\\\"Proof: \\\", x[0].name + \\\" \\\" + x[1].name + \\\" \\\" + x[2].name);\\r\\n\\t\\t    addOverFlowData(x[0],x[1],x[2]);\\r\\n        }\\r\\n\\t}\\r\\n}\\r\\n/*******MAIN********/\\r\\n//calcRunner(\\\"PTTW\\\");\\r\\n//calcRunner(\\\"Discharge\\\");\\r\\ncalcRunner(\\\"MDWL\\\");\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2000-08-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",RCW4,ASR4,RCW2,ASR5,K21,RCW3,ASR2,K24,ASR3,K23,K26,ASR1,K25,K29,K21A,__results__\",\n    \"outputs\" : \",RCW4MDWL,K21AMDWL,K25MDWL,ASR3MDWL,K29MDWL,RCW3MDWL\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"f88ce7e4-4c75-4c38-b957-db8b18a1af77\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"ASR1MDWL\",\n  \"description\" : \"ASR1 MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 57,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"ASR2MDWL\",\n  \"description\" : \"ASR2 MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 37,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"ASR3MDWL\",\n  \"description\" : \"ASR3 MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 45,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"ASR4MDWL\",\n  \"description\" : \"ASR4 MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 62,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K23MDWL\",\n  \"description\" : \"K23 MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 49,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K24MDWL\",\n  \"description\" : \"K24 MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 59,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K25MDWL\",\n  \"description\" : \"K25 MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 75,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 112,\n    \"start\" : \"2023-06-09T00:00:00.000\",\n    \"end\" : null,\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"K26MDWL\",\n  \"description\" : \"K26 MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 95,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K29MDWL\",\n  \"description\" : \"K29 MDWL limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 57.95,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"RCW2MDWL\",\n  \"description\" : \"RCW2 MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 62,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K21AMDWL\",\n  \"description\" : \"K21A MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 24,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 49,\n    \"start\" : \"2013-04-01T00:00:00.000\",\n    \"end\" : \"2023-02-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"K21MDWL\",\n  \"description\" : \"K21 MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 30,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"ASR5MDWL\",\n  \"description\" : \"ASR5 MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 60,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"RCW3MDWL\",\n  \"description\" : \"RCW3 MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 28.5,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"RCW4MDWL\",\n  \"description\" : \"RCW4 MDWL Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 43,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.ASR1MDWL\",\"name\":\"ASR1MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.ASR2MDWL\",\"name\":\"ASR2MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.ASR3MDWL\",\"name\":\"ASR3MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.ASR4MDWL\",\"name\":\"ASR4MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.ASR5MDWL\",\"name\":\"ASR5MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K21AMDWL\",\"name\":\"K21AMDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K21MDWL\",\"name\":\"K21MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K23MDWL\",\"name\":\"K23MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K24MDWL\",\"name\":\"K24MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K25MDWL\",\"name\":\"K25MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K26MDWL\",\"name\":\"K26MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K29MDWL\",\"name\":\"K29MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.RCW2MDWL\",\"name\":\"RCW2MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.RCW3MDWL\",\"name\":\"RCW3MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.RCW4MDWL\",\"name\":\"RCW4MDWL\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"c5f1cf1c-0cf4-4557-82af-44508a96e343\",\"source\":\"EEI_MannheimExceedances_Discharge\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_MannheimExceedances_PTTW\",\n  \"description\" : \"Flow summary (PTTW) for Manaheim sites\",\n  \"schedule\" : \"5 1 * * *\",\n  \"lastRunMessage\" : \"1e428d2f-e267-449d-a72f-5e22ad462678\",\n  \"constant\" : [ \"HVLLPTTW\", \"K91PTTW\", \"K92PTTW\", \"K93PTTW\", \"K94PTTW\", \"ManaheimKSitesPTTW\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR1.HVLRWL1FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"HVLL\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K91W0091FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K91\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K91W0091FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.K91W0092FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"K92\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.K91W0092FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.KIWK093FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"K93\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.KIWK094FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"K94\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"ET.ManaheimKSitesCombinedFlow:raw:P1D\",\n    \"name\" : \"ManaheimKSites\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.HVLLPTTW\",\n    \"name\" : \"HVLLPTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K91PTTW\",\n    \"name\" : \"K91PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K92PTTW\",\n    \"name\" : \"K92PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K93PTTW\",\n    \"name\" : \"K93PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K94PTTW\",\n    \"name\" : \"K94PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.ManaheimKSitesPTTW\",\n    \"name\" : \"ManaheimKSitesPTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//FOR THIS CALCULATION TO WORK all inputs, outputs, and constants must follow the following naming convention\\r\\n// FOR EACH SITE - Two output tags are required:\\r\\n//output name must be: SITE (i.e. K33Flow) and 'SITE' + 'Constant' (i.e. K33Constant)\\r\\n//input name must be :'SITE' + 'Flow' (i.e. K33Flow)\\r\\n//constant name must be: 'SITE' + 'TYPE' - where type is PTTW, Discharge, MDWL\\r\\n//input name must be: SITE\\r\\n\\r\\n/****FUNCTIONS*******/\\r\\n\\r\\ndef findInputs(output, typeString){\\r\\n    for (TagInput input: inputs){\\r\\n        if (input.name + typeString == output.name){\\r\\n            return input;\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef findConstants(output){\\r\\n    BigDecimal smallest = null;\\r\\n    ConstantInput toReturn = null;\\r\\n    for (ConstantInput con: constants){\\r\\n        //context.info(\\\"Debug:\\\", con.name + \\\" \\\" + con.value);\\r\\n        if(output.name == con.name ){\\r\\n            //context.info(\\\"Debug:\\\", \\\"added \\\" + con.name);\\r\\n            toReturn = con;\\r\\n        }\\r\\n    }\\r\\n    return toReturn;\\r\\n}\\r\\n\\r\\ndef makeRunSet(output, typeString){\\r\\n    if (output != null){\\r\\n        //context.info(\\\"Debug:\\\", \\\"Finding inputs for: \\\"+output.name);\\r\\n        con = findConstants(output);\\r\\n        input = findInputs(output, typeString);\\r\\n        if (con != null && input != null){\\r\\n            //context.info(\\\"Debug:\\\", output.name + input.name + con.name);\\r\\n            return [output, input, con];\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef addOverFlowData(outputTag, inputTag, constantTag){\\r\\n\\tcon = constantTag.value;\\r\\n\\tBoolean eventFlag = false;\\r\\n\\tBigDecimal eventStart = 0.0;\\r\\n\\teventDate = null;\\r\\n\\tBigDecimal eventEnd = 0.0;\\r\\n\\tBigDecimal eventDuration = 0.0;\\r\\n    //context.info(outputTag);\\r\\n\\tfor (Data myData : inputTag.array){\\r\\n\\t    if (myData.value != null && myData.value >= con && eventFlag == false){\\r\\n\\t\\t\\t//note datetime\\r\\n\\t\\t\\teventStart = myData.timeInSeconds;\\r\\n\\t\\t\\teventDate = myData.time;\\r\\n\\t\\t\\teventFlag = true;\\r\\n\\t\\t}\\r\\n\\t\\telse if (myData.value != null && myData.value < con && eventFlag == true){\\r\\n\\t\\t\\t//note endTime\\r\\n\\t\\t\\teventEnd = myData.timeInSeconds;\\r\\n\\t\\t\\teventDuration = (eventEnd - eventStart)/60;\\r\\n\\t\\t\\t//add data\\r\\n\\t\\t\\tDate date = new Date();\\r\\n\\t\\t\\toutData = eventDate + \\\":\\\" + eventDuration.toString();\\r\\n\\t\\t\\t//context.info(outputTag.name + \\\":\\\", date + \\\",\\\" + outData);\\r\\n            outputTag.add(new Data(eventDate, eventDuration, 100));\\r\\n\\t\\t\\teventFlag = false;\\r\\n\\t\\t}\\r\\n\\t}\\t\\r\\n}\\r\\n\\r\\ndef calcRunner(typeString){\\r\\n\\tArrayList toRun = new ArrayList();\\r\\n    var runSet = [];\\r\\n\\tfor (TagOutput output: outputs){\\r\\n        runSet = makeRunSet(output, typeString);\\r\\n        if (runSet != null){\\r\\n\\t\\t\\ttoRun.add(runSet);\\r\\n        }\\r\\n\\t}\\r\\n\\tfor (x : toRun){\\r\\n        //context.info(\\\"Proof: \\\", x);\\r\\n        if (x != null){\\r\\n\\t\\t    //context.info(\\\"Proof: \\\", x[0].name + \\\" \\\" + x[1].name + \\\" \\\" + x[2].name);\\r\\n\\t\\t    addOverFlowData(x[0],x[1],x[2]);\\r\\n        }\\r\\n\\t}\\r\\n}\\r\\n/*******MAIN********/\\r\\ncalcRunner(\\\"PTTW\\\");\\r\\n//calcRunner(\\\"Discharge\\\");\\r\\n//calcRunner(\\\"MDWL\\\");\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-07-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",K91,K93,K92,K94,ManaheimKSites,HVLL,__results__\",\n    \"outputs\" : \",ManaheimKSitesPTTW\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"1e428d2f-e267-449d-a72f-5e22ad462678\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"HVLLPTTW\",\n  \"description\" : \"HVLL PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 840,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 50,\n    \"start\" : \"2022-08-26T00:00:00.000\",\n    \"end\" : null,\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"K91PTTW\",\n  \"description\" : \"K91 PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 40,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K92PTTW\",\n  \"description\" : \"K92 PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 50,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K93PTTW\",\n  \"description\" : \"K93 PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 50,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K94PTTW\",\n  \"description\" : \"K94 PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 50,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"ManaheimKSitesPTTW\",\n  \"description\" : \"K21, K21A, K23, K24, K25, K26, K29, K91, K92, K93, K94 Combined PTTW limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 471,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.HVLLPTTW\",\"name\":\"HVLLPTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K91PTTW\",\"name\":\"K91PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K92PTTW\",\"name\":\"K92PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K93PTTW\",\"name\":\"K93PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K94PTTW\",\"name\":\"K94PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.ManaheimKSitesPTTW\",\"name\":\"ManaheimKSitesPTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"0fab95c8-9ccb-45fc-a1ea-17554acc02a1\",\"source\":\"EEI_MannheimExceedances_PTTW\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_RuralCombinedFlowTags\",\n  \"description\" : \"calculation to combine tags for flow summary\",\n  \"schedule\" : \"0 1 * * *\",\n  \"lastRunMessage\" : \"6faf96aa-d860-4665-8f8c-2bb0a7b78dcc\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.BMSW0002FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"BM2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.BMSW0003FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"BM3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.BM2_BM3CombinedFlow\",\n    \"name\" : \"BM2_BM3CombinedFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"combined flow for BM2, BM3\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"def crunchInputs(tagOut, inPuts, mode, interval){\\r\\n    TagInputGroup myGroup = new TagInputGroup();\\r\\n    for (TagInput input: inPuts){\\r\\n        myGroup.add(input);\\r\\n        //context.info('bug: ', input);\\r\\n    }\\r\\n    myGroup.alignData(mode, '', interval);\\r\\n    for (Data x: myGroup.getTotalIntervals()){\\r\\n        //context.info('bug: ', x);\\r\\n        tagOut.add(x);\\r\\n    }\\r\\n}\\r\\n//Region specific calls\\r\\ncrunchInputs(BM2_BM3CombinedFlow, [BM2,BM3], 'total', 'PT2M');\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-08-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",BM2,BM3,__results__\",\n    \"outputs\" : \",BM2_BM3CombinedFlow\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"6faf96aa-d860-4665-8f8c-2bb0a7b78dcc\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.BM2_BM3CombinedFlow\",\"name\":\"BM2_BM3CombinedFlow\",\"type\":\"tag\",\"description\":\"combined flow for BM2, BM3\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_RuralExceedances_Discharge\",\n  \"description\" : \"\",\n  \"schedule\" : \"5 1 * * *\",\n  \"lastRunMessage\" : \"f186e69f-87d8-4d75-b2ef-d9d5a5137e12\",\n  \"constant\" : [ \"MH1_H2Discharge\", \"C5_6Discharge\", \"HD1_D2Discharge\", \"C3_4Discharge\", \"A1_2_3Discharge\", \"R5_6Discharge\", \"L1A_2Discharge\", \"WY1_5_6Discharge\", \"SC2_3_4Discharge\", \"NH3_4Discharge\", \"ND4_5Discharge\", \"FG1_2A_4Discharge\", \"BM2_3Discharge\", \"MH3_4ADischarge\", \"PE1Discharge\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.APSTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"A1_2_3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.APSTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.BMSTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"BM2_3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.CPSTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"C3_4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.CPSTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.CGSCNB0FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"C5_6\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.FGSTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"FG1_2A_4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.FGSTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.HEPTWL1FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"HD1_D2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.LINTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"L1A_2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.MYPTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"MH1_H2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.MVPTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"MH3_4A\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.NDPTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"ND4_5\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.NHPTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"NH3_4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.NHPTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.PETTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"PE1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.PETTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.RTPTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"R5_6\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.RTPTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.STCTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"SC2_3_4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.STCTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.WHPTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"WY1_5_6\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.A1_2_3Discharge\",\n    \"name\" : \"A1_2_3Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.BM2_3Discharge\",\n    \"name\" : \"BM2_3Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.C3_4Discharge\",\n    \"name\" : \"C3_4Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.C5_6Discharge\",\n    \"name\" : \"C5_6Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.FG1_2A_4Discharge\",\n    \"name\" : \"FG1_2A_4Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.HD1_D2Discharge\",\n    \"name\" : \"HD1_D2Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.L1A_2Discharge\",\n    \"name\" : \"L1A_2Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MH1_H2Discharge\",\n    \"name\" : \"MH1_H2Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MH3_4ADischarge\",\n    \"name\" : \"MH3_4ADischarge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.ND4_5Discharge\",\n    \"name\" : \"ND4_5Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.NH3_4Discharge\",\n    \"name\" : \"NH3_4Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.PE1Discharge\",\n    \"name\" : \"PE1Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 2\n  }, {\n    \"value\" : \"ET.R5_6Discharge\",\n    \"name\" : \"R5_6Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.SC2_3_4Discharge\",\n    \"name\" : \"SC2_3_4Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.WY1_5_6Discharge\",\n    \"name\" : \"WY1_5_6Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//FOR THIS CALCULATION TO WORK all inputs, outputs, and constants must follow the following naming convention\\r\\n// FOR EACH SITE - Two output tags are required:\\r\\n//output name must be: SITE (i.e. K33Flow) and 'SITE' + 'Constant' (i.e. K33Constant)\\r\\n//input name must be :'SITE' + 'Flow' (i.e. K33Flow)\\r\\n//constant name must be: 'SITE' + 'TYPE' - where type is PTTW, Discharge, MDWL\\r\\n//input name must be: SITE\\r\\n\\r\\n/****FUNCTIONS*******/\\r\\n\\r\\ndef findInputs(output, typeString){\\r\\n    for (TagInput input: inputs){\\r\\n        if (input.name + typeString == output.name){\\r\\n            return input;\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef findConstants(output){\\r\\n    BigDecimal smallest = null;\\r\\n    ConstantInput toReturn = null;\\r\\n    for (ConstantInput con: constants){\\r\\n        //context.info(\\\"Debug:\\\", con.name + \\\" \\\" + con.value);\\r\\n        if(output.name == con.name ){\\r\\n            //context.info(\\\"Debug:\\\", \\\"added \\\" + con.name);\\r\\n            toReturn = con;\\r\\n        }\\r\\n    }\\r\\n    return toReturn;\\r\\n}\\r\\n\\r\\ndef makeRunSet(output, typeString){\\r\\n    if (output != null){\\r\\n        //context.info(\\\"Debug:\\\", \\\"Finding inputs for: \\\"+output.name);\\r\\n        con = findConstants(output);\\r\\n        input = findInputs(output, typeString);\\r\\n        if (con != null && input != null){\\r\\n            //context.info(\\\"Debug:\\\", output.name + input.name + con.name);\\r\\n            return [output, input, con];\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef addOverFlowData(outputTag, inputTag, constantTag){\\r\\n\\tcon = constantTag.value;\\r\\n\\tBoolean eventFlag = false;\\r\\n\\tBigDecimal eventStart = 0.0;\\r\\n\\teventDate = null;\\r\\n\\tBigDecimal eventEnd = 0.0;\\r\\n\\tBigDecimal eventDuration = 0.0;\\r\\n        //context.info(outputTag);\\r\\n\\tfor (Data myData : inputTag.array){\\r\\n\\t    if (myData.value != null && myData.value >= con && eventFlag == false){\\r\\n\\t\\t\\t//note datetime\\r\\n\\t\\t\\teventStart = myData.timeInSeconds;\\r\\n\\t\\t\\teventDate = myData.time;\\r\\n\\t\\t\\teventFlag = true;\\r\\n\\t\\t}\\r\\n\\t\\telse if (myData.value != null && myData.value < con && eventFlag == true){\\r\\n\\t\\t\\t//note endTime\\r\\n\\t\\t\\teventEnd = myData.timeInSeconds;\\r\\n\\t\\t\\teventDuration = (eventEnd - eventStart)/60;\\r\\n\\t\\t\\t//add data\\r\\n\\t\\t\\tDate date = new Date();\\r\\n\\t\\t\\toutData = eventDate + \\\":\\\" + eventDuration.toString();\\r\\n\\t\\t\\t//context.info(outputTag.name + \\\":\\\", date + \\\",\\\" + outData);\\r\\n            outputTag.add(new Data(eventDate, eventDuration, 100));\\r\\n\\t\\t\\teventFlag = false;\\r\\n\\t\\t}\\r\\n\\t}\\t\\r\\n}\\r\\n\\r\\ndef calcRunner(typeString){\\r\\n\\tArrayList toRun = new ArrayList();\\r\\n    var runSet = [];\\r\\n\\tfor (TagOutput output: outputs){\\r\\n        runSet = makeRunSet(output, typeString);\\r\\n        if (runSet != null){\\r\\n\\t\\t\\ttoRun.add(runSet);\\r\\n        }\\r\\n\\t}\\r\\n\\tfor (x : toRun){\\r\\n        //context.info(\\\"Proof: \\\", x);\\r\\n        if (x != null){\\r\\n\\t\\t    //context.info(\\\"Proof: \\\", x[0].name + \\\" \\\" + x[1].name + \\\" \\\" + x[2].name);\\r\\n\\t\\t    addOverFlowData(x[0],x[1],x[2]);\\r\\n        }\\r\\n\\t}\\r\\n}\\r\\n/*******MAIN********/\\r\\n//calcRunner(\\\"PTTW\\\");\\r\\ncalcRunner(\\\"Discharge\\\");\\r\\n//calcRunner(\\\"MDWL\\\");\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-08-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",MH1_H2,MH3_4A,NH3_4,WY1_5_6,L1A_2,HD1_D2,SC2_3_4,FG1_2A_4,C5_6,C3_4,R5_6,__results__,PE1,A1_2_3,BM2_3,ND4_5\",\n    \"outputs\" : \",MH3_4ADischarge,PE1Discharge,BM2_3Discharge,FG1_2A_4Discharge,MH1_H2Discharge,ND4_5Discharge,C3_4Discharge,L1A_2Discharge\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"f186e69f-87d8-4d75-b2ef-d9d5a5137e12\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MH1_H2Discharge\",\n  \"description\" : \"MH1_H2 Discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 4.5,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"C5_6Discharge\",\n  \"description\" : \"C5, C6 combined Discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 14.25,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"HD1_D2Discharge\",\n  \"description\" : \"HD1_D2 Discharge Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 24,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"C3_4Discharge\",\n  \"description\" : \"C3, C4 combined Discharge\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 23.75,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"A1_2_3Discharge\",\n  \"description\" : \"A1, A2, A3 Discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 190,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"R5_6Discharge\",\n  \"description\" : \"R5, R6 combined discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 14.25,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"L1A_2Discharge\",\n  \"description\" : \"L1A_2 Discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 19,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"WY1_5_6Discharge\",\n  \"description\" : \"WY1, WY5 and WY6 discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 123.5,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"SC2_3_4Discharge\",\n  \"description\" : \"SC2, SC3, SC4 combined discharge\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 142.5,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"NH3_4Discharge\",\n  \"description\" : \"NH3, NH4 combined discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 95,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"ND4_5Discharge\",\n  \"description\" : \"ND4, ND5 combined Discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 33.25,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"FG1_2A_4Discharge\",\n  \"description\" : \"FG1_2A_4 Discharge Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 14.25,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"BM2_3Discharge\",\n  \"description\" : \"overflow limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 4.5,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MH3_4ADischarge\",\n  \"description\" : \"overflow limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 9.3,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"PE1Discharge\",\n  \"description\" : \"PE1 Discharge Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 4.3,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.A1_2_3Discharge\",\"name\":\"A1_2_3Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.BM2_3Discharge\",\"name\":\"BM2_3Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.C3_4Discharge\",\"name\":\"C3_4Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.C5_6Discharge\",\"name\":\"C5_6Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.FG1_2A_4Discharge\",\"name\":\"FG1_2A_4Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.HD1_D2Discharge\",\"name\":\"HD1_D2Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.L1A_2Discharge\",\"name\":\"L1A_2Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MH1_H2Discharge\",\"name\":\"MH1_H2Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MH3_4ADischarge\",\"name\":\"MH3_4ADischarge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.ND4_5Discharge\",\"name\":\"ND4_5Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.NH3_4Discharge\",\"name\":\"NH3_4Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.PE1Discharge\",\"name\":\"PE1Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":2}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.R5_6Discharge\",\"name\":\"R5_6Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.SC2_3_4Discharge\",\"name\":\"SC2_3_4Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.WY1_5_6Discharge\",\"name\":\"WY1_5_6Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"9ab854fb-a316-41e5-9349-ba506527585d\",\"source\":\"EEI_RuralExceedances_Discharge\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_RuralExceedances_PTTW\",\n  \"description\" : \"Flow summary (PTTW) for rural sites\",\n  \"schedule\" : \"5 1 * * *\",\n  \"lastRunMessage\" : \"72132d94-5f47-42c3-894a-eafd529ee3ec\",\n  \"constant\" : [ \"MH1_H2PTTW\", \"C5_6PTTW\", \"C3_4PTTW\", \"A1_2_3PTTW\", \"R5_6PTTW\", \"L1A_2PTTW\", \"WY1_5_6PTTW\", \"SC2_3_4PTTW\", \"NH3_4PTTW\", \"ND4_5PTTW\", \"FG1_2A_4PTTW\", \"HD1_D2PTTW\", \"MH3_4APTTW\", \"BM1_2PTTW\", \"BM2_3PTTW\", \"PE1PTTW\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.ATPWELLFXQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"A1_2_3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"ET.BM2_BM3CombinedFlow:raw:P1D\",\n    \"name\" : \"BM2_3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.CPSWELLFXQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"C3_4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.CGSWELLFXQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"C5_6\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.FGSW000XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"FG1_2A_4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.FGSW000XFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.HEPHD00FXQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"HD1_D2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.LINW000XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"L1A_2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.MYPW000XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"MH1_H2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.MVPW000XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"MH3_4A\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.NDPW000XFI01QFL.F_CV:rawByTime:P1D\",\n    \"name\" : \"ND4_5\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.NHWW000XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"NH3_4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.NHWW000XFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.PETW0001FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"PE1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.PETW0001FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.RTPW000XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"R5_6\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.RTPW000XFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.STCW000XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"SC2_3_4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.STCW000XFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.WHPW000XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"WY1_5_6\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.A1_2_3PTTW\",\n    \"name\" : \"A1_2_3PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.BM2_3PTTW\",\n    \"name\" : \"BM2_3PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.C3_4PTTW\",\n    \"name\" : \"C3_4PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.C5_6PTTW\",\n    \"name\" : \"C5_6PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.FG1_2A_4PTTW\",\n    \"name\" : \"FG1_2A_4PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.HD1_D2PTTW\",\n    \"name\" : \"HD1_D2PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.L1A_2PTTW\",\n    \"name\" : \"L1A_2PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MH1_H2PTTW\",\n    \"name\" : \"MH1_H2PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.MH3_4APTTW\",\n    \"name\" : \"MH3_4APTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.ND4_5PTTW\",\n    \"name\" : \"ND4_5PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.NH3_4PTTW\",\n    \"name\" : \"NH3_4PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.PE1PTTW\",\n    \"name\" : \"PE1PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 2\n  }, {\n    \"value\" : \"ET.R5_6PTTW\",\n    \"name\" : \"R5_6PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.SC2_3_4PTTW\",\n    \"name\" : \"SC2_3_4PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.WY1_5_6PTTW\",\n    \"name\" : \"WY1_5_6PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//FOR THIS CALCULATION TO WORK all inputs, outputs, and constants must follow the following naming convention\\r\\n// FOR EACH SITE - Two output tags are required:\\r\\n//output name must be: SITE (i.e. K33Flow) and 'SITE' + 'Constant' (i.e. K33Constant)\\r\\n//input name must be :'SITE' + 'Flow' (i.e. K33Flow)\\r\\n//constant name must be: 'SITE' + 'TYPE' - where type is PTTW, Discharge, MDWL\\r\\n//input name must be: SITE\\r\\n\\r\\n/****FUNCTIONS*******/\\r\\n\\r\\ndef findInputs(output, typeString){\\r\\n    for (TagInput input: inputs){\\r\\n        if (input.name + typeString == output.name){\\r\\n            return input;\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef findConstants(output){\\r\\n    BigDecimal smallest = null;\\r\\n    ConstantInput toReturn = null;\\r\\n    for (ConstantInput con: constants){\\r\\n        //context.info(\\\"Debug:\\\", con.name + \\\" \\\" + con.value);\\r\\n        if(output.name == con.name ){\\r\\n            //context.info(\\\"Debug:\\\", \\\"added \\\" + con.name);\\r\\n            toReturn = con;\\r\\n        }\\r\\n    }\\r\\n    return toReturn;\\r\\n}\\r\\n\\r\\ndef makeRunSet(output, typeString){\\r\\n    if (output != null){\\r\\n        //context.info(\\\"Debug:\\\", \\\"Finding inputs for: \\\"+output.name);\\r\\n        con = findConstants(output);\\r\\n        input = findInputs(output, typeString);\\r\\n        if (con != null && input != null){\\r\\n            //context.info(\\\"Debug:\\\", output.name + input.name + con.name);\\r\\n            return [output, input, con];\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef addOverFlowData(outputTag, inputTag, constantTag){\\r\\n\\tcon = constantTag.value;\\r\\n\\tBoolean eventFlag = false;\\r\\n\\tBigDecimal eventStart = 0.0;\\r\\n\\teventDate = null;\\r\\n\\tBigDecimal eventEnd = 0.0;\\r\\n\\tBigDecimal eventDuration = 0.0;\\r\\n    //context.info(outputTag);\\r\\n\\tfor (Data myData : inputTag.array){\\r\\n\\t    if (myData.value != null && myData.value >= con && eventFlag == false){\\r\\n\\t\\t\\t//note datetime\\r\\n\\t\\t\\teventStart = myData.timeInSeconds;\\r\\n\\t\\t\\teventDate = myData.time;\\r\\n\\t\\t\\teventFlag = true;\\r\\n\\t\\t}\\r\\n\\t\\telse if (myData.value != null && myData.value < con && eventFlag == true){\\r\\n\\t\\t\\t//note endTime\\r\\n\\t\\t\\teventEnd = myData.timeInSeconds;\\r\\n\\t\\t\\teventDuration = (eventEnd - eventStart)/60;\\r\\n\\t\\t\\t//add data\\r\\n\\t\\t\\tDate date = new Date();\\r\\n\\t\\t\\toutData = eventDate + \\\":\\\" + eventDuration.toString();\\r\\n\\t\\t\\t//context.info(outputTag.name + \\\":\\\", date + \\\",\\\" + outData);\\r\\n            outputTag.add(new Data(eventDate, eventDuration, 100));\\r\\n\\t\\t\\teventFlag = false;\\r\\n\\t\\t}\\r\\n\\t}\\t\\r\\n}\\r\\n\\r\\ndef calcRunner(typeString){\\r\\n\\tArrayList toRun = new ArrayList();\\r\\n    var runSet = [];\\r\\n\\tfor (TagOutput output: outputs){\\r\\n        runSet = makeRunSet(output, typeString);\\r\\n        if (runSet != null){\\r\\n\\t\\t\\ttoRun.add(runSet);\\r\\n        }\\r\\n\\t}\\r\\n\\tfor (x : toRun){\\r\\n        //context.info(\\\"Proof: \\\", x);\\r\\n        if (x != null){\\r\\n\\t\\t    //context.info(\\\"Proof: \\\", x[0].name + \\\" \\\" + x[1].name + \\\" \\\" + x[2].name);\\r\\n\\t\\t    addOverFlowData(x[0],x[1],x[2]);\\r\\n        }\\r\\n\\t}\\r\\n}\\r\\n/*******MAIN********/\\r\\ncalcRunner(\\\"PTTW\\\");\\r\\n//calcRunner(\\\"Discharge\\\");\\r\\n//calcRunner(\\\"MDWL\\\");\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-07-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",MH1_H2,MH3_4A,NH3_4,WY1_5_6,L1A_2,HD1_D2,SC2_3_4,FG1_2A_4,C5_6,C3_4,R5_6,__results__,PE1,A1_2_3,BM2_3,ND4_5\",\n    \"outputs\" : \",BM2_3PTTW,PE1PTTW,WY1_5_6PTTW,MH1_H2PTTW,SC2_3_4PTTW,NH3_4PTTW\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"72132d94-5f47-42c3-894a-eafd529ee3ec\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MH1_H2PTTW\",\n  \"description\" : \"MH1_H2 PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 1.8,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"C5_6PTTW\",\n  \"description\" : \"C5, C6 PTTW combined limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 10.78,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"C3_4PTTW\",\n  \"description\" : \"C3, C4 combined PTTW limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 9.1,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"A1_2_3PTTW\",\n  \"description\" : \"A1, A2, A3 combined pttw\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 63.4,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"R5_6PTTW\",\n  \"description\" : \"R5, R6 PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 4.13,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"L1A_2PTTW\",\n  \"description\" : \"L1A_2 PTTW limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 12.1,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"WY1_5_6PTTW\",\n  \"description\" : \"WY1, WY5, WY6 combined PTTW limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 17.4,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"SC2_3_4PTTW\",\n  \"description\" : \"SC2, SC3, SC4 combined pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 20.5,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"NH3_4PTTW\",\n  \"description\" : \"NH3 ,NH4 combined discharge\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 41,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"ND4_5PTTW\",\n  \"description\" : \"ND4, ND5 combined PTTS limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 11.3,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"FG1_2A_4PTTW\",\n  \"description\" : \"FG1_2A_4 PTTW limit \",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 8.3,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"HD1_D2PTTW\",\n  \"description\" : \"HD1_D2 PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 15.9,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MH3_4APTTW\",\n  \"description\" : \"overflow pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 19,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"null","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"BM2_3PTTW\",\n  \"description\" : \"overflow limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 1.5,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"PE1PTTW\",\n  \"description\" : \"PE1 PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 4.3,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.A1_2_3PTTW\",\"name\":\"A1_2_3PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.BM2_3PTTW\",\"name\":\"BM2_3PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.C3_4PTTW\",\"name\":\"C3_4PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.C5_6PTTW\",\"name\":\"C5_6PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.FG1_2A_4PTTW\",\"name\":\"FG1_2A_4PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.HD1_D2PTTW\",\"name\":\"HD1_D2PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.L1A_2PTTW\",\"name\":\"L1A_2PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MH1_H2PTTW\",\"name\":\"MH1_H2PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MH3_4APTTW\",\"name\":\"MH3_4APTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.ND4_5PTTW\",\"name\":\"ND4_5PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.NH3_4PTTW\",\"name\":\"NH3_4PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.PE1PTTW\",\"name\":\"PE1PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":2}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.R5_6PTTW\",\"name\":\"R5_6PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.SC2_3_4PTTW\",\"name\":\"SC2_3_4PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.WY1_5_6PTTW\",\"name\":\"WY1_5_6PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"0a1d563a-ed48-42cb-9e42-adb1336127ab\",\"source\":\"EEI_RuralExceedances_PTTW\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_WaterlooExceedances_Discharge\",\n  \"description\" : \"Overflow summary (Discharge) for Waterloo sites\",\n  \"schedule\" : \"5 1 * * *\",\n  \"lastRunMessage\" : \"ea05cb52-bbdb-4f37-a8dc-3df452ef2c53\",\n  \"constant\" : [ \"W10Discharge\", \"W1B_1C_2Discharge\", \"W25Discharge\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR3.W10TWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"W10\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.W10TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.WSPWB00FXQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"W1B_1C_2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.WSPWB00FXQ01.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.LTPW0025FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"W25\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.LTPW0025FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.W10Discharge\",\n    \"name\" : \"W10Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.W1B_1C_2Discharge\",\n    \"name\" : \"W1B_1C_2Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.W25Discharge\",\n    \"name\" : \"W25Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//FOR THIS CALCULATION TO WORK all inputs, outputs, and constants must follow the following naming convention\\r\\n// FOR EACH SITE - Two output tags are required:\\r\\n//output name must be: SITE (i.e. K33Flow) and 'SITE' + 'Constant' (i.e. K33Constant)\\r\\n//input name must be :'SITE' + 'Flow' (i.e. K33Flow)\\r\\n//constant name must be: 'SITE' + 'TYPE' - where type is PTTW, Discharge, MDWL\\r\\n//input name must be: SITE\\r\\n\\r\\n/****FUNCTIONS*******/\\r\\n\\r\\ndef findInputs(output, typeString){\\r\\n    for (TagInput input: inputs){\\r\\n        if (input.name + typeString == output.name){\\r\\n            return input;\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef findConstants(output){\\r\\n    BigDecimal smallest = null;\\r\\n    ConstantInput toReturn = null;\\r\\n    for (ConstantInput con: constants){\\r\\n        //context.info(\\\"Debug:\\\", con.name + \\\" \\\" + con.value);\\r\\n        if(output.name == con.name ){\\r\\n            //context.info(\\\"Debug:\\\", \\\"added \\\" + con.name);\\r\\n            toReturn = con;\\r\\n        }\\r\\n    }\\r\\n    return toReturn;\\r\\n}\\r\\n\\r\\ndef makeRunSet(output, typeString){\\r\\n    if (output != null){\\r\\n        //context.info(\\\"Debug:\\\", \\\"Finding inputs for: \\\"+output.name);\\r\\n        con = findConstants(output);\\r\\n        input = findInputs(output, typeString);\\r\\n        if (con != null && input != null){\\r\\n            //context.info(\\\"Debug:\\\", output.name + input.name + con.name);\\r\\n            return [output, input, con];\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef addOverFlowData(outputTag, inputTag, constantTag){\\r\\n\\tcon = constantTag.value;\\r\\n\\tBoolean eventFlag = false;\\r\\n\\tBigDecimal eventStart = 0.0;\\r\\n\\teventDate = null;\\r\\n\\tBigDecimal eventEnd = 0.0;\\r\\n\\tBigDecimal eventDuration = 0.0;\\r\\n    context.info(outputTag);\\r\\n\\tfor (Data myData : inputTag.array){\\r\\n\\t    if (myData.value != null && myData.value >= con && eventFlag == false){\\r\\n\\t\\t\\t//note datetime\\r\\n\\t\\t\\teventStart = myData.timeInSeconds;\\r\\n\\t\\t\\teventDate = myData.time;\\r\\n\\t\\t\\teventFlag = true;\\r\\n\\t\\t}\\r\\n\\t\\telse if (myData.value != null && myData.value < con && eventFlag == true){\\r\\n\\t\\t\\t//note endTime\\r\\n\\t\\t\\teventEnd = myData.timeInSeconds;\\r\\n\\t\\t\\teventDuration = (eventEnd - eventStart)/60;\\r\\n\\t\\t\\t//add data\\r\\n\\t\\t\\tDate date = new Date();\\r\\n\\t\\t\\toutData = eventDate + \\\":\\\" + eventDuration.toString();\\r\\n\\t\\t\\t//context.info(outputTag.name + \\\":\\\", date + \\\",\\\" + outData);\\r\\n            outputTag.add(new Data(eventDate, eventDuration, 100));\\r\\n\\t\\t\\teventFlag = false;\\r\\n\\t\\t}\\r\\n\\t}\\t\\r\\n}\\r\\n\\r\\ndef calcRunner(typeString){\\r\\n\\tArrayList toRun = new ArrayList();\\r\\n    var runSet = [];\\r\\n\\tfor (TagOutput output: outputs){\\r\\n        runSet = makeRunSet(output, typeString);\\r\\n        if (runSet != null){\\r\\n\\t\\t\\ttoRun.add(runSet);\\r\\n        }\\r\\n\\t}\\r\\n\\tfor (x : toRun){\\r\\n        //context.info(\\\"Proof: \\\", x);\\r\\n        if (x != null){\\r\\n\\t\\t    //context.info(\\\"Proof: \\\", x[0].name + \\\" \\\" + x[1].name + \\\" \\\" + x[2].name);\\r\\n\\t\\t    addOverFlowData(x[0],x[1],x[2]);\\r\\n        }\\r\\n\\t}\\r\\n}\\r\\n/*******MAIN********/\\r\\n//calcRunner(\\\"PTTW\\\");\\r\\ncalcRunner(\\\"Discharge\\\");\\r\\n//calcRunner(\\\"MDWL\\\");\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-08-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",W1B_1C_2,W10,W25,__results__\",\n    \"outputs\" : \",W25Discharge\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"ea05cb52-bbdb-4f37-a8dc-3df452ef2c53\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"W10Discharge\",\n  \"description\" : \"W10 Discharge limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 25,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"W1B_1C_2Discharge\",\n  \"description\" : \"W1B, W1C, W2 Combined Discharge\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 285,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"W25Discharge\",\n  \"description\" : \"W25 Discharge Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 57,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.W10Discharge\",\"name\":\"W10Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.W1B_1C_2Discharge\",\"name\":\"W1B_1C_2Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.W25Discharge\",\"name\":\"W25Discharge\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"2f3dbc14-e616-434d-8c78-7e0c9630fd6d\",\"source\":\"EEI_WaterlooExceedances_Discharge\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_WaterlooExceedances_PTTW\",\n  \"description\" : \"Flow summary (PTTW and Discharge) for Waterloo sites\",\n  \"schedule\" : \"5 1 * * *\",\n  \"lastRunMessage\" : \"c98e0efa-dfa3-443c-adbf-a7f6d1e77d5a\",\n  \"constant\" : [ \"W6B_7_8PTTW\", \"W6BPTTW\", \"W7PTTW\", \"W8PTTW\", \"W1B_1C_2PTTW\", \"W1BPTTW\", \"W1CPTTW\", \"W2PTTW\", \"W25PTTW\", \"W6CPTTW\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR3.WSPW01BFIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"W1B\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.WSPW01CFIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"W1C\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.WSPW002FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"W2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.LTPW0025FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"W25\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.LTPW0025FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.W06W006BFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"W6B\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.W06W006BFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"ET.W6B_7_8CombinedFlow:raw:P1D\",\n    \"name\" : \"W6B_7_8\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.W06W006CFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"W6C\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.W06W006CFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.W07W0007FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"W7\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.W07W0007FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.W07W0008FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"W8\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.W07W0008FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.W1BPTTW\",\n    \"name\" : \"W1BPTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.W1CPTTW\",\n    \"name\" : \"W1CPTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.W25PTTW\",\n    \"name\" : \"W25PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.W2PTTW\",\n    \"name\" : \"W2PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.W6B_7_8PTTW\",\n    \"name\" : \"W6B_7_8PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.W6BPTTW\",\n    \"name\" : \"W6BPTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.W6CPTTW\",\n    \"name\" : \"W6CPTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.W7PTTW\",\n    \"name\" : \"W7PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.W8PTTW\",\n    \"name\" : \"W8PTTW\",\n    \"type\" : \"tag\",\n    \"description\" : \"overflow report value\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//VERSION 2! FOR THIS CALCULATION TO WORK all inputs, outputs, and constants must follow the following naming convention\\r\\n// FOR EACH SITE - Two output tags are required:\\r\\n//output name must be: SITE (i.e. K33Flow) and 'SITE' + 'Constant' (i.e. K33Constant)\\r\\n//input name must be :'SITE' + 'Flow' (i.e. K33Flow)\\r\\n//constant name must be: 'SITE' + 'TYPE' - where type is PTTW, Discharge, MDWL\\r\\n//input name must be: SITE\\r\\n\\r\\n/****FUNCTIONS*******/\\r\\n\\r\\ndef findInputs(output, typeString){\\r\\n    for (TagInput input: inputs){\\r\\n        if (input.name + typeString == output.name){\\r\\n            return input;\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef findConstants(output){\\r\\n    BigDecimal smallest = null;\\r\\n    ConstantInput toReturn = null;\\r\\n    for (ConstantInput con: constants){\\r\\n        //context.info(\\\"Debug:\\\", con.name + \\\" \\\" + con.value);\\r\\n        if(output.name == con.name ){\\r\\n            //context.info(\\\"Debug:\\\", \\\"added \\\" + con.name);\\r\\n            toReturn = con;\\r\\n        }\\r\\n    }\\r\\n    return toReturn;\\r\\n}\\r\\n\\r\\ndef makeRunSet(output, typeString){\\r\\n    if (output != null){\\r\\n        //context.info(\\\"Debug:\\\", \\\"Finding inputs for: \\\"+output.name);\\r\\n        con = findConstants(output);\\r\\n        input = findInputs(output, typeString);\\r\\n        if (con != null && input != null){\\r\\n            //context.info(\\\"Debug:\\\", output.name + input.name + con.name);\\r\\n            return [output, input, con];\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\ndef addOverFlowData(outputTag, inputTag, constantTag){\\r\\n\\tcon = constantTag.value;\\r\\n\\tBoolean eventFlag = false;\\r\\n\\tBigDecimal eventStart = 0.0;\\r\\n\\teventDate = null;\\r\\n\\tBigDecimal eventEnd = 0.0;\\r\\n\\tBigDecimal eventDuration = 0.0;\\r\\n    //context.info(outputTag);\\r\\n\\tfor (Data myData : inputTag.array){\\r\\n\\t    if (myData.value != null && myData.value >= con && eventFlag == false){\\r\\n\\t\\t\\t//note datetime\\r\\n\\t\\t\\teventStart = myData.timeInSeconds;\\r\\n\\t\\t\\teventDate = myData.time;\\r\\n\\t\\t\\teventFlag = true;\\r\\n\\t\\t}\\r\\n\\t\\telse if (myData.value != null && myData.value < con && eventFlag == true){\\r\\n\\t\\t\\t//note endTime\\r\\n\\t\\t\\teventEnd = myData.timeInSeconds;\\r\\n\\t\\t\\teventDuration = (eventEnd - eventStart)/60;\\r\\n\\t\\t\\t//add data\\r\\n\\t\\t\\tDate date = new Date();\\r\\n\\t\\t\\toutData = eventDate + \\\":\\\" + eventDuration.toString();\\r\\n\\t\\t\\t//context.info(outputTag.name + \\\":\\\", date + \\\",\\\" + outData);\\r\\n            outputTag.add(new Data(eventDate, eventDuration, 100));\\r\\n\\t\\t\\teventFlag = false;\\r\\n\\t\\t}\\r\\n\\t}\\t\\r\\n}\\r\\n\\r\\ndef calcRunner(typeString){\\r\\n\\tArrayList toRun = new ArrayList();\\r\\n    var runSet = [];\\r\\n\\tfor (TagOutput output: outputs){\\r\\n        runSet = makeRunSet(output, typeString);\\r\\n        if (runSet != null){\\r\\n\\t\\t\\ttoRun.add(runSet);\\r\\n        }\\r\\n\\t}\\r\\n\\tfor (x : toRun){\\r\\n       //context.info(\\\"Proof: \\\", x);\\r\\n        if (x != null){\\r\\n\\t\\t    //context.info(\\\"Proof: \\\", x[0].name + \\\" \\\" + x[1].name + \\\" \\\" + x[2].name);\\r\\n\\t\\t    addOverFlowData(x[0],x[1],x[2]);\\r\\n        }\\r\\n\\t}\\r\\n}\\r\\n/*******MAIN********/\\r\\ncalcRunner(\\\"PTTW\\\");\\r\\n//calcRunner(\\\"Discharge\\\");\\r\\n//calcRunner(\\\"MDWL\\\");\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-07-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",W7,W8,W6B,W6B_7_8,W6C,W1C,W1B,W2,W25,__results__\",\n    \"outputs\" : \",W25PTTW,W6CPTTW,W6B_7_8PTTW\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"c98e0efa-dfa3-443c-adbf-a7f6d1e77d5a\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"W6B_7_8PTTW\",\n  \"description\" : \"W6B, W7, W8 combined PTTW limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 199,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 52,\n    \"start\" : \"2024-10-15T00:00:00.000\",\n    \"end\" : null,\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"W6BPTTW\",\n  \"description\" : \"W6B PTTW Limit\",\n  \"units\" : \"l/s\",\n  \"defaultValue\" : 53,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"W7PTTW\",\n  \"description\" : \"W7 PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 106,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"W8PTTW\",\n  \"description\" : \"W8 PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 121,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"W1B_1C_2PTTW\",\n  \"description\" : \"W1B, W1C, W2 Combined PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 88,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"W1BPTTW\",\n  \"description\" : \"W1B PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 60,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"W1CPTTW\",\n  \"description\" : \"W1C PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 37,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"W2PTTW\",\n  \"description\" : \"W2 PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 83,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"W25PTTW\",\n  \"description\" : \"W25 pttw limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 60,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"W6CPTTW\",\n  \"description\" : \"W6C PTTW Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 35,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.W1BPTTW\",\"name\":\"W1BPTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.W1CPTTW\",\"name\":\"W1CPTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.W25PTTW\",\"name\":\"W25PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.W2PTTW\",\"name\":\"W2PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.W6B_7_8PTTW\",\"name\":\"W6B_7_8PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.W6BPTTW\",\"name\":\"W6BPTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.W6CPTTW\",\"name\":\"W6CPTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.W7PTTW\",\"name\":\"W7PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.W8PTTW\",\"name\":\"W8PTTW\",\"type\":\"tag\",\"description\":\"overflow report value\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"e6560e3b-f464-457b-861b-180bdea2e7bf\",\"source\":\"EEI_WaterlooExceedances_PTTW\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"EEI_WaterlooFlowCombinedTags\",\n  \"description\" : \"Calculation to combine tags for flow summary\",\n  \"schedule\" : \"0 1 * * *\",\n  \"lastRunMessage\" : \"bfed1f3d-dc6c-4e97-aa37-4eb91b4df93d\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR3.WSPW01BFIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"W1B\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.WSPW01CFIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"W1C\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.WSPW002FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"W2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR3.W06W000XFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"W6B\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.W06W000XFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.W07W0007FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"W7\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.W07W0007FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.W07W0008FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"W8\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.W07W0008FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.W1B_1C_2CombinedFlow\",\n    \"name\" : \"W1B_1C_2CombinedFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"W1B, W1C, W2 Combined Flow\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 1\n  }, {\n    \"value\" : \"ET.W6B_7_8CombinedFlow\",\n    \"name\" : \"W6B_7_8CombinedFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"W6B, W7, W8 Combined flow\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 1\n  } ],\n  \"code\" : [ {\n    \"value\" : \"def crunchInputs(tagOut, inPuts, mode, interval){\\r\\n    TagInputGroup myGroup = new TagInputGroup();\\r\\n    for (TagInput input: inPuts){\\r\\n        myGroup.add(input);\\r\\n        //context.info('bug: ', input);\\r\\n    }\\r\\n    myGroup.alignData(mode, '', interval);\\r\\n    for (Data x: myGroup.getTotalIntervals()){\\r\\n        //context.info('bug: ', x);\\r\\n        tagOut.add(x);\\r\\n    }\\r\\n}\\r\\n//Region specific calls\\r\\ncrunchInputs(W1B_1C_2CombinedFlow, [W1B, W1C, W2], 'total', 'PT2M');\\r\\ncrunchInputs(W6B_7_8CombinedFlow, [W6B, W7, W8], 'total', 'PT2M');\",\n    \"version\" : 1,\n    \"start\" : \"2009-07-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",W7,W8,W6B,W1C,W1B,W2,__results__\",\n    \"outputs\" : \",W6B_7_8CombinedFlow\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"bfed1f3d-dc6c-4e97-aa37-4eb91b4df93d\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.W1B_1C_2CombinedFlow\",\"name\":\"W1B_1C_2CombinedFlow\",\"type\":\"tag\",\"description\":\"W1B, W1C, W2 Combined Flow\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":1}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.W6B_7_8CombinedFlow\",\"name\":\"W6B_7_8CombinedFlow\",\"type\":\"tag\",\"description\":\"W6B, W7, W8 Combined flow\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":1}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"e9ed27c6-de68-404d-91a9-7afbf2d3e735\",\"source\":\"EEI_WaterlooFlowCombinedTags\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"esrMaxGapTime Rule\",\n  \"description\" : \"Returns the time corresponding to the beginning of the longest data gap in a day\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"5c52f953-04bd-4d39-9569-b2d44eca3cd3\",\n  \"constant\" : [ \"MaxGapMinutes\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MDPH.MDPSCDA.PTPCFR2AIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P3D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"Date lastGood = __source__.array[0].time;\\nlong maxGap=0;\\nString maxGapTime = null;\\nDate currentDay =  null;\\nint currentDayOfMonth = 0;\\nboolean isLastGood = true;\\nDate badStart = null;\\nList results = new ArrayList();\\nfor(Data data: __source__.data) {\\n    if (data.good) {\\n        Calendar cal2 = GregorianCalendar.getInstance();\\n        cal2.setTime(data.time);\\n        int dom2 = cal2.get(Calendar.DAY_OF_MONTH);\\n        // detect day change and reset...\\n        if (currentDayOfMonth == 0 || currentDayOfMonth != dom2) {\\n            if (currentDayOfMonth != 0 && maxGapTime != null) {\\n                results.add(new Data(currentDay, maxGapTime, 100));\\n            }\\n            currentDayOfMonth = dom2;\\n            currentDay = data.time;\\n            maxGapTime = null;\\n            maxGap = 0;\\n            lastGood = data.time;\\n            isLastGood = true;\\n        }\\n        if(currentDayOfMonth == dom2){\\n            isLastGood = true;\\n        }\\n        // determine gap..\\n        Date badEnd = data.time;\\n        //context.trace(\\\"Bad End: \\\"+badEnd);\\n        long l = badEnd.getTime() - lastGood.getTime();\\n        if (l > maxGap && l >= $(MaxGapMinutes) * 60 * 1000) {\\n            maxGap = l;\\n            SimpleDateFormat df =  new SimpleDateFormat(\\\"yyyy-MMM-dd HH:mm:ss\\\");\\n            maxGapTime = df.format(lastGood);\\n            //context.trace(\\\"MaxGapTime found: \\\"+maxGapTime);\\n        }\\n        if (isLastGood) {\\n            lastGood = data.time;\\n        }\\n    }\\n    else {\\n        isLastGood = false;\\n    }\\n    context.trace(\\\"LastGood:\\\" +lastGood);\\n}\\nif (currentDayOfMonth != 0 && maxGapTime != null) {\\n    results.add(new Data(currentDay, maxGapTime, 100));\\n}\\nfor (Data d: results) {\\n    //context.trace(d);\\n}\\n__source__.replace(results);\\n\",\n    \"version\" : 1,\n    \"start\" : \"2011-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"5c52f953-04bd-4d39-9569-b2d44eca3cd3\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2011-01-01T14:01:54.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MaxGapMinutes\",\n  \"description\" : \"Number of minutes to determine a data gap\",\n  \"units\" : \"min\",\n  \"defaultValue\" : 5,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Flow To Waste Flagging\",\n  \"description\" : \"Adds WST flag when flow is directed to waste\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"3e5766e2-7992-4c59-b116-f17771a36775\",\n  \"constant\" : [ \"FlowToWaste\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MTPH.MTPSCDA.WMHCFR3AIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"KWCRH.KWCR_WMHUV01OVMDI.F_CV:sample:PT2M\",\n    \"name\" : \"valve\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(__source__, valve, 30);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs) {\\n    //If valve status is set to waste\\n    if($(FlowToWaste)==pair.b.value){\\n        //Add Waste flag to primary tag\\n        pair.a.addFlag(\\\"WST\\\");\\n    }\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2014-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"3e5766e2-7992-4c59-b116-f17771a36775\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2014-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"FlowToWaste\",\n  \"description\" : \"Valve status value signifying flow to waste\",\n  \"units\" : \"\",\n  \"defaultValue\" : 2,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Flow Total Flagging\",\n  \"description\" : \"Flow Total Flagging Rule (Maximum and Minimum)\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"1792427b-310b-4745-bf9d-bfda3efedd35\",\n  \"constant\" : [ \"MV3MaxFlow\", \"MV3MinFlow\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MTPH.MTPSCDA.HRMMV03TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P2D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Iterate through each element of the input array\\nfor (Data PD: __source__.array){\\n    //If the value of the element is above threshold\\n    if(PD.value > $(MV3MaxFlow)) {\\n        //Apply \\\"MAX\\\" flag to data element\\n        PD.addFlag(\\\"MAX\\\");\\n    }\\n    //If the value of the element is below threshold\\n    if (PD.value < $(MV3MinFlow)) {\\n        //Apply \\\"MIN\\\" flag to data element\\n        PD.addFlag(\\\"MIN\\\");\\n    }\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2005-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"1792427b-310b-4745-bf9d-bfda3efedd35\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2005-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MV3MaxFlow\",\n  \"description\" : \"MV3 Maximum Daily Flow\",\n  \"units\" : \"m3\",\n  \"defaultValue\" : 30000,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MV3MinFlow\",\n  \"description\" : \"MV3 Minimum Daily Flow\",\n  \"units\" : \"m3\",\n  \"defaultValue\" : 7000,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Flow Total Flagging (Maximum only)\",\n  \"description\" : \"Flags only values in exceedence of maximum\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"d7ec47ed-6197-47cd-88fd-f2596fe64283\",\n  \"constant\" : [ \"MV3MaxFlow\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MTPH.MTPSCDA.KIWK021TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Iterate through each element of the input array\\nfor (Data PD: __source__.array){\\n    //If the value of the element is above threshold\\n    BigDecimal mV3MaxFlow = MV3MaxFlow.getValue(PD);\\n    if(PD.value > mV3MaxFlow) {\\n        //Apply \\\"MAX\\\" flag to data element\\n        PD.addFlag(\\\"MAX\\\");\\n    }\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2014-10-10T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"d7ec47ed-6197-47cd-88fd-f2596fe64283\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2005-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MV3MaxFlow\",\n  \"description\" : \"MV3 Maximum Daily Flow\",\n  \"units\" : \"m3\",\n  \"defaultValue\" : 30000,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"G Wells Addition\",\n  \"description\" : \"G1, G1A, G2, G3, G14 Well Flow Addition\",\n  \"schedule\" : \"0 1 * * *\",\n  \"lastRunMessage\" : \"008021e5-7a98-4f46-8d5f-6c989916c071\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MDPH.MDPSCDA.MDPG014FIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"inG14WellFIQ\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPG01AFIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"inG1AWellFIQ\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPG001FIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"inG1WellFIQ\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPG002FIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"inG2WellFIQ\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPG003FIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"inG3WellFIQ\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.GWellTotalFlow\",\n    \"name\" : \"outGWellTotal\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Variables\\r\\nint count = 0;\\r\\nBigDecimal total = 0;\\r\\n//\\r\\n//Fill gaps in data with quality of 0 and value of 0\\r\\ninG1WellFIQ.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\ninG1AWellFIQ.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\ninG2WellFIQ.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\ninG3WellFIQ.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\ninG14WellFIQ.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\n//Loop through values using G1 as main loop\\r\\nfor(Data tag : inG1WellFIQ.array){\\r\\n    //reset total variable to ensure proper total each loop\\r\\n    total = 0;\\r\\n    if(null != tag.value && 100 == tag.quality){\\r\\n        total += tag.value;\\r\\n    }\\r\\n    /*if(null != inG1AWellFIQ.asc[count].value && 100 == inG1AWellFIQ.asc[count].quality){\\r\\n        total += inG1AWellFIQ.asc[count].value;\\r\\n    }\\r\\n    if(null != inG2WellFIQ.asc[count].value && 100 == inG2WellFIQ.asc[count].quality){\\r\\n        total += inG2WellFIQ.asc[count].value;\\r\\n    }\\r\\n    if(null != inG3WellFIQ.asc[count].value && 100 == inG3WellFIQ.asc[count].quality){\\r\\n        total += inG3WellFIQ.asc[count].value;\\r\\n    }\\r\\n    if(null != inG14WellFIQ.asc[count].value && 100 == inG14WellFIQ.asc[count].quality){\\r\\n        total += inG14WellFIQ.asc[count].value;\\r\\n    }*/\\r\\n    //Output\\r\\n    outGWellTotal.add(new Data(tag.time, total, 100));\\r\\n    //Increase index\\r\\n    count++;\\r\\n}\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2017-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : false\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"008021e5-7a98-4f46-8d5f-6c989916c071\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2019-07-10T01:00:00.000\",\n  \"enabled\" : false,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.GWellTotalFlow\",\"name\":\"outGWellTotal\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"G5 Totalizer Value\",\n  \"description\" : \"Combining G5 Totalizer tags from MDPH and WATH\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"2d040c5e-e14c-4ec2-8a59-c3c81d0defb8\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MDPH.MDPSCDA.CBWG005TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"inTag1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"MDPH.MDPSCDA.CBWG005TT.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G05TWL01FI01QFL.F_CV:periodTotal:P1D\",\n    \"name\" : \"inTag2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G05TWL01FI01QFL.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.G5_Totalizer_Join\",\n    \"name\" : \"G5_Totalizer\",\n    \"type\" : \"tag\",\n    \"description\" : \"Joined G5 Totalizer WATH and MDPH\",\n    \"units\" : \"m3\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//inTag1 equals MDPH.MDPSCDA.CBWG005TT.F_CV\\r\\n//inTag2 equals WATH.MTPSVR2.G05TWL01FI01QFL.F_CV\\r\\nTagInputPair tip = new TagInputPair(inTag1, inTag2, \\\"PT1M\\\");\\r\\nfor(DataPair pair : tip.pairs){\\r\\n    if(pair.a.good && pair.b.good && pair.a.value == 0){ \\r\\n        pair.a.value = pair.b.value;\\r\\n    }\\r\\n}\\r\\n    \",\n    \"version\" : 1,\n    \"start\" : \"2021-10-19T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : false\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"2d040c5e-e14c-4ec2-8a59-c3c81d0defb8\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2021-10-19T10:43:06.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.G5_Totalizer_Join\",\"name\":\"G5_Totalizer\",\"type\":\"tag\",\"description\":\"Joined G5 Totalizer WATH and MDPH\",\"units\":\"m3\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Grand River Direct Flow Rate\",\n  \"description\" : \"Using Flow meter at HVL HVLRWL1FIT01\",\n  \"schedule\" : \"25 * * * *\",\n  \"lastRunMessage\" : \"6376643d-564f-4811-9e87-ef0dfaac5918\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"\",\n    \"version\" : 1,\n    \"start\" : \"2019-04-29T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : false,\n    \"enabled\" : false\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"6376643d-564f-4811-9e87-ef0dfaac5918\",\n  \"owner\" : \"ralbasel@regionofwaterloo.ca\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2019-04-29T14:23:21.000\",\n  \"enabled\" : false,\n  \"type\" : \"DIRECT\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Grand River Surface Combined Flow Rate\",\n  \"description\" : \"\",\n  \"schedule\" : \"25 * * * *\",\n  \"lastRunMessage\" : \"6d285d8c-a40a-4b69-acc0-1a158055c90c\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MTPH.MTPSCDA.MTPBLE1FIQ01.F_CV:rawByTime:PT1H\",\n    \"name\" : \"flowOne\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.MTPBLE2FIQ01.F_CV:rawByTime:PT1H\",\n    \"name\" : \"flowTwo\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MTPH.MTPSCDA.MTPBLE1FIQ__.F_CV\",\n    \"name\" : \"combFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT1H\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(flowOne, flowTwo, 10);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs) {\\n    Data tempOut = new Data (pair.a.time,pair.a.value+pair.b.value,(pair.a.quality+pair.b.quality)/2);\\n    combFlow.add(tempOut);\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2014-12-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",flowOne,flowTwo,__results__\",\n    \"outputs\" : \",combFlow\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"6d285d8c-a40a-4b69-acc0-1a158055c90c\",\n  \"owner\" : \"ralbasel@regionofwaterloo.ca\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MTPH.MTPSCDA.MTPBLE1FIQ__.F_CV\",\"name\":\"combFlow\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT1H\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Hallman/Z6T_Total\",\n  \"description\" : \"Hallman/ Z6T Pumpage Total\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"9e7c1af9-d019-48c6-8292-cef1f0493b4e\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR3.Z6TETK01FI03QFL.F_CV:periodTotal:P1M\",\n    \"name\" : \"Tag26\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.Z6TETK01FI03QFL.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.MV2VCH02FI01QFL.F_CV:periodTotal:P1M\",\n    \"name\" : \"Tag27\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.MV2VCH02FI01QFL.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.MV3VCH03FI01QFL.F_CV:periodTotal:P1M\",\n    \"name\" : \"Tag28\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.MV3VCH03FI01QFL.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1M\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.HALLMAN_Z6T_TOTAL\",\n    \"name\" : \"Hallman\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"-PT0S\",\n    \"scale\" : 3\n  } ],\n  \"code\" : [ {\n    \"value\" : \"BigDecimal sum = 0;\\r\\nif (null != Tag26.value && Tag26.quality == 100){\\r\\n    sum = sum + Tag26.value;\\r\\n}\\r\\nif (null != Tag27.value && Tag27.quality == 100){\\r\\n    sum = sum + Tag27.value;\\r\\n}\\r\\nif (null != Tag28.value && Tag28.quality == 100){\\r\\n    sum = sum + Tag28.value;\\r\\n}\\r\\nHallman = sum\",\n    \"version\" : 1,\n    \"start\" : \"2015-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"9e7c1af9-d019-48c6-8292-cef1f0493b4e\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2015-11-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"DIRECT\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.HALLMAN_Z6T_TOTAL\",\"name\":\"Hallman\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"-PT0S\",\"scale\":3}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"e234281a-b879-4494-99a0-6c5630290149\",\"source\":\"Hallman/Z6T_Total\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"High CCL Flagging\",\n  \"description\" : \"Adds CCL flag when value exceeds CCL limit when flow is present\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"6634beea-ae9b-449b-9f79-2e69bd17f150\",\n  \"constant\" : [ \"MannheimTurbHI\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MTPH.MTPSCDA.MTPFL04NIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(__source__, second, 30);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs) {\\n    //If secondary tag value (flow) is greater than the no flow threshold\\n    if($(NoFlowThreshold)<=pair.b.value){\\n        //If the primary tag value is greater than the critical control limit\\n        if($(MannheimTurbHI)<=pair.a.value){\\n            //Add CCL flag to primary tag\\n            pair.a.addFlag(\\\"CCL\\\");\\n        }\\n    }\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"//Iterate through each element of the input array\\r\\nforeach(element:__source__.array){\\r\\n    if(100 == element.quality){\\r\\n    //If value is above CCL limit\\r\\n    if($(MannheimTurbHI)<=element.value){\\r\\n        //Check if SNF flag or WST flag has already been applied\\r\\n        if(!element.flags.contains(\\\"SNF\\\")&&!element.flags.contains(\\\"WST\\\")){\\r\\n            //If not, apply CCL flag\\r\\n            element.addFlag(\\\"CCL\\\");\\r\\n        }\\r\\n    }\\r\\n    }\\r\\n}\\r\\n\",\n    \"version\" : 2,\n    \"start\" : \"2014-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"6634beea-ae9b-449b-9f79-2e69bd17f150\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2014-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MannheimTurbHI\",\n  \"description\" : \"Mannheim turbidity high limit\",\n  \"units\" : \"NTU\",\n  \"defaultValue\" : 0.9,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"b3155498-dc89-4107-b255-09d2dfb27fb6\",\"source\":\"High CCL Flagging\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"High Limit Flagging\",\n  \"description\" : \"Adds HI flag if value exceeds high limit\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"c0daddb8-41af-43d7-8835-3b87b51f96c9\",\n  \"constant\" : [ \"P15ChlorineHI\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"KWCRH.KWCR_RAPP015AIQ01.F_CV:sample:PT2M\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Iterate through each element of the input array\\nforeach(element:__source__.array){\\n    //If value exceeds high limit\\n    if(element.value>=$(P15ChlorineHI)){\\n        //Apply HI flag\\n        element.addFlag(\\\"HI\\\");\\n    }\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"//Iterate through each element of the input array\\nforeach(element:__source__.array){\\n    //If value is above high limit\\n    if($(P15ChlorineHI)<=element.value){\\n        //Check if SNF flag or WST flag has already been applied\\n        if(!element.flags.contains(\\\"SNF\\\")&&!element.flags.contains(\\\"WST\\\")){\\n            //If not, apply HI flag\\n            element.addFlag(\\\"HI\\\");\\n        }\\n    }\\n}\\n\",\n    \"version\" : 2,\n    \"start\" : \"2014-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"c0daddb8-41af-43d7-8835-3b87b51f96c9\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2009-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"P15ChlorineHI\",\n  \"description\" : \"High limit for chlorine residual\",\n  \"units\" : \"mg/L\",\n  \"defaultValue\" : 2.50,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"IESO Hourly Averages\",\n  \"description\" : \"Outputs the average of the previous 30 days on a time of day basis\",\n  \"schedule\" : \"15 3 * * *\",\n  \"lastRunMessage\" : \"94a0b96f-296e-4351-bafb-9f8915adafb1\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP10am\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT10H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP10pm\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT22H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP11am\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT11H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP11pm\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT23H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP12am\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP12pm\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT12H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP1am\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT1H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP1pm\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT13H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP2am\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT2H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP2pm\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT14H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP3am\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT3H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP3pm\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT15H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP4am\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT4H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP4pm\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT16H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP5am\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT5H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP5pm\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT17H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP6am\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT6H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP6pm\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT18H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP7am\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT7H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP7pm\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT19H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP8am\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT8H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP8pm\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT20H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP9am\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT9H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:P1D\",\n    \"name\" : \"HOEP9pm\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P30D,+PT21H\",\n    \"duration\" : \"P30D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.IESO.HOEP.HRLYAVG_P30D\",\n    \"name\" : \"finalOutput30D\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 6\n  }, {\n    \"value\" : \"ET.IESO.HOEP.HRLYAVG_P7D\",\n    \"name\" : \"finalOutput7D\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 6\n  } ],\n  \"code\" : [ {\n    \"value\" : \"BigDecimal avgByHour30D = 0;\\nBigDecimal avgByHour7D=0;\\nint i =0;\\nBigDecimal sum=0;\\n//Create function called hourAverage\\nfunction hourAverage (HOEParray){\\n    //Take average of 30 day input array\\n    avgByHour30D=HOEParray.average;\\n    //Output average of 30 day input array with timestamp of last element\\n    Data finalData30D= new Data (HOEParray.desc[0].time,avgByHour30D,100);\\n    finalOutput30D.add(finalData30D);\\n    avgByHour30D=0;\\n    //Set up for loop to calculate 7 day average\\n    for(i=0;\\n        i<7;\\n        i++){\\n        //Calculate sum of the last 7 array elements\\n        sum+= HOEParray.desc[i].value;\\n    }\\n    avgByHour7D=sum/7;\\n    //Output 7 day average\\n    Data finalData7D= new Data (HOEParray.desc[0].time,avgByHour7D,100);\\n    finalOutput7D.add(finalData7D);\\n    sum=0;\\n    avgByHoud7D=0;\\n}\\n//Call the function hourAverage for each input array\\n//Each input array contains the value at the specified hour for the previous 30 days\\nhourAverage (HOEP12am);\\nhourAverage (HOEP1am);\\nhourAverage (HOEP2am);\\nhourAverage (HOEP3am);\\nhourAverage (HOEP4am);\\nhourAverage (HOEP5am);\\nhourAverage (HOEP6am);\\nhourAverage (HOEP7am);\\nhourAverage (HOEP8am);\\nhourAverage (HOEP9am);\\nhourAverage (HOEP10am);\\nhourAverage (HOEP11am);\\nhourAverage (HOEP12pm);\\nhourAverage (HOEP1pm);\\nhourAverage (HOEP2pm);\\nhourAverage (HOEP3pm);\\nhourAverage (HOEP4pm);\\nhourAverage (HOEP5pm);\\nhourAverage (HOEP6pm);\\nhourAverage (HOEP7pm);\\nhourAverage (HOEP8pm);\\nhourAverage (HOEP9pm);\\nhourAverage (HOEP10pm);\\nhourAverage (HOEP11pm);\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",HOEP6pm,HOEP5pm,HOEP8pm,HOEP7pm,HOEP9pm,HOEP12pm,HOEP11pm,HOEP10pm,__results__,HOEP10am,HOEP12am,HOEP11am,HOEP1am,HOEP2am,HOEP3am,HOEP5am,HOEP4am,HOEP7am,HOEP6am,HOEP9am,HOEP8am,HOEP1pm,HOEP2pm,HOEP4pm,HOEP3pm\",\n    \"outputs\" : \",finalOutput7D,finalOutput30D\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : false,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"94a0b96f-296e-4351-bafb-9f8915adafb1\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.IESO.HOEP.HRLYAVG_P30D\",\"name\":\"finalOutput30D\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.IESO.HOEP.HRLYAVG_P7D\",\"name\":\"finalOutput7D\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"K50 K51 Combined Daily Volume\",\n  \"description\" : \"Calculates daily combined flow volumes from K50 and K51 wells\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"5f5c0f23-003b-4fc3-b726-07d2766f90d5\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR3.KIWK050FXQ01.F_CV:average:P1D\",\n    \"name\" : \"AvgRateComb\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.KIWK05051TT\",\n    \"name\" : \"CombFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 8\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Exclude null inputs\\nif(K50Flow.value!=null && K51Flow.value!=null){\\n    //Sum K50 and K51 Daily Flow Volumes\\n    CombFlow.value=K50Flow.value + K51Flow.value;\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2014-09-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",K51Flow,K50Flow\",\n    \"outputs\" : \",CombFlow\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"//Exclude null inputs\\r\\nif(AvgRateComb.value!=null){\\r\\n    //Multiply average combined flow rate by 86.4 to get m3/day\\r\\n    CombFlow.value=AvgRateComb.value*86.4;\\r\\n}\\r\\n\",\n    \"version\" : 2,\n    \"start\" : \"2014-12-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",AvgRateComb,__results__\",\n    \"outputs\" : \",CombFlow\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"5f5c0f23-003b-4fc3-b726-07d2766f90d5\",\n  \"owner\" : \"ralbasel@regionofwaterloo.ca\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2014-12-30T04:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"DIRECT\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.KIWK05051TT\",\"name\":\"CombFlow\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":8}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"K50 K51 Combined Flow Target Comparison\",\n  \"description\" : \"Compares K50 and K51 Combined Flow to Target Flow Rate\",\n  \"schedule\" : \"0 0 * * *\",\n  \"lastRunMessage\" : \"62656108-e831-41f9-b563-70014f0ae7dc\",\n  \"constant\" : [ \"K50K51FlowTarget\", \"K50K51MaxFlowRate\", \"K50K51MinFlowRate\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"ET.KIWK05051TT:first:P1D\",\n    \"name\" : \"CombFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1Y,+P1Y\",\n    \"duration\" : \"P1Y\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.K50K51_AVG_FLOW_REMAIN\",\n    \"name\" : \"AVGFlowRemain\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 8\n  }, {\n    \"value\" : \"ET.K50K51_AVG_FLOW_YTD\",\n    \"name\" : \"AVGFlowToDate\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 8\n  }, {\n    \"value\" : \"ET.K50K51_VOL_YTD\",\n    \"name\" : \"FlowToDate\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 8\n  }, {\n    \"value\" : \"ET.K50K51_FRACT_YTD\",\n    \"name\" : \"FractTarget\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 8\n  }, {\n    \"value\" : \"ET.K50K51_TARG_YTD\",\n    \"name\" : \"TargetFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 8\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Call calculation to sum flows\\ncontext.call(\\\"K50 K51 Combined Daily Volume\\\");\\nBigDecimal SecondsRef = 0;\\n//Initialize local variable for number of seconds elapsed in current year\\nBigDecimal SecondsYTD = 0;\\n//Initialize local variable for number of seconds in entire current year\\nBigDecimal SecondsYear= 0;\\n//Initialize local variable for total flow volume in year to date\\nBigDecimal FlowUpToDate = 0;\\n//Initialize local variable for target flow volume\\nBigDecimal TargFlow = 0;\\n//Initialize index variable\\nint i = 0;\\n//Initialize local variable for calculation reference date\\nLong refDate = 0;\\n//Initialize boolean variable for breaking loop\\nboolean breakLoop = false;\\n//Set refDate equal to the reference date of the calculation\\nrefDate = CombFlow.referenceDate;\\n//Create new date format\\nSimpleDateFormat df = new SimpleDateFormat(\\\"yyyy-MM-dd'T'HH:mm:ss\\\");\\n//Parse reference date into new date format\\nDate date = df.parse(refDate);\\n//Iterate through the input array of daily flow volumes for the current year to date\\nforeach(element:CombFlow.array){\\n    //Perform following code only if the array element is not a null\\n    if(element.value!=null){\\n        //If the time stamp of the array element is equal to the reference date  \\n        if(element.time == date){\\n            //Then set the variable breakLoop to true\\n            breakLoop = true;\\n        }\\n        //If the variable breakLoop is false\\n        if(!breakLoop){\\n            //Add the value of the daily flow to the cumulative total of the daily flows\\n            FlowUpToDate+=element.value;\\n            //Increase the index i by 1\\n            i++;\\n        }\\n    }\\n}\\n//Initialize new calendar object to determine end of year \\nCalendar cal = Calendar.getInstance();\\n//Obtain year from calculation reference date\\nint year = CombFlow.referenceDate.getYear();\\n//Set calendar year to reference date year\\ncal.set(Calendar.YEAR,year);\\n//Set calendar month to December (where January = 0th month)\\ncal.set(Calendar.MONTH,11);\\n//Set calendar day to 31\\ncal.set(Calendar.DAY_OF_MONTH,31);\\n//Set calendar hour to 23\\ncal.set(Calendar.HOUR_OF_DAY,23);\\n//Set calendar minute to 59\\ncal.set(Calendar.MINUTE,59);\\n//Set calendar second to 59\\ncal.set(Calendar.SECOND,59);\\n//Calculate the number of seconds in the entire current year\\nSecondsYear = cal.time.getTime()/1000-CombFlow.array[0].timeInSeconds;\\n//Calculate the number of seconds elapsed in the year to date\\nSecondsYTD = CombFlow.array[i].timeInSeconds-CombFlow.array[0].timeInSeconds;\\n//Calculate the target flow for the year to date in cubic meters\\nTargFlow = ($(K50K51FlowTarget)*SecondsYTD)/1000;\\n//Output target flow to output tag\\nTargetFlow.value = TargFlow;\\n//Output the flow volume for the year to date to the output tag\\nFlowToDate.value = FlowUpToDate;\\n//Calculate the average flow for the year to date in L/s\\nAVGFlowToDate.value = (FlowUpToDate*1000)/(SecondsYTD);\\n//Calculate the average flow in L/s for the remainder of the year required to meet the target flow\\nAVGFlowRemain.value = ((SecondsYear*$(K50K51FlowTarget))-(FlowUpToDate*1000))/(SecondsYear-SecondsYTD);\\n//Calculate fraction of target flow\\nFractTarget.value = FlowUpToDate/TargFlow;\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",CombFlow\",\n    \"outputs\" : \",FractTarget,TargetFlow,AVGFlowToDate,AVGFlowRemain,FlowToDate\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"//Call calculation to sum flows\\ncontext.call(\\\"K50 K51 Combined Daily Volume\\\");\\n//Initialize local variable for number of seconds elapsed in current year\\nBigDecimal SecondsYTD = 0;\\n//Initialize local variable for number of seconds in entire current year\\nBigDecimal SecondsYear= 0;\\n//Initialize local variable for total flow volume in year to date\\nBigDecimal FlowUpToDate = 0;\\n//Initialize local variable for target flow volume\\nBigDecimal TargFlow = 0;\\n//Initialize index variable\\nint i = 0;\\n//Initialize local variable for calculation reference date\\nLong refDate = 0;\\n//Initialize boolean variable for breaking loop\\nboolean breakLoop = false;\\n//Set refDate equal to the reference date of the calculation\\nrefDate = CombFlow.referenceDate;\\n//Create new date format\\nSimpleDateFormat df = new SimpleDateFormat(\\\"yyyy-MM-dd'T'HH:mm:ss\\\");\\n//Parse reference date into new date format\\nDate date = df.parse(refDate);\\n//Iterate through the input array of daily flow volumes for the current year to date\\nforeach(element:CombFlow.array){\\n    //Perform following code only if the array element is not a null\\n    if(element.value!=null){\\n        //If the time stamp of the array element is equal to the reference date  \\n        if(element.time == date){\\n            //Then set the variable breakLoop to true\\n            breakLoop = true;\\n        }\\n        //If the variable breakLoop is false\\n        if(!breakLoop){\\n            //Add the value of the daily flow to the cumulative total of the daily flows\\n            FlowUpToDate+=element.value;\\n            //Increase the index i by 1\\n            i++;\\n        }\\n    }\\n}\\n//Initialize new calendar object to determine end of year \\nCalendar cal = Calendar.getInstance();\\n//Obtain year from calculation reference date\\nint year = CombFlow.referenceDate.getYear();\\n//Set calendar year to reference date year\\ncal.set(Calendar.YEAR,year);\\n//Set calendar month to December (where January = 0th month)\\ncal.set(Calendar.MONTH,11);\\n//Set calendar day to 31\\ncal.set(Calendar.DAY_OF_MONTH,31);\\n//Set calendar hour to 23\\ncal.set(Calendar.HOUR_OF_DAY,23);\\n//Set calendar minute to 59\\ncal.set(Calendar.MINUTE,59);\\n//Set calendar second to 59\\ncal.set(Calendar.SECOND,59);\\n//Calculate the number of seconds in the entire current year\\nSecondsYear = cal.time.getTime()/1000-CombFlow.array[0].timeInSeconds;\\n//Calculate the number of seconds elapsed in the year to date\\nSecondsYTD = CombFlow.array[i-1].timeInSeconds+86400-CombFlow.array[0].timeInSeconds;\\n//Calculate the target flow for the year to date in cubic meters\\nTargFlow = ($(K50K51FlowTarget)*SecondsYTD)/1000;\\n//Output target flow to output tag\\nTargetFlow.value = TargFlow;\\n//Output the flow volume for the year to date to the output tag\\nFlowToDate.value = FlowUpToDate;\\n//Calculate the average flow for the year to date in L/s\\nAVGFlowToDate.value = (FlowUpToDate*1000)/(SecondsYTD);\\n//Calculate the average flow in L/s for the remainder of the year required to meet the target flow\\nAVGFlowRemain.value = ((SecondsYear*$(K50K51FlowTarget))-(FlowUpToDate*1000))/(SecondsYear-SecondsYTD);\\n//Calculate fraction of target flow\\nFractTarget.value = FlowUpToDate/TargFlow;\\n\",\n    \"version\" : 2,\n    \"start\" : \"2015-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",CombFlow\",\n    \"outputs\" : \",FractTarget,TargetFlow,AVGFlowToDate,AVGFlowRemain,FlowToDate\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"//Call calculation to sum flows\\ncontext.call(\\\"K50 K51 Combined Daily Volume\\\");\\n//Initialize local variable for number of seconds elapsed in current year\\nBigDecimal SecondsYTD = 0;\\n//Initialize local variable for number of seconds in entire current year\\nBigDecimal SecondsYear= 0;\\n//Initialize local variable for total flow volume in year to date\\nBigDecimal FlowUpToDate = 0;\\n//Initialize local variable for target flow volume\\nBigDecimal TargFlow = 0;\\n//Initialize index variable\\nint i = 0;\\n//Initialize local variable for calculation reference date\\nLong refDate = 0;\\n//Initialize boolean variable for breaking loop\\nboolean breakLoop = false;\\n//Set refDate equal to the reference date of the calculation\\nrefDate = CombFlow.referenceDate;\\n//Create new date format\\nSimpleDateFormat df = new SimpleDateFormat(\\\"yyyy-MM-dd'T'HH:mm:ss\\\");\\n//Parse reference date into new date format\\nDate date = df.parse(refDate);\\n//Iterate through the input array of daily flow volumes for the current year to date\\nforeach(element:CombFlow.array){\\n    //Perform following code only if the array element is not a null\\n    if(element.value!=null){\\n        //If the time stamp of the array element is equal to the reference date  \\n        if(element.time == date){\\n            //Then set the variable breakLoop to true\\n            breakLoop = true;\\n        }\\n        //If the variable breakLoop is false\\n        if(!breakLoop){\\n            //Add the value of the daily flow to the cumulative total of the daily flows\\n            FlowUpToDate+=element.value;\\n            //Increase the index i by 1\\n            i++;\\n        }\\n    }\\n}\\n//Initialize new calendar object to determine end of year \\nCalendar cal = Calendar.getInstance();\\n//Obtain year from calculation reference date\\nint year = CombFlow.referenceDate.getYear();\\n//Set calendar year to reference date year\\ncal.set(Calendar.YEAR,year);\\n//Set calendar month to December (where January = 0th month)\\ncal.set(Calendar.MONTH,11);\\n//Set calendar day to 31\\ncal.set(Calendar.DAY_OF_MONTH,31);\\n//Set calendar hour to 23\\ncal.set(Calendar.HOUR_OF_DAY,23);\\n//Set calendar minute to 59\\ncal.set(Calendar.MINUTE,59);\\n//Set calendar second to 59\\ncal.set(Calendar.SECOND,59);\\n//Calculate the number of seconds in the entire current year\\nSecondsYear = cal.time.getTime()/1000-CombFlow.array[0].timeInSeconds;\\n//Calculate the number of seconds elapsed in the year to date\\nSecondsYTD = CombFlow.array[i-1].timeInSeconds+86400-CombFlow.array[0].timeInSeconds;\\n//Calculate the target flow for the year to date in cubic meters\\nTargFlow = ($(K50K51FlowTarget)*SecondsYTD)/1000;\\n//Output target flow to output tag\\nTargetFlow.value = TargFlow;\\n//Output the flow volume for the year to date to the output tag\\nFlowToDate.value = FlowUpToDate;\\n//Calculate the average flow for the year to date in L/s\\nAVGFlowToDate.value = (FlowUpToDate*1000)/(SecondsYTD);\\n//Add MAX flag if average flow to date exceeds upper limit\\nif(AVGFlowToDate.value > $(K50K51MaxFlowRate)) {\\n    AVGFlowToDate.addFlag(\\\"MAX\\\");\\n}\\n//Add MIN flag if average flow to date falls below lower limit\\nif(AVGFlowToDate.value < $(K50K51MinFlowRate)){\\n    AVGFlowToDate.addFlag(\\\"MIN\\\");\\n}\\n//Calculate the average flow in L/s for the remainder of the year required to meet the target flow\\nAVGFlowRemain.value = ((SecondsYear*$(K50K51FlowTarget))-(FlowUpToDate*1000))/(SecondsYear-SecondsYTD);\\n//Calculate fraction of target flow\\nFractTarget.value = FlowUpToDate/TargFlow;\\n\",\n    \"version\" : 3,\n    \"start\" : \"2015-01-12T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",CombFlow\",\n    \"outputs\" : \",FractTarget,TargetFlow,AVGFlowToDate,AVGFlowRemain,FlowToDate\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"//Call calculation to sum flows\\ncontext.call(\\\"K50 K51 Combined Daily Volume\\\");\\n//Initialize local variable for number of seconds elapsed in current year\\nBigDecimal SecondsYTD = 0;\\n//Initialize local variable for number of seconds in entire current year\\nBigDecimal SecondsYear= 0;\\n//Initialize local variable for total flow volume in year to date\\nBigDecimal FlowUpToDate = 0;\\n//Initialize local variable for target flow volume\\nBigDecimal TargFlow = 0;\\n//Initialize index variable\\nint i = 0;\\n//Initialize local variable for calculation reference date\\nLong refDate = 0;\\n//Initialize boolean variable for breaking loop\\nboolean breakLoop = false;\\n//Set refDate equal to the reference date of the calculation\\nrefDate = CombFlow.referenceDate;\\n//Create new date format\\nSimpleDateFormat df = new SimpleDateFormat(\\\"yyyy-MM-dd'T'HH:mm:ss\\\");\\n//Parse reference date into new date format\\nDate date = df.parse(refDate);\\n//Iterate through the input array of daily flow volumes for the current year to date\\nforeach(element:CombFlow.array){\\n    //Perform following code only if the array element is not a null\\n    if(element.value!=null){\\n        //If the time stamp of the array element is equal to the reference date  \\n        if(element.time == date){\\n            //Then set the variable breakLoop to true\\n            breakLoop = true;\\n        }\\n        //If the variable breakLoop is false\\n        if(!breakLoop){\\n            //Add the value of the daily flow to the cumulative total of the daily flows\\n            FlowUpToDate+=element.value;\\n            //Increase the index i by 1\\n            i++;\\n        }\\n    }\\n}\\n//Initialize new calendar object to determine end of year \\nCalendar cal = Calendar.getInstance();\\n//Obtain year from calculation reference date\\nint year = CombFlow.referenceDate.getYear();\\n//Set calendar year to reference date year\\ncal.set(Calendar.YEAR,year);\\n//Set calendar month to December (where January = 0th month)\\ncal.set(Calendar.MONTH,11);\\n//Set calendar day to 31\\ncal.set(Calendar.DAY_OF_MONTH,31);\\n//Set calendar hour to 23\\ncal.set(Calendar.HOUR_OF_DAY,23);\\n//Set calendar minute to 59\\ncal.set(Calendar.MINUTE,59);\\n//Set calendar second to 59\\ncal.set(Calendar.SECOND,59);\\n//Calculate the number of seconds in the entire current year\\nSecondsYear = cal.time.getTime()/1000-CombFlow.array[0].timeInSeconds;\\n//Calculate the number of seconds elapsed in the year to date\\n//Previous version added 86400 seconds erroneously (corrected in this version)\\nSecondsYTD = CombFlow.array[i-1].timeInSeconds-CombFlow.array[0].timeInSeconds;\\n//Calculate the target flow for the year to date in cubic meters\\nTargFlow = ($(K50K51FlowTarget)*SecondsYTD)/1000;\\n//Output target flow to output tag\\nTargetFlow.value = TargFlow;\\n//Output the flow volume for the year to date to the output tag\\nFlowToDate.value = FlowUpToDate;\\n//Calculate the average flow for the year to date in L/s\\nAVGFlowToDate.value = (FlowUpToDate*1000)/(SecondsYTD);\\n//Add MAX flag if average flow to date exceeds upper limit\\nif(AVGFlowToDate.value > $(K50K51MaxFlowRate)) {\\n    AVGFlowToDate.addFlag(\\\"MAX\\\");\\n}\\n//Add MIN flag if average flow to date falls below lower limit\\nif(AVGFlowToDate.value < $(K50K51MinFlowRate)){\\n    AVGFlowToDate.addFlag(\\\"MIN\\\");\\n}\\n//Calculate the average flow in L/s for the remainder of the year required to meet the target flow\\nAVGFlowRemain.value = ((SecondsYear*$(K50K51FlowTarget))-(FlowUpToDate*1000))/(SecondsYear-SecondsYTD);\\n//Calculate fraction of target flow\\nFractTarget.value = FlowUpToDate/TargFlow;\\n\",\n    \"version\" : 4,\n    \"start\" : \"2015-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",CombFlow\",\n    \"outputs\" : \",FractTarget,TargetFlow,AVGFlowToDate,AVGFlowRemain,FlowToDate\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"//Call calculation to sum flows\\ncontext.call(\\\"K50 K51 Combined Daily Volume\\\");\\n//Initialize local variable for number of seconds elapsed in current year\\nBigDecimal SecondsYTD = 0;\\n//Initialize local variable for number of seconds in entire current year\\nBigDecimal SecondsYear= 0;\\n//Initialize local variable for total flow volume in year to date\\nBigDecimal FlowUpToDate = 0;\\n//Initialize local variable for target flow volume\\nBigDecimal TargFlow = 0;\\n//Initialize index variable\\nint i = 0;\\n//Initialize local variable for calculation reference date\\nLong refDate = 0;\\n//Initialize boolean variable for breaking loop\\nboolean breakLoop = false;\\n//Set refDate equal to the reference date of the calculation\\nrefDate = CombFlow.referenceDate;\\n//Create new date format\\nSimpleDateFormat df = new SimpleDateFormat(\\\"yyyy-MM-dd'T'HH:mm:ss\\\");\\n//Parse reference date into new date format\\nDate date = new Date (df.parse(refDate).getTime()-86400*1000);\\n//Iterate through the input array of daily flow volumes for the current year to date\\nforeach(element:CombFlow.array){\\n    //Perform following code only if the array element is not a null\\n    if(element.value!=null){\\n        //If the time stamp of the array element is equal to the reference date  \\n        if(element.time == date){\\n            //Then set the variable breakLoop to true\\n            breakLoop = true;\\n        }\\n        //If the variable breakLoop is false\\n        if(!breakLoop){\\n            //Add the value of the daily flow to the cumulative total of the daily flows\\n            FlowUpToDate+=element.value;\\n            //Increase the index i by 1\\n            i++;\\n        }\\n    }\\n}\\n//Initialize new calendar object to determine end of year \\nCalendar cal = Calendar.getInstance();\\n//Obtain year from calculation reference date\\nint year = CombFlow.referenceDate.getYear();\\n//Set calendar year to reference date year\\ncal.set(Calendar.YEAR,year);\\n//Set calendar month to December (where January = 0th month)\\ncal.set(Calendar.MONTH,11);\\n//Set calendar day to 31\\ncal.set(Calendar.DAY_OF_MONTH,31);\\n//Set calendar hour to 23\\ncal.set(Calendar.HOUR_OF_DAY,23);\\n//Set calendar minute to 59\\ncal.set(Calendar.MINUTE,59);\\n//Set calendar second to 59\\ncal.set(Calendar.SECOND,59);\\n//Calculate the number of seconds in the entire current year\\nSecondsYear = cal.time.getTime()/1000-CombFlow.array[0].timeInSeconds;\\n//Calculate the number of seconds elapsed in the year to date\\nSecondsYTD = CombFlow.array[i].timeInSeconds-CombFlow.array[0].timeInSeconds;\\n//Calculate the target flow for the year to date in cubic meters\\nTargFlow = ($(K50K51FlowTarget)*SecondsYTD)/1000;\\n//Output target flow to output tag\\nTargetFlow.value = TargFlow;\\n//Output the flow volume for the year to date to the output tag\\nFlowToDate.value = FlowUpToDate;\\n//Calculate the average flow for the year to date in L/s\\nAVGFlowToDate.value = (FlowUpToDate*1000)/(SecondsYTD);\\n//Add MAX flag if average flow to date exceeds upper limit\\nif(AVGFlowToDate.value > $(K50K51MaxFlowRate)) {\\n    AVGFlowToDate.addFlag(\\\"MAX\\\");\\n}\\n//Add MIN flag if average flow to date falls below lower limit\\nif(AVGFlowToDate.value < $(K50K51MinFlowRate)){\\n    AVGFlowToDate.addFlag(\\\"MIN\\\");\\n}\\n//Calculate the average flow in L/s for the remainder of the year required to meet the target flow\\nAVGFlowRemain.value = ((SecondsYear*$(K50K51FlowTarget))-(FlowUpToDate*1000))/(SecondsYear-SecondsYTD);\\n//Calculate fraction of target flow\\nFractTarget.value = FlowUpToDate/TargFlow;\\n\",\n    \"version\" : 5,\n    \"start\" : \"2016-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : false,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"62656108-e831-41f9-b563-70014f0ae7dc\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K50K51FlowTarget\",\n  \"description\" : \"Target K50 K51 combined instantaneous flow rate\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 105,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K50K51MaxFlowRate\",\n  \"description\" : \"K50 + K51 Combined Max Flow Rate\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 125,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K50K51MinFlowRate\",\n  \"description\" : \"K50 + K51 Combined Minimum Flow Rate\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 75,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K50K51_AVG_FLOW_REMAIN\",\"name\":\"AVGFlowRemain\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":8}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K50K51_AVG_FLOW_YTD\",\"name\":\"AVGFlowToDate\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":8}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K50K51_VOL_YTD\",\"name\":\"FlowToDate\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":8}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K50K51_FRACT_YTD\",\"name\":\"FractTarget\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":8}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K50K51_TARG_YTD\",\"name\":\"TargetFlow\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":8}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Low CCL Flagging\",\n  \"description\" : \"Adds CCL flag when value falls below CCL limit when flow is present\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"45508e49-9131-49cc-a65e-4642d79b1d2c\",\n  \"constant\" : [ \"MiddletonChlorineCCL\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"KWCRH.KWCR_MDPCFR3AIQ01.F_CV:sample:PT2M\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(__source__, second, 30);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs) {\\n    //If secondary tag value (flow) is greater than no flow threshold\\n    if($(NoFlowThreshold)<=pair.b.value){\\n        //If the primary tag value is less than the critical control limit\\n        if($(MiddletonChlorineCCL)>=pair.a.value){\\n            //Add CCL flag to primary tag\\n            pair.a.addFlag(\\\"CCL\\\");\\n        }\\n    }\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2014-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : false,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"//Iterate through each element of the input array\\r\\nforeach(element:__source__.array){\\r\\n    if(100 == element.quality){\\r\\n    //If value is below CCL limit\\r\\n    if(element.value<=$(MiddletonChlorineCCL)){\\r\\n        //Check if SNF flag or WST flag has already been applied\\r\\n        if(!element.flags.contains(\\\"SNF\\\")&&!element.flags.contains(\\\"WST\\\")){\\r\\n            //If not, apply CCL flag\\r\\n            element.addFlag(\\\"CCL\\\");\\r\\n        }\\r\\n    }\\r\\n    }\\r\\n}\\r\\n\",\n    \"version\" : 2,\n    \"start\" : \"2014-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"45508e49-9131-49cc-a65e-4642d79b1d2c\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2014-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MiddletonChlorineCCL\",\n  \"description\" : \"Critical control limit for minimum chlorine residual\",\n  \"units\" : \"mg/L\",\n  \"defaultValue\" : 0.90,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"73d8313c-d65b-498a-978a-120a5225a416\",\"source\":\"Low CCL Flagging\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Low Limit Flagging\",\n  \"description\" : \"Applies LO flag to values below low limit\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"c30210c1-e29e-467f-a8eb-035a904a4df7\",\n  \"constant\" : [ \"MiddletonChlorineLO\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MDPH.MDPSCDA.MDPCFR3AIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Iterate through each element of the input array\\nforeach(element:__source__.array){\\n    //If value is below low limit\\n    if($(MiddletonChlorineLO)>=element.value){\\n        //Check if SNF flag or WST flag has already been applied\\n        if(!element.flags.contains(\\\"SNF\\\")&&!element.flags.contains(\\\"WST\\\")){\\n            //If not, apply LO flag\\n            element.addFlag(\\\"LO\\\");\\n        }\\n    }\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"c30210c1-e29e-467f-a8eb-035a904a4df7\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2009-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MiddletonChlorineLO\",\n  \"description\" : \"Low limit of chlorine residual\",\n  \"units\" : \"mg/L\",\n  \"defaultValue\" : 0.90,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Mannheim combined power\",\n  \"description\" : \"Outputs sum of power from PM1 and PM2\",\n  \"schedule\" : \"15 * * * *\",\n  \"lastRunMessage\" : \"8ff520d7-806d-41ab-aee6-e45e1db54722\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0100VKR.F_CV:rawByTime:PT1H\",\n    \"name\" : \"powerOne\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0200VKR.F_CV:rawByTime:PT1H\",\n    \"name\" : \"powerTwo\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MTPEPM000VKR.F_CV\",\n    \"name\" : \"powerSum\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT1H\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"TagInputPair tip = new TagInputPair(powerOne,powerTwo,\\\"PT1M\\\");\\nfor(DataPair pair:tip.pairs){\\n    Data total = new Data(pair.a.time,(pair.a.value+pair.b.value),pair.a.quality);\\n    powerSum.add(total);\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2014-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",powerTwo,powerOne,__results__\",\n    \"outputs\" : \",powerSum\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"8ff520d7-806d-41ab-aee6-e45e1db54722\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MTPEPM000VKR.F_CV\",\"name\":\"powerSum\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT1H\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Mannheim Energy Management kVA Calculation\",\n  \"description\" : \"Based on 5 minute kVAR and kW maximums\",\n  \"schedule\" : \"0,5,10,15,20,25,30,35,40,45,50,55 * * * *\",\n  \"lastRunMessage\" : \"dca2febf-2a75-4be3-9eaf-16e3fa2c87c1\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0100VVP.F_CV:maximum:PT5M\",\n    \"name\" : \"kVar1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT15M\",\n    \"duration\" : \"PT5M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0200VVP.F_CV:maximum:PT5M\",\n    \"name\" : \"kVar2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT15M\",\n    \"duration\" : \"PT5M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0100VKR.F_CV:maximum:PT5M\",\n    \"name\" : \"kW1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT15M\",\n    \"duration\" : \"PT5M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0200VKR.F_CV:maximum:PT5M\",\n    \"name\" : \"kW2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT15M\",\n    \"duration\" : \"PT5M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MTPH.MTPEPM0100QPV_CALC\",\n    \"name\" : \"kVA\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT15M\",\n    \"scale\" : 8\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Initialize total kW to sum of 1st and 2nd power monitor\\nBigDecimal kWTot = kW1.value + kW2.value;\\n//Initizlie total kVAR to sum of 1st and 2nd power monitor\\nBigDecimal kVar = kVar1.value + kVar2.value;\\n//Calculate kVA as square root of the sum of kW squared and kVar squared\\nkVA = Math.sqrt(Math.pow(kWTot,2)+ Math.pow(kVar,2));\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-07-17T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",kW1,kW2,kVar1,kVar2\",\n    \"outputs\" : \",kVA\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"dca2febf-2a75-4be3-9eaf-16e3fa2c87c1\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2015-10-01T11:10:00.000\",\n  \"enabled\" : false,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MTPH.MTPEPM0100QPV_CALC\",\"name\":\"kVA\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT15M\",\"scale\":8}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Mannheim Energy per m3\",\n  \"description\" : \"Outputs kWh per m3 water per hour\",\n  \"schedule\" : \"20 * * * *\",\n  \"lastRunMessage\" : \"0da8dd60-2257-4ca8-bf66-223fe00dbd14\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MTPH.MTPSCDA.MTRTWL1FIQ01.F_CV:average:PT1H\",\n    \"name\" : \"avgInstFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0100VKR.F_CV:rawByTime:PT1H\",\n    \"name\" : \"power1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0200VKR.F_CV:rawByTime:PT1H\",\n    \"name\" : \"power2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MTPEPM_KWH_M3\",\n    \"name\" : \"NRGVol\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT1H\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Initialize variables\\nBigDecimal total=0;\\nBigDecimal avgPower=0;\\nBigDecimal avgEnergyVol=0;\\nint count=0;\\nif(50.0<avgInstFlow.value){\\n    //Match timestamps of power values from both power monitors\\n    TagInputPair tip = new TagInputPair(power1,power2,\\\"PT1M\\\");\\n    for(DataPair pair:tip.pairs){\\n        if(null!=pair.a.value && null!=pair.b.value)\\n        {\\n            //Keep running total of sum of time-matched power values\\n            total += pair.a.value+pair.b.value;\\n            //context.trace(total);\\n            //Keep running count of number of matched pairs\\n            count++;\\n            //context.trace(count);\\n        }\\n    }\\n    //Prevent division by 0\\n    if(count!=0){\\n        //Calculate average power value\\n        avgPower=total/count;\\n        //context.trace(avgPower);\\n        //Prevent division by 0\\n        //Divide average power by average flow to get kW/(L/s)=kJ/L\\n        //Multiply result by 1000 to convert to kJ/m3\\n        //Divide result by 3600 to convert to kWh (1 kWh = 3600 kJ)\\n        avgEnergyVol=(avgPower/avgInstFlow.value)*1000/3600;\\n        //context.trace(\\\"avgEnergyVol: \\\" +avgEnergyVol);\\n    }\\n    //Output result\\n    NRGVol.value=avgEnergyVol;\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2014-08-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",avgInstFlow,__results__,power1,power2\",\n    \"outputs\" : \",NRGVol\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"0da8dd60-2257-4ca8-bf66-223fe00dbd14\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MTPEPM_KWH_M3\",\"name\":\"NRGVol\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT1H\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Mannheim Hourly Hydro Billing Estimate\",\n  \"description\" : \"Estimates hourly hydro bill for Mannehim WTP\",\n  \"schedule\" : \"0 * * * *\",\n  \"lastRunMessage\" : \"ceef61bf-35ae-4f25-8b10-6cc98c88029a\",\n  \"constant\" : [ \"KWHGADisp\", \"KWHTransNtwk\", \"KWHTransCnx\", \"KWHDistrib\", \"KWHMonthly\", \"KWHTransCR\", \"KWHSSAdmin\", \"KWHWholeMkt\", \"KWHUAF\", \"KWHDebtRetire\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MTPH.MTPSCDA.MTRTWL1FIQ01.F_CV:average:PT1H\",\n    \"name\" : \"flow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT4H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.GlobalAdjustmentFirstEstimate:first:P1M\",\n    \"name\" : \"gaFirst\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P0M\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:PT1H\",\n    \"name\" : \"hoep\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT5H\",\n    \"duration\" : \"PT2H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0100VKR.F_CV:average:PT1H\",\n    \"name\" : \"kWh1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT4H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0200VKR.F_CV:average:PT1H\",\n    \"name\" : \"kWh2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT4H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"ET.MTPH.MTPEPM0100QPV_MAX15:first:PT1H\",\n    \"name\" : \"maxkVAFifteenRoll\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P0M\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"ET.MTPH.MTPEPM0100VKR_MAX15:first:PT1H\",\n    \"name\" : \"maxkWFifteenRoll\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P0M\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MTPEPM_MTHLY_BILLED_DMD\",\n    \"name\" : \"billedDemandOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT4H\",\n    \"scale\" : 6\n  }, {\n    \"value\" : \"ET.MTPEPM_HRLY_ENERGY_CHARGE\",\n    \"name\" : \"electChargeOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT4H\",\n    \"scale\" : 5\n  }, {\n    \"value\" : \"ET.MTPEPM_TOT_CHRGE_M3_EST\",\n    \"name\" : \"flowCharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT4H\",\n    \"scale\" : 5\n  }, {\n    \"value\" : \"ET.MTPEPM_TOT_HRLY_CHARGE_EST\",\n    \"name\" : \"totalChargeOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT4H\",\n    \"scale\" : 5\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//SECTION 1:MAXIMUM kVA DETERMINATIONS\\n//Create list for storing hourly maximums of rolling 15 minute average kVA values\\nList MaxkVAList = new ArrayList();\\n//Create list for storing hourly maximum of rolling 15 minute average kVA values during peak hours only\\nList MaxPeakkVAList = new ArrayList();\\n//Create variable to store reference date of calculation\\nLong refDateA = maxkVAFifteenRoll.referenceDate;\\n//Create new date format\\nSimpleDateFormat df = new SimpleDateFormat(\\\"yyyy-MM-dd'T'HH:mm:ss\\\");\\n//Parse reference date into new date format and create new Rdate 3 hours prior to reference date\\nDate Rdate = new Date(df.parse(refDateA).getTime()-(3*60*60*1000));\\n//context.trace(Rdate);\\n//Create calendar for tracking time of kVA values\\nCalendar kVAPeakcal = GregorianCalendar.getInstance();\\n//Iterate through array of hourly maximums of rolling 15 minute average kVA values\\nforeach(element:maxkVAFifteenRoll.array){\\n    //Allow value if timestamped more than 3 hours prior to reference date\\n    if(element.getTime().before(Rdate)){\\n        //Add value to MaxkVAList\\n        MaxkVAList.add(element.value);\\n        //context.trace(MaxkVAList);\\n        //Set the kVAPeakcal calendar to the time of the array element\\n        kVAPeakcal.setTime(element.time);\\n        //context.trace(kVAPeakcal);\\n        //Retrieve the hour of the day from the kVAPeakcal calendar\\n        int hour = kVAPeakcal.get(Calendar.HOUR_OF_DAY);\\n        //Retrieve the day of the week from the kVAPeakcal calendar\\n        int dow = kVAPeakcal.get(Calendar.DAY_OF_WEEK);\\n        //context.trace(\\\"dow=\\\"+dow);\\n        //context.trace(\\\"hour=\\\"+hour);\\n        //Check if the time is between 7 am and 7 pm Monday-Friday\\n        if(hour >= 7 && hour < 19 && dow >=2 && dow <=6){\\n            //If it is between 7 am and 7 pm Monday-Friday, add the value to the \\\"MaxPeakkVAList\\\"\\n            MaxPeakkVAList.add(element.value);\\n            //context.trace(MaxPeakkVAList);\\n        }\\n    }\\n}\\n//Retrieve and store the maximum value from the MaxkVAList\\nBigDecimal maxMaxkVAFifteen = Collections.max(MaxkVAList);\\ncontext.trace(\\\"MaxMaxkVAFifteen:\\\" +maxMaxkVAFifteen);\\n//Retrieve and store the maximum value from the MaxkVAList\\nBigDecimal maxMaxPeakkVAFifteen = Collections.max(MaxPeakkVAList);\\ncontext.trace(\\\"maxMaxPeakkVAFifteen:\\\" +maxMaxPeakkVAFifteen);\\n//SECTION 2: MAXIMUM kW DETERMINATIONS\\n//Create list for storing hourly maximums of rolling 15 minute average kW values\\nList MaxkWList = new ArrayList();\\n//Create list for storing hourly maximum of rolling 15 minute average kW values during peak hours only\\nList MaxPeakkWList = new ArrayList();\\n//Create calendar for tracking time of kW values\\nCalendar kWPeakcal = GregorianCalendar.getInstance();\\n//Iterate through array of hourly maximums of rolling 15 minute average kVA values\\nforeach(element:maxkWFifteenRoll.array){\\n    //Allow value if timestamped more than 3 hours prior to reference date\\n    if(element.getTime().before(Rdate);\\n      ){\\n        //Add value to MaxkVAList\\n        MaxkWList.add(element.value);\\n        //context.trace(MaxkVAList);\\n        //Set the kWPeakcal calendar to the time of the array element\\n        kWPeakcal.setTime(element.time);\\n        //context.trace(kWPeakcal);\\n        //Retrieve the hour of the day from the kWPeakcal calendar\\n        int hour = kWPeakcal.get(Calendar.HOUR_OF_DAY);\\n        //Retrieve the day of the week from the kWPeakcal calendar\\n        int dow = kWPeakcal.get(Calendar.DAY_OF_WEEK);\\n        //context.trace(\\\"dow=\\\"+dow);\\n        //context.trace(\\\"hour=\\\"+hour);\\n        //Check if the time is between 7 am and 7 pm Monday-Friday\\n        if(hour >= 7 && hour < 19 && dow >=2 && dow <=6){\\n            //If it is between 7 am and 7 pm Monday-Friday, add the value to the \\\"MaxPeakkWList\\\"\\n            MaxPeakkWList.add(element.value);\\n            //context.trace(MaxPeakkWList);\\n        }\\n    }\\n}\\n//Retrieve and store the maximum value from the MaxkWList\\nBigDecimal maxMaxkWFifteen = Collections.max(MaxkWList);\\n//context.trace(\\\"MaxkWList size: \\\" +MaxkWList.size);\\ncontext.trace(\\\"maxMaxkWFifteen:\\\" +maxMaxkWFifteen);\\n//Retrieve and store the maximum value from the MaxkWList\\nBigDecimal maxMaxPeakkWFifteen = Collections.max(MaxPeakkWList);\\ncontext.trace(\\\"maxMaxPeakkWFifteen:\\\" +maxMaxPeakkWFifteen);\\n//SECTION 3: BILLED DEMAND DETERMINATIONS\\n//Initialize variable for overall billed demand\\nBigDecimal billedDemand;\\n//If 90% of maximum kVA is greater than maximum kW\\nif(0.9*maxMaxkVAFifteen>maxMaxkWFifteen){\\n    //Set billed demand to 90% of maximum kVA\\n    billedDemand=0.9*0.99*maxMaxkVAFifteen;\\n}\\nelse{\\n    //If not, set billed demand to maximum kW\\n    billedDemand = 0.99*maxMaxkWFifteen}\\ncontext.trace(\\\"billedDemand:\\\" +billedDemand);\\n//Initialize variable for billed demand (peak hours)\\nBigDecimal billedPeakHrDemand;\\n//If 90% of maximum kVA (peak hours) is greater than maximum kW (peak hours)\\nif(0.9*maxMaxPeakkVAFifteen>maxMaxPeakkWFifteen){\\n    //Set billed demand (peak hours) to 90% of maximum kVA (peak hours)\\n    billedPeakHrDemand=0.9*0.99*maxMaxPeakkVAFifteen;\\n}\\nelse{\\n    //If not, set billed demand (peak hours) to maximum kW (peak hours)\\n    billedPeakHrDemand = 0.99*maxMaxPeakkWFifteen}\\ncontext.trace(\\\"billedPeakHrDemand:\\\" +billedPeakHrDemand);\\n//SECTION 4: CALCULATION OF CHARGES\\n//Sum energy consumption from Power Monitor 1 and Power Monitor 2\\nBigDecimal electConsumptTotal=kWh1.value + kWh2.value;\\n//context.trace(ElectConsumptHour);\\n//The Hourly Ontario Energy Price (hoep) is always quoted in Standard Time\\n//Create calendar named kWhcal for determining whether daylight saving time is in effect\\nCalendar kWhcal = GregorianCalendar.getInstance();\\n//Set the kWhcal calendar to the timestamp of the input variable kWh1\\nkWhcal.setTime(kWh1.time);\\n//Initialize variable \\\"daylightSave\\\" to store DST_OFFSET property from kWhcal calendar\\nint daylightSave = kWhcal.get(Calendar.DST_OFFSET);\\n//context.trace(kWhcal);\\n//context.trace (daySave);\\n//Initialize local variable to store the dollar amount of the Electricity charge\\nBigDecimal electCharge;\\n//If daylightSave equals 3600000 (milliseconds), Daylight Saving Time is in effect\\nif(daylightSave==3600000){\\n    //Apply usage adjustment factor to total energy consumption\\n    //Calculate Electricity Charge based on earlier hoep price (adjust hoep to $/kWh)\\n    electCharge= electConsumptTotal*(1+$(KWHUAF)) * hoep.array[0].value/1000;\\n}\\n//If daylightSave equals 0, DST is not in effect\\nelse if(daylightSave==0){\\n    //Apply usage adjustment factor to total energy consumption\\n    //Calculate Electricity Charge based on later hoep price\\n    electCharge=electConsumptTotal *(1+$(KWHUAF))*hoep.array[1].value/1000;\\n}\\n//context.trace(ElectConsumptTotal);\\ncontext.trace(\\\"electCharge:\\\" +electCharge);\\n//Create new calendar called \\\"hcal\\\" for determining the number of hours in the month\\nCalendar hcal = GregorianCalendar.getInstance();\\n//Set hcal to the timestamp of gaFirst (i.e. midnight of the first day of the month)\\nhcal.setTime(gaFirst.time);\\n//Create variable Time1 to store time at beginning of the month (in milliseconds since Jan 1., 1970)\\nBigDecimal time1=hcal.time.getTime();\\n//Add one month to hcal\\nhcal.add(Calendar.MONTH,1);\\n//Create variable Time2 to store new time of hcal (in milliseconds since Jan 1., 1970)\\nBigDecimal time2 = hcal.time.getTime();\\n//Obtain number of hours in the month by subtracting Time 1 from Time 2 and converting from milliseconds to hours\\nBigDecimal hoursInMonth = (time2-time1)/(60*60*1000);\\ncontext.trace(\\\"hoursInMonth:\\\" +hoursInMonth);\\n//Multiply billed demand by Global Adjusbment Disposition Charge rate\\nBigDecimal globalAdjDisp = $(KWHGADisp)*billedDemand/hoursInMonth;\\n//Multiply billed demand (peak hours) by Transmission Network Charge rate\\nBigDecimal transNetwrk = $(KWHTransNtwk)*billedPeakHrDemand/hoursInMonth;\\n//Multiply billed demand by Transmission Connection Charge rate\\nBigDecimal transCon = $(KWHTransCnx)*billedDemand/hoursInMonth;\\n//Multiply billed demand by Distribution Charge rate\\nBigDecimal distribCharge = $(KWHDistrib)*billedDemand/hoursInMonth;\\n//Calculate hourly portion of Monthly Customer Charge by dividing flat rate by number of hours in month\\nBigDecimal oneHourMCC = ($(KWHMonthly)/hoursInMonth);\\n//Multiply billed demand by Customer Owned Transformation Credit rate\\nBigDecimal transformAllow = $(KWHTransCR)*billedDemand/hoursInMonth;\\n//Calculate hourly portion of Standard Supply Administration Fee by dividing flate rate by number of hours in month\\nBigDecimal oneHourSSAF = $(KWHSSAdmin)/hoursInMonth;\\n//Calculate \\\"Usage This Bill\\\" by multilpying total electricity consumption by (1+\\\"Usage Adjustment Factor\\\")\\nBigDecimal usageThisBill = electConsumptTotal*(1+$(KWHUAF));\\ncontext.trace(\\\"usageThisBill:\\\" +usageThisBill);\\n//Multilpy \\\"Usage This Bill\\\" by Wholesale Market Charge rate\\nBigDecimal wholesaleMarket = $(KWHWholeMkt)*usageThisBill;\\n//Multiply Debt Retirement Charge rate by 99% of total energy consumption\\nBigDecimal debtRetire = 0.99*electConsumptTotal*$(KWHDebtRetire);\\n//Calculate Global Adjustment charge based on Global Adjustment First Estimate and \\\"Usage This Bill\\\"\\nBigDecimal globalAdj = (gaFirst.value/1000)*usageThisBill;\\ncontext.trace(\\\"globalAdj: \\\" +globalAdj);\\n//Sum all electricity charges\\nBigDecimal electricity = electCharge+globalAdjDisp;\\ncontext.trace(\\\"Electricity Charges:\\\" +electricity);\\n//Sum all transmission charges\\nBigDecimal transmission = transCon+transNetwrk;\\ncontext.trace(\\\"Transmission Charges:\\\" +transmission);\\n//Sum all distribution charges\\nBigDecimal distribution = distribCharge+transformAllow+oneHourMCC;\\ncontext.trace(\\\"Distribution Charges:\\\" +distribution);\\n//Sum all regulatory charges\\nBigDecimal regulatory = oneHourSSAF + wholesaleMarket;\\ncontext.trace(\\\"Regulatory Charge:\\\" +regulatory);\\n//Add subtotals for total charge and apply HST\\nBigDecimal totalCharges = (electricity+transmission+distribution+regulatory+globalAdj)*1.13;\\ncontext.trace(\\\"Total Charges = \\\" +totalCharges);\\n//OUTPUTS\\n//Current billed demand\\nbilledDemandOut.value=billedDemand;\\n//Electricity Charge\\nelectChargeOut.value=electCharge;\\n//Estimated total hourly charge\\ntotalChargeOut.value=totalCharges;\\n//Estimate total charge(converted to cents/m3)\\nif(50.0<flow.value){\\n    flowCharge.value= (totalCharges*100)/(flow.value*3600/1000);\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-08-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : false,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"ceef61bf-35ae-4f25-8b10-6cc98c88029a\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"KWHGADisp\",\n  \"description\" : \"Kitchener Wilmot Hydro Global Adjustment Disposition Class B Customer\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : 0.2480,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 3.2265,\n    \"start\" : \"2016-03-01T00:00:00.000\",\n    \"end\" : \"2020-03-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"KWHTransNtwk\",\n  \"description\" : \"Kitchener Wilmot Hydro Transmission Network Charge\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : 3.2990,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 0.7836,\n    \"start\" : \"2016-03-01T00:00:00.000\",\n    \"end\" : \"2020-03-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"KWHTransCnx\",\n  \"description\" : \"Kitchener Wilmot Hydro Transmission Connection Charge\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : 0.7580,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 4.7019,\n    \"start\" : \"2016-03-01T00:00:00.000\",\n    \"end\" : \"2020-03-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"KWHDistrib\",\n  \"description\" : \"Kitchener Wilmot Hydro Distribution Charge\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : 3.8543,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 175.8300,\n    \"start\" : \"2016-03-01T00:00:00.000\",\n    \"end\" : \"2020-03-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"KWHMonthly\",\n  \"description\" : \"Kitchener Wilmot Hydro Monthly Customer Charge\",\n  \"units\" : \"$/month\",\n  \"defaultValue\" : 172.47,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"KWHTransCR\",\n  \"description\" : \"Kitchener Wilmot Hydro Customer Owned Transformer Credit\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : -0.60,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"KWHSSAdmin\",\n  \"description\" : \"Kitchener Wilmot Hydro Standard Supply Administration Fee\",\n  \"units\" : \"$/month\",\n  \"defaultValue\" : 0.25,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 0.0060,\n    \"start\" : \"2016-03-01T00:00:00.000\",\n    \"end\" : \"2020-03-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"KWHWholeMkt\",\n  \"description\" : \"Kitchener Wilmot Hydro Wholsesale Market Charge\",\n  \"units\" : \"$/kWh\",\n  \"defaultValue\" : 0.0057,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"KWHUAF\",\n  \"description\" : \"Kitchener Wilmot Hydro Usage Adjustment Factor (Mannheim WTP)\",\n  \"units\" : \"\",\n  \"defaultValue\" : 0.0226,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"KWHDebtRetire\",\n  \"description\" : \"Kitchener Wilmot Debt Retirement Charge\",\n  \"units\" : \"$/kWh\",\n  \"defaultValue\" : 0.0070,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MTPEPM_MTHLY_BILLED_DMD\",\"name\":\"billedDemandOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT4H\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MTPEPM_HRLY_ENERGY_CHARGE\",\"name\":\"electChargeOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT4H\",\"scale\":5}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MTPEPM_TOT_CHRGE_M3_EST\",\"name\":\"flowCharge\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT4H\",\"scale\":5}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MTPEPM_TOT_HRLY_CHARGE_EST\",\"name\":\"totalChargeOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT4H\",\"scale\":5}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Mannheim Power Hourly Maximum 15 Minute Rolling Averages\",\n  \"description\" : \"Calculates hourly maximum 15 minute rolling averages based on five minute maximums\",\n  \"schedule\" : \"30 * * * *\",\n  \"lastRunMessage\" : \"d74108ef-2e2b-4608-bc6a-934359270f48\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"ET.MTPH.MTPEPM0100QPV_CALC:first:PT5M\",\n    \"name\" : \"kVA\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT95M\",\n    \"duration\" : \"PT70M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0100VPV.F_CV:maximum:PT5M\",\n    \"name\" : \"kVA1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT95M\",\n    \"duration\" : \"PT70M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0200VPV.F_CV:maximum:PT5M\",\n    \"name\" : \"kVA2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT95M\",\n    \"duration\" : \"PT70M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0100VKR.F_CV:maximum:PT5M\",\n    \"name\" : \"PM1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT95M\",\n    \"duration\" : \"PT70M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.MTPEPM0200VKR.F_CV:maximum:PT5M\",\n    \"name\" : \"PM2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT95M\",\n    \"duration\" : \"PT70M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MTPH.MTPEPM0100QPV_MAX15\",\n    \"name\" : \"MaxkVAFifteenRoll\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT90M\",\n    \"scale\" : 8\n  }, {\n    \"value\" : \"ET.MTPH.MTPEPM0100VKR_MAX15\",\n    \"name\" : \"MaxkWFifteenRoll\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT90M\",\n    \"scale\" : 8\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//**CALCULATION 1: Calculating hourly maximum 15 minute rolling averages **\\n//Initialize list for sum of five minute power maximums\\nList FiveMintPwrMax= new ArrayList();\\n//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(PM1,PM2,30);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs) {\\n    //Add the sum of the input pair to the list \\\"FiveMintPwrMax\\\"\\n    FiveMintPwrMax.add(pair.a.value + pair.b.value);\\n    //context.trace(FiveMintPwrMax);\\n}\\n//Initialize variable for rolling 15 minute average\\nBigDecimal FifteenAvg = 0;\\n//Initialize variable for maximum of the rolling 15 minute averages\\nBigDecimal MaxFifteen=0;\\n//Iterate through array of 5 minute maximum power readings\\nfor(int i=1;\\n    i<FiveMintPwrMax.size()-1;\\n    i++){\\n    //Calculate the average of each block of 3 five minute maximums to get a 15 minute rolling average\\n    FifteenAvg = (FiveMintPwrMax.get(i-1)+FiveMintPwrMax.get(i)+FiveMintPwrMax.get(i+1))/3;\\n    //Store maximum fifteen minute rolling average\\n    if(FifteenAvg > MaxFifteen){\\n        MaxFifteen = FifteenAvg;\\n    }\\n}\\nMaxkWFifteenRoll.value=MaxFifteen;\\n//context.trace(\\\"MaxFifteen is \\\" + MaxkWFifteenRoll.value);\\n//Initialize list for sum of five minute kVA maximums\\nList FiveMintkVAMax = new ArrayList();\\nforeach(kVAelement:kVA.array){\\n    FiveMintkVAMax.add(kVAelement.value);\\n}\\n//context.trace(\\\"FiveMintkVAMax is\\\" + FiveMintkVAMax );\\n//Initialize variable for rolling 15 minute kVA average\\nBigDecimal FifteenkVAAvg = 0;\\n//Initialize variable for maximum of the rolling 15 minute kVA averages\\nBigDecimal MaxkVAFifteen=0;\\nfor(int i=1;\\n    i<FiveMintkVAMax.size()-1;\\n    i++){\\n    //Calculate the average of each block of 3 five minute kVA maximums to get a 15 minute rolling average \\n    FifteenkVAAvg = (FiveMintkVAMax.get(i-1)+FiveMintkVAMax.get(i)+FiveMintkVAMax.get(i+1))/3;\\n    //Store maximum fifteen minute rolling average\\n    if(FifteenkVAAvg > MaxkVAFifteen){\\n        MaxkVAFifteen = FifteenkVAAvg;\\n    }\\n}\\nMaxkVAFifteenRoll.value=MaxkVAFifteen;\\n//context.trace(\\\"MaxkVAFifteen is \\\" + MaxkVAFifteenRoll.value);\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-07-17T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",PM2,PM1,kVA,kVA1,kVA2\",\n    \"outputs\" : \",MaxkVAFifteenRoll,MaxkWFifteenRoll\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : false\n  }, {\n    \"value\" : \"//**CALCULATION 1: Calculating hourly maximum 15 minute rolling averages **\\n//Initialize list for sum of five minute power maximums\\nList FiveMintPwrMax= new ArrayList();\\n//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(PM1,PM2,30);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs) {\\n    //Add the sum of the input pair to the list \\\"FiveMintPwrMax\\\"\\n    FiveMintPwrMax.add(pair.a.value + pair.b.value);\\n    //context.trace(FiveMintPwrMax);\\n}\\n//Initialize variable for rolling 15 minute average\\nBigDecimal FifteenAvg = 0;\\n//Initialize variable for maximum of the rolling 15 minute averages\\nBigDecimal MaxFifteen=0;\\n//Iterate through array of 5 minute maximum power readings\\nfor(int i=1;\\n    i<FiveMintPwrMax.size()-1;\\n    i++){\\n    //Calculate the average of each block of 3 five minute maximums to get a 15 minute rolling average\\n    FifteenAvg = (FiveMintPwrMax.get(i-1)+FiveMintPwrMax.get(i)+FiveMintPwrMax.get(i+1))/3;\\n    //Store maximum fifteen minute rolling average\\n    if(FifteenAvg > MaxFifteen){\\n        MaxFifteen = FifteenAvg;\\n    }\\n}\\nMaxkWFifteenRoll.value=MaxFifteen;\\n//context.trace(\\\"MaxFifteen is \\\" + MaxkWFifteenRoll.value);\\n\\n//Initialize list for sum of five minute apparent power maximums\\nList FiveMintkVAMax= new ArrayList();\\n//Tag pair of primary and secondary tag\\nTagInputPair tipb = new TagInputPair(kVA1,kVA2,30);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tipb.pairs) {\\n    //Add the sum of the input pair to the list \\\"FiveMintkVAMax\\\"\\n    FiveMintkVAMax.add(pair.a.value + pair.b.value);\\n    //context.trace(FiveMintlVAMax);\\n}\\n//context.trace(\\\"FiveMintkVAMax is\\\" + FiveMintkVAMax );\\n//Initialize variable for rolling 15 minute kVA average\\nBigDecimal FifteenkVAAvg = 0;\\n//Initialize variable for maximum of the rolling 15 minute kVA averages\\nBigDecimal MaxkVAFifteen=0;\\nfor(int i=1;\\n    i<FiveMintkVAMax.size()-1;\\n    i++){\\n    //Calculate the average of each block of 3 five minute kVA maximums to get a 15 minute rolling average \\n    FifteenkVAAvg = (FiveMintkVAMax.get(i-1)+FiveMintkVAMax.get(i)+FiveMintkVAMax.get(i+1))/3;\\n    //Store maximum fifteen minute rolling average\\n    if(FifteenkVAAvg > MaxkVAFifteen){\\n        MaxkVAFifteen = FifteenkVAAvg;\\n    }\\n}\\nMaxkVAFifteenRoll.value=MaxkVAFifteen;\\n//context.trace(\\\"MaxkVAFifteen is \\\" + MaxkVAFifteenRoll.value);\\n\",\n    \"version\" : 2,\n    \"start\" : \"2015-09-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",PM2,PM1,kVA,kVA1,kVA2\",\n    \"outputs\" : \",MaxkVAFifteenRoll,MaxkWFifteenRoll\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : false\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"d74108ef-2e2b-4608-bc6a-934359270f48\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MTPH.MTPEPM0100QPV_MAX15\",\"name\":\"MaxkVAFifteenRoll\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT90M\",\"scale\":8}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MTPH.MTPEPM0100VKR_MAX15\",\"name\":\"MaxkWFifteenRoll\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT90M\",\"scale\":8}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Mannheim_UV_Report_Calculation\",\n  \"description\" : \"\",\n  \"schedule\" : \"0 6 * * *\",\n  \"lastRunMessage\" : \"7d4f5e0b-8bdf-42b5-94a7-07b8c03d5da1\",\n  \"constant\" : [ \"MannheimTurbHI\", \"MannheimUVCCL\", \"MannheimUVFlowHI\", \"MannheimFilterFlowPosition\", \"MannheimUVTLow\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR1.MTPUV0010000VST.F_CV:minimum:PT2M\",\n    \"name\" : \"dosage1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPUV0020000VST.F_CV:minimum:PT2M\",\n    \"name\" : \"dosage2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL001OV01QZI.F_CV:maximum:PT2M\",\n    \"name\" : \"filterValve1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.MTPFL001OV01QZI.F_CV\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL002OV01QZI.F_CV:maximum:PT2M\",\n    \"name\" : \"filterValve2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.MTPFL002OV01QZI.F_CV\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL003OV01QZI.F_CV:maximum:PT2M\",\n    \"name\" : \"filterValve3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.MTPFL003OV01QZI.F_CV\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL004OV01QZI.F_CV:maximum:PT2M\",\n    \"name\" : \"filterValve4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.MTPFL004OV01QZI.F_CV\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL001FI01QVA.F_CV:average:PT2M\",\n    \"name\" : \"flow1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.MTPFL001FI01QVA.F_CV\\\",\\\"mode\\\":\\\"average\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL002FI01QVA.F_CV:average:PT2M\",\n    \"name\" : \"flow2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.MTPFL002FI01QVA.F_CV\\\",\\\"mode\\\":\\\"average\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL003FI01QVA.F_CV:average:PT2M\",\n    \"name\" : \"flow3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.MTPFL003FI01QVA.F_CV\\\",\\\"mode\\\":\\\"average\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL004FI01QVA.F_CV:average:PT2M\",\n    \"name\" : \"flow4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.MTPFL004FI01QVA.F_CV\\\",\\\"mode\\\":\\\"average\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL001NI01QVA.F_CV:maximum:PT2M\",\n    \"name\" : \"turbidity1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.MTPFL001NI01QVA.F_CV\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL002NI01QVA.F_CV:maximum:PT2M\",\n    \"name\" : \"turbidity2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.MTPFL002NI01QVA.F_CV\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL003NI01QVA.F_CV:maximum:PT2M\",\n    \"name\" : \"turbidity3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.MTPFL003NI01QVA.F_CV\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL004NI01QVA.F_CV:maximum:PT2M\",\n    \"name\" : \"turbidity4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR1.MTPFL004NI01QVA.F_CV\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPUV000XM01QVA.F_CV:minimum:PT2M\",\n    \"name\" : \"UVTIn\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPUV01IOVOP.F_CV:maximum:PT2M\",\n    \"name\" : \"valve1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPUV02IOVOP.F_CV:maximum:PT2M\",\n    \"name\" : \"valve2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.Mannheim_Discharge_Daily_Compliance_Duration\",\n    \"name\" : \"Daily_Duration\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_Discharge_Daily_Compliance_Total_Flow\",\n    \"name\" : \"Daily_Flow\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_Discharge_Total_Flow_Compliance_Duration\",\n    \"name\" : \"Flow_Duration\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_Discharge_Total_Flow_Compliance_MAX\",\n    \"name\" : \"Flow_Max\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_Discharge_Total_Flow_Compliance_Total_Flow\",\n    \"name\" : \"Flow_Total\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_Discharge_NTU_Compliance_Device\",\n    \"name\" : \"NTU_Device\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 0\n  }, {\n    \"value\" : \"ET.Mannheim_Discharge_NTU_Compliance_Duration\",\n    \"name\" : \"NTU_Duration\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_Discharge_NTU_Compliance_Total_Flow\",\n    \"name\" : \"NTU_Flow\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_Discharge_NTU_Compliance_MAX\",\n    \"name\" : \"NTU_Max\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_Discharge_UV_Dosage_Compliance_Duration\",\n    \"name\" : \"UV_Duration\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_Discharge_UV_Dosage_Compliance_Total_Flow\",\n    \"name\" : \"UV_Flow\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_Discharge_UV_Dosage_Compliance_MIN\",\n    \"name\" : \"UV_Min\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_UVT_Compliance_Duration\",\n    \"name\" : \"UVT_Duration\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_UVT_Compliance_Total_Flow\",\n    \"name\" : \"UVT_Flow\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_UVT_Compliance_MIN\",\n    \"name\" : \"UVT_Min\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Variables\\r\\n//Array Index\\r\\nint index = 0;\\r\\n// Event tracking\\r\\n// null indicates no current event\\r\\nData NTU_Event_MAX = null;\\r\\nData NTU_Event_Device = null;\\r\\nData NTU_Event_Duration = null;\\r\\nData NTU_Event_Flow = null;\\r\\n// null indicates no current event\\r\\nData UV_Event_MIN = null;\\r\\nData UV_Event_Duration = null;\\r\\nData UV_Event_Flow = null;\\r\\n// null indicates no current event\\r\\nData Flow_Event_MAX = null;\\r\\nData Flow_Event_Duration = null;\\r\\nData Flow_Event_Flow = null;\\r\\nDaily_Duration.value = 0;\\r\\nDaily_Flow.value = 0.0;\\r\\n// null indicates no current event\\r\\nData UVT_Event_MIN = null;\\r\\nData UVT_Event_Duration = null;\\r\\nData UVT_Event_Flow = null;\\r\\ndef endUVTEvent() {\\r\\n    if(UVT_Event_MIN != null){\\r\\n        context.trace(\\\"UVT Event time, Duration, Flow: \\\"+UVT_Event_MIN.time+\\\", \\\"+UVT_Event_MIN.value+\\\", \\\"+UVT_Event_Duration.value+\\\", \\\"+UVT_Event_Flow.value);\\r\\n        UVT_Event_MIN = null;\\r\\n    }\\r\\n}\\r\\ndef endNTUEvent() {\\r\\n    if (NTU_Event_MAX != null) {\\r\\n        context.trace(\\\"NTU Event time,MAX,Device,Duration,Flow: \\\"+NTU_Event_MAX.time+\\\", \\\"+NTU_Event_MAX.value+\\\", \\\"+NTU_Event_Device.value+\\\", \\\"+NTU_Event_Duration.value+\\\", \\\"+NTU_Event_Flow.value);\\r\\n        NTU_Event_MAX = null;\\r\\n    }\\r\\n}\\r\\ndef endUVEvent() {\\r\\n    if (UV_Event_MIN != null) {\\r\\n        context.trace(\\\"UV Event time,MIN,Duration,Flow: \\\"+UV_Event_MIN.time+\\\", \\\"+UV_Event_MIN.value+\\\", \\\"+UV_Event_Duration.value+\\\", \\\"+UV_Event_Flow.value);\\r\\n        UV_Event_MIN = null;\\r\\n    }\\r\\n}\\r\\ndef endFlowEvent() {\\r\\n    if (Flow_Event_MAX != null) {\\r\\n        context.trace(\\\"Flow Event time,MAX,Duration,Flow: \\\"+Flow_Event_MAX.time+\\\", \\\"+Flow_Event_MAX.value+\\\", \\\"+Flow_Event_Duration.value+\\\", \\\"+Flow_Event_Flow.value);\\r\\n        Flow_Event_MAX = null;\\r\\n    }\\r\\n}\\r\\n//Fill in any data gaps\\r\\nfor (TagInput input: inputs ) {\\r\\n    input.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\n}\\r\\nint iterations = valve1.array.size();\\r\\n//Loop over the data\\r\\nfor (int index=0;\\r\\n     index < iterations;\\r\\n     index++) {\\r\\n    Data fv1 = filterValve1.asc.get(index);\\r\\n    Data fv2 = filterValve2.asc.get(index);\\r\\n    Data fv3 = filterValve3.asc.get(index);\\r\\n    Data fv4 = filterValve4.asc.get(index);\\r\\n    Data v1 = valve1.asc.get(index);\\r\\n    Data v2 = valve2.asc.get(index);\\r\\n    Data d1 = dosage1.asc.get(index);\\r\\n    Data d2 = dosage2.asc.get(index);\\r\\n    Data t1 = turbidity1.asc.get(index);\\r\\n    Data t2 = turbidity2.asc.get(index);\\r\\n    Data t3 = turbidity3.asc.get(index);\\r\\n    Data t4 = turbidity4.asc.get(index);\\r\\n    Data f1 = flow1.asc.get(index);\\r\\n    Data f2 = flow2.asc.get(index);\\r\\n    Data f3 = flow3.asc.get(index);\\r\\n    Data f4 = flow4.asc.get(index);\\r\\n    Data u1 = UVTIn.asc.get(index);\\r\\n    boolean activeFlow = (v1.good && v1.value == 1) || (v2.good && v2.value == 1);\\r\\n    XMLGregorianCalendar time = v1.time;\\r\\n    //\\r\\n    if (activeFlow) {\\r\\n        // calculate interval flow (we may need it)\\r\\n        BigDecimal intervalFlowRate = 0.0;\\r\\n        if (fv1.good && fv1.value > MannheimFilterFlowPosition.value && f1.good)\\r\\n            intervalFlowRate += f1.value;\\r\\n        if (fv2.good && fv2.value > MannheimFilterFlowPosition.value && f2.good)\\r\\n            intervalFlowRate += f2.value;\\r\\n        if (fv3.good && fv3.value > MannheimFilterFlowPosition.value && f3.good)\\r\\n            intervalFlowRate += f3.value;\\r\\n        if (fv4.good && fv4.value > MannheimFilterFlowPosition.value && f4.good)\\r\\n            intervalFlowRate += f4.value;\\r\\n        //\\r\\n        //\\r\\n        // Turbidity Compliance Checks\\r\\n        BigDecimal NTU_Value = 0.0;\\r\\n        String NTU_Device_Number = 0;\\r\\n        if (fv1.good && fv1.value > MannheimFilterFlowPosition.value && t1.value > MannheimTurbHI.value) {\\r\\n            NTU_Value = t1.value;\\r\\n            NTU_Device_Number = 1\\r\\n        }\\r\\n        if (fv2.good && fv2.value > MannheimFilterFlowPosition.value && t2.value > MannheimTurbHI.value) {\\r\\n            if (NTU_Value == null || t2.value > NTU_Value) {\\r\\n                NTU_Value = t2.value;\\r\\n                NTU_Device_Number = 2;\\r\\n            }\\r\\n        }\\r\\n        if (fv3.good && fv3.value > MannheimFilterFlowPosition.value && t3.value > MannheimTurbHI.value) {\\r\\n            if (NTU_Value == null || t3.value > NTU_Value) {\\r\\n                NTU_Value = t3.value;\\r\\n                NTU_Device_Number = 3;\\r\\n            }\\r\\n        }\\r\\n        if (fv4.good && fv4.value > MannheimFilterFlowPosition.value && t4.value > MannheimTurbHI.value) {\\r\\n            if (NTU_Value == null || t4.value > NTU_Value) {\\r\\n                NTU_Value = t4.value;\\r\\n                NTU_Device_Number = 4;\\r\\n            }\\r\\n        }\\r\\n        // if this is an NTU event\\r\\n        if (NTU_Device_Number > 0) {\\r\\n            // an event!\\r\\n            if (NTU_Event_MAX == null) {\\r\\n                NTU_Event_MAX = new Data(time, NTU_Value, 100);\\r\\n                NTU_Event_Device = new Data(time, NTU_Device_Number, 100);\\r\\n                NTU_Event_Duration = new Data(time, 2, 100);\\r\\n                NTU_Event_Flow = new Data(time, (intervalFlowRate * 120 /1000), 100);\\r\\n                NTU_Max.add(NTU_Event_MAX);\\r\\n                NTU_Device.add(NTU_Event_Device);\\r\\n                NTU_Duration.add(NTU_Event_Duration);\\r\\n                NTU_Flow.add(NTU_Event_Flow);\\r\\n            }\\r\\n            else {\\r\\n                if (NTU_Value > NTU_Event_MAX.value) {\\r\\n                    NTU_Event_MAX.value = NTU_Value;\\r\\n                    NTU_Event_Device.value = NTU_Device;\\r\\n                }\\r\\n                NTU_Event_Duration.value += 2;\\r\\n                NTU_Event_Flow.value += (intervalFlowRate * 120/1000);\\r\\n            }\\r\\n        }\\r\\n        else {\\r\\n            // NTU event has ended (if there is one)\\r\\n            endNTUEvent();\\r\\n        }\\r\\n        //\\r\\n        //\\r\\n        // UV Dosage Compliance Checks\\r\\n        BigDecimal UV_Value = null;\\r\\n        if (v1.good && v1.value == 1 && d1.good && d1.value < MannheimUVCCL.value)\\r\\n            UV_Value = d1.value;\\r\\n        if (v2.good && v2.value == 1 && d2.good && d2.value < MannheimUVCCL.value){\\r\\n            if (UV_Value == null || d2.value < UV_Value) {\\r\\n                UV_Value = d2.value;\\r\\n            }\\r\\n        }\\r\\n        if (UV_Value != null) {\\r\\n            // an event!\\r\\n            if (UV_Event_MIN == null) {\\r\\n                UV_Event_MIN = new Data(time, UV_Value, 100);\\r\\n                UV_Event_Duration = new Data(time, 2, 100);\\r\\n                UV_Event_Flow = new Data(time, (intervalFlowRate * 120 / 1000), 100);\\r\\n                UV_Min.add(UV_Event_MIN);\\r\\n                UV_Duration.add(UV_Event_Duration);\\r\\n                UV_Flow.add(UV_Event_Flow);\\r\\n            }\\r\\n            else {\\r\\n                if (UV_Value < UV_Event_MIN.value)\\r\\n                    UV_Event_MIN.value = UV_Value;\\r\\n                UV_Event_Duration.value += 2;\\r\\n                UV_Event_Flow.value += (intervalFlowRate * 120/1000);\\r\\n            }\\r\\n        }\\r\\n        else {\\r\\n            // UV event has ended (if there is one)\\r\\n            endUVEvent();\\r\\n        }\\r\\n        // Flow Dosage Compliance Checks\\r\\n        if (intervalFlowRate > MannheimUVFlowHI.value) {\\r\\n            // an event!\\r\\n            if (Flow_Event_MAX == null) {\\r\\n                Flow_Event_MAX = new Data(time, intervalFlowRate, 100);\\r\\n                Flow_Event_Duration = new Data(time, 2, 100);\\r\\n                Flow_Event_Flow = new Data(time, (intervalFlowRate * 120 /1000), 100);\\r\\n                Flow_Max.add(Flow_Event_MAX);\\r\\n                Flow_Duration.add(Flow_Event_Duration);\\r\\n                Flow_Total.add(Flow_Event_Flow);\\r\\n            }\\r\\n            else {\\r\\n                if (intervalFlowRate > Flow_Event_MAX.value)\\r\\n                    Flow_Event_MAX.value = intervalFlowRate;\\r\\n                Flow_Event_Duration.value += 2;\\r\\n                Flow_Event_Flow.value += (intervalFlowRate * 120/1000);\\r\\n            }\\r\\n        }\\r\\n        else {\\r\\n            // Flow event has ended (if there is one)\\r\\n            endFlowEvent();\\r\\n        }\\r\\n        if(u1.value < MannheimUVTLow.value){\\r\\n            if(UVT_Event_MIN == null){\\r\\n                UVT_Event_MIN = new Data(time,u1.value,100);\\r\\n                UVT_Event_Duration = new Data (time, 2, 100);\\r\\n                UVT_Event_Flow = new Data(time,(intervalFlowRate * 120/1000),100);\\r\\n                UVT_Min.add(UVT_Event_MIN);\\r\\n                UVT_Duration.add(UVT_Event_Duration);\\r\\n                UVT_Flow.add(UVT_Event_Flow);\\r\\n            }\\r\\n            else{\\r\\n                if(u1.value < UVT_Event_MIN.value){\\r\\n                    UVT_Event_MIN.value = u1.value;\\r\\n                    UVT_Event_Duration.value += 2;;\\r\\n                    UVT_Event_Flow.value += (intervalFlowRate * 120/1000);\\r\\n                }\\r\\n            }\\r\\n        }\\r\\n        else{\\r\\n            //UVT Event has ended if there was one\\r\\n            endUVTEvent();\\r\\n        }\\r\\n        //\\r\\n        //\\r\\n        // Update Daily Totals...\\r\\n        if (NTU_Event_MAX != null || UV_Event_MIN != null || Flow_Event_MAX != null || UVT_Event_MIN != null) {\\r\\n            Daily_Duration.value += 2;\\r\\n            Daily_Flow.value += (intervalFlowRate * 120/1000);\\r\\n        }\\r\\n    }\\r\\n    else {\\r\\n        // check if there are any events, and end them\\r\\n        endNTUEvent();\\r\\n        endUVEvent();\\r\\n        endFlowEvent();\\r\\n        endUVTEvent();\\r\\n    }\\r\\n}\\r\\nendNTUEvent();\\r\\nendUVEvent();\\r\\nendFlowEvent();\\r\\nendUVTEvent();\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2017-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",dosage2,filterValve2,dosage1,filterValve3,filterValve1,turbidity4,valve1,filterValve4,turbidity2,turbidity3,valve2,UVTIn,flow1,flow2,flow3,flow4,turbidity1,__results__\",\n    \"outputs\" : \",Daily_Flow,Daily_Duration\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"7d4f5e0b-8bdf-42b5-94a7-07b8c03d5da1\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MannheimTurbHI\",\n  \"description\" : \"Mannheim turbidity high limit\",\n  \"units\" : \"NTU\",\n  \"defaultValue\" : 0.9,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MannheimUVCCL\",\n  \"description\" : \"Critical control limit for Mannheim UV Dose\",\n  \"units\" : \"mJ/cm2\",\n  \"defaultValue\" : 40,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MannheimUVFlowHI\",\n  \"description\" : \"Mannheim UV Max Flow limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 840,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MannheimFilterFlowPosition\",\n  \"description\" : \"Minimum valve opening for flow to be recognized\",\n  \"units\" : \"%\",\n  \"defaultValue\" : 5,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MannheimUVTLow\",\n  \"description\" : \"Minimum UVT % for low limit\",\n  \"units\" : \"%\",\n  \"defaultValue\" : 75,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_Daily_Compliance_Duration\",\"name\":\"Daily_Duration\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_Daily_Compliance_Total_Flow\",\"name\":\"Daily_Flow\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_Total_Flow_Compliance_Duration\",\"name\":\"Flow_Duration\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_Total_Flow_Compliance_MAX\",\"name\":\"Flow_Max\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_Total_Flow_Compliance_Total_Flow\",\"name\":\"Flow_Total\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_NTU_Compliance_Device\",\"name\":\"NTU_Device\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":0}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_NTU_Compliance_Duration\",\"name\":\"NTU_Duration\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_NTU_Compliance_Total_Flow\",\"name\":\"NTU_Flow\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_NTU_Compliance_MAX\",\"name\":\"NTU_Max\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_UV_Dosage_Compliance_Duration\",\"name\":\"UV_Duration\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_UV_Dosage_Compliance_Total_Flow\",\"name\":\"UV_Flow\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_UV_Dosage_Compliance_MIN\",\"name\":\"UV_Min\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_UVT_Compliance_Duration\",\"name\":\"UVT_Duration\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_UVT_Compliance_Total_Flow\",\"name\":\"UVT_Flow\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_UVT_Compliance_MIN\",\"name\":\"UVT_Min\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"d50837eb-41ac-4c7e-a833-69a9bb28456f\",\"source\":\"Mannheim_UV_Report_Calculation\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Mannheim_UV_Report_Calculations\",\n  \"description\" : \"Mannheim UV report calculations\",\n  \"schedule\" : \"0 4 * * *\",\n  \"lastRunMessage\" : \"bbf52441-bf53-408c-9c39-8dc87525c7f8\",\n  \"constant\" : [ \"MannheimTurbHI\", \"MannheimUVCCL\", \"MannheimUVFlowHI\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR1.MTPUV0010000VST.F_CV:rawByTime:PT2M\",\n    \"name\" : \"dosage1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPUV0020000VST.F_CV:rawByTime:PT2M\",\n    \"name\" : \"dosage2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL01FIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"flow1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL02FIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"flow2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL03FIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"flow3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL04FIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"flow4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL01NIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"turbidity1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL02NIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"turbidity2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL03NIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"turbidity3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPFL04NIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"turbidity4\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPUV01IOVOP.F_CV:last:PT2M\",\n    \"name\" : \"valve1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR1.MTPUV02IOVOP.F_CV:last:PT2M\",\n    \"name\" : \"valve2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.Mannheim_Discharge_NTU_Compliance\",\n    \"name\" : \"Discharge_NTU_Compliance\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_UV_Dose_Compliance_Duration\",\n    \"name\" : \"outDosageDuration\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_UV_Flow_Compliance_Duration\",\n    \"name\" : \"outFlowDuration\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_UV_Compliance_Total_Volume\",\n    \"name\" : \"outTotalFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_Discharge_NTU_Compliance_Duration\",\n    \"name\" : \"outTurbidityDuration\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_UV_Dose_Compliance\",\n    \"name\" : \"UV_Dose_Compliance\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.Mannheim_UV_Flow_Compliance\",\n    \"name\" : \"UV_Flow_Compliance\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Variables\\r\\n//Array Index\\r\\nInteger index = 0;\\r\\n//Dosage over indicators\\r\\nBoolean dosage1Over = false;\\r\\nBoolean dosage2Over = false;\\r\\n//Turbidiy over indicator\\r\\nBoolean turbidityOver = false;\\r\\n//All over indicator\\r\\nBoolean allOver = false;\\r\\n//Flow total\\r\\nBigDecimal totalFlow = 0;\\r\\n//Total overage flow\\r\\nBigDecimal totalFlowOver = 0;\\r\\n//Last sample time\\r\\nBigDecimal lastTime = 0;\\r\\n//Overage start time\\r\\nBigDecimal overageStart = 0;\\r\\n//Overage duartion total\\r\\nBigDecimal overageDuration = 0;\\r\\n//Fill in any data gaps\\r\\nvalve1.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\nvalve2.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\ndosage1.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\ndosage2.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\nturbidity1.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\nturbidity2.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\nturbidity3.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\nturbidity4.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\nflow1.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\nflow2.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\nflow3.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\nflow4.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\n//Loop over the data\\r\\nfor(Data vlv1 : valve1.array){\\r\\n    //If the valve is open check its dosage\\r\\n    if(null != vlv1.value && 100 == vlv1.quality && 1 == vlv1.value){\\r\\n        if(null != dosage1.asc[index].value && 100 == dosage1.asc[index].quality && MannheimUVCCL.value > dosage1.asc[index].value){\\r\\n            dosage1Over = true;\\r\\n            UV_Dose_Compliance.add(new Data(dosage1.asc[index].time, dosage1.asc[index].value, 100));\\r\\n        }\\r\\n    }\\r\\n    if(null != valve2.asc[index].value && 100 == valve2.asc[index].quality && 1 == valve2.asc[index].value){\\r\\n        if(null != dosage2.asc[index].value && 100 == dosage2.asc[index].quality && MannheimUVCCL.value > dosage2.asc[index].value){\\r\\n            dosage2Over = true;\\r\\n            UV_Dose_Compliance.add(new Data(dosage2.asc[index].time, dosage2.asc[index].value, 100));\\r\\n        }\\r\\n    }\\r\\n    //Check to see if any of the turbidities are over if limit\\r\\n    if(null != turbidity1.asc[index].value && 100 == turbidity1.asc[index].quality && MannheimTurbHI.value <= turbidity1.asc[index].value){\\r\\n        turbidityOver = true;\\r\\n        Discharge_NTU_Compliance.add(new Data(turbidity1.asc[index].time, turbidity1.asc[index].value, 100));\\r\\n    }\\r\\n    else if(null != turbidity2.asc[index].value && 100 == turbidity2.asc[index].quality && MannheimTurbHI.value <= turbidity2.asc[index].value){\\r\\n        turbidityOver = true;\\r\\n        Discharge_NTU_Compliance.add(new Data(turbidity2.asc[index].time ,turbidity2.asc[index].value, 100));\\r\\n    }\\r\\n    else if(null != turbidity3.asc[index].value && 100 == turbidity3.asc[index].quality && MannheimTurbHI.value <= turbidity3.asc[index].value){\\r\\n        turbidityOver = true;\\r\\n        Discharge_NTU_Compliance.add(new Data(turbidity3.asc[index].time, turbidity3.asc[index].value, 100));\\r\\n    }\\r\\n    else if(null != turbidity4.asc[index].value && 100 == turbidity4.asc[index].quality && MannheimTurbHI.value <= turbidity4.asc[index].value){\\r\\n        turbidityOver = true;\\r\\n        Discharge_NTU_Compliance.add(new Data(turbidity4.asc[index].time,turbidity4.asc[index].value,100));\\r\\n    }\\r\\n    //If the doasge and turbidity are over then total the flow and check if it is over as well\\r\\n    if(true == turbidityOver && (true == dosage1Over || true == dosage2Over)){\\r\\n        //Total flows\\r\\n        if(null != flow1.asc[index].value && 100 == flow1.asc[index].quality){\\r\\n            totalFlow = totalFlow + flow1.asc[index].value;\\r\\n        }\\r\\n        if(null != flow2.asc[index].value && 100 == flow2.asc[index].quality){\\r\\n            totalFlow = totalFlow + flow2.asc[index].value;\\r\\n        }\\r\\n        if(null != flow3.asc[index].value && 100 == flow3.asc[index].quality){\\r\\n            totalFlow = totalFlow + flow3.asc[index].value;\\r\\n        }\\r\\n        if(null != flow4.asc[index].value && 100 == flow4.asc[index].quality){\\r\\n            totalFlow = totalFlow + flow4.asc[index].value;\\r\\n        }\\r\\n        //Check if the flow is out of compliance\\r\\n        if(MannheimUVFlowHI.value < totalFlow){\\r\\n            //Total flow for overflow\\r\\n            totalFlowOver = totalFlowOver + (totalFlow * (vlv1.timeInSeconds - lastTime));\\r\\n            UV_Flow_Compliance.add(new Data(flow1.asc[index].time, totalFlow, 100));\\r\\n            if(allOver == false){\\r\\n                //Set overage true\\r\\n                allOver = true;\\r\\n                //Record the start time\\r\\n                overageStart = vlv1.time;\\r\\n            }\\r\\n        }\\r\\n        else{\\r\\n            allOver = false;\\r\\n        }\\r\\n    }\\r\\n    else{\\r\\n        allOver = false;\\r\\n    }\\r\\n    if(allOver == true){\\r\\n        overageDuration = overageDuration + (vlv1.timeInSeconds - lastTime);\\r\\n    }\\r\\n    else if(overageDuration > 0){\\r\\n        //Output durations\\r\\n        outDosageDuration.add(new Data(overageStart, overageDuration, 100));\\r\\n        outTurbidityDuration.add(new Data(overageStart, overageDuration, 100));\\r\\n        outFlowDuration.add(new Data(overageStart, overageDuration, 100));\\r\\n        //Reset overage duration\\r\\n        overageDuration = 0;\\r\\n    }\\r\\n    //Set last variables\\r\\n    lastTime = flow1.asc[index].timeInSeconds;\\r\\n    //Reset variables\\r\\n    dosage1Over = false;\\r\\n    dosage2Over = false;\\r\\n    turbidityOver = false;\\r\\n    totalFlow = 0;\\r\\n    //Increase array index count\\r\\n    index++;\\r\\n}\\r\\n//Output total flow\\r\\noutTotalFlow.value = totalFlowOver;\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2017-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"bbf52441-bf53-408c-9c39-8dc87525c7f8\",\n  \"owner\" : \"ralbasel@regionofwaterloo.ca\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2018-02-01T04:00:00.000\",\n  \"enabled\" : false,\n  \"type\" : \"DIRECT\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MannheimTurbHI\",\n  \"description\" : \"Mannheim turbidity high limit\",\n  \"units\" : \"NTU\",\n  \"defaultValue\" : 0.9,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MannheimUVCCL\",\n  \"description\" : \"Critical control limit for Mannheim UV Dose\",\n  \"units\" : \"mJ/cm2\",\n  \"defaultValue\" : 40,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"MannheimUVFlowHI\",\n  \"description\" : \"Mannheim UV Max Flow limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 840,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_NTU_Compliance\",\"name\":\"Discharge_NTU_Compliance\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_UV_Dose_Compliance_Duration\",\"name\":\"outDosageDuration\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_UV_Flow_Compliance_Duration\",\"name\":\"outFlowDuration\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_UV_Compliance_Total_Volume\",\"name\":\"outTotalFlow\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_Discharge_NTU_Compliance_Duration\",\"name\":\"outTurbidityDuration\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_UV_Dose_Compliance\",\"name\":\"UV_Dose_Compliance\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.Mannheim_UV_Flow_Compliance\",\"name\":\"UV_Flow_Compliance\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Max Colour Highlight\",\n  \"description\" : \"Highlights the maximum value in a results set\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"473ea358-8d64-413b-8ced-298437070914\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"ET.VTS.CBWG005AIQ01.MMAX:raw:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P6M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"int i=0;\\nint maxIndex = 0;\\nBigDecimal max = 10;\\nforeach(element:__source__.array){\\n    if(element.value>max){\\n        max=element.value;\\n        maxIndex=i;\\n    }\\n    i++;\\n}\\n__source__.array[maxIndex].setColour(\\\"orange\\\");\\n\",\n    \"version\" : 1,\n    \"start\" : \"2005-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : false,\n    \"enabled\" : false\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"473ea358-8d64-413b-8ced-298437070914\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2005-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Middleton combined power\",\n  \"description\" : \"Outputs sum of power from PM1 and PM2\",\n  \"schedule\" : \"25 * * * *\",\n  \"lastRunMessage\" : \"81eabb4b-83d7-4020-9adc-752a4719c7cc\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MDPH.MDPSCDA.MDPPM0100VKR.F_CV:rawByTime:PT1H\",\n    \"name\" : \"powerOne\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPPM0200VKR.F_CV:rawByTime:PT1H\",\n    \"name\" : \"powerTwo\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MDPPM000VKR.F_CV\",\n    \"name\" : \"powerSum\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT1H\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Create new tag input pair matching timestamps of two power monitors\\nTagInputPair tip = new TagInputPair(powerOne,powerTwo,\\\"PT1M\\\");\\n//Loop through paired data\\nfor(DataPair pair:tip.pairs){\\n    //Add values of paired data together, use apply time stamp and quality of first\\n    Data total= new Data(pair.a.time,(pair.a.value+pair.b.value),pair.a.quality);\\n    //Output values\\n    powerSum.add(total);\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2014-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",powerTwo,powerOne,__results__\",\n    \"outputs\" : \",powerSum\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"81eabb4b-83d7-4020-9adc-752a4719c7cc\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"DIRECT\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MDPPM000VKR.F_CV\",\"name\":\"powerSum\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT1H\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Middleton Energy per m3\",\n  \"description\" : \"Outputs kWh per m3 water per hour\",\n  \"schedule\" : \"35 * * * *\",\n  \"lastRunMessage\" : \"d9f8d1d4-0828-4a76-a8ea-877c4117387e\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MDPH.MDPSCDA.MDPCB00FIQ01.F_CV:average:PT1H\",\n    \"name\" : \"avgInstFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPPM0100VKR.F_CV:rawByTime:PT1H\",\n    \"name\" : \"power1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPPM0200VKR.F_CV:rawByTime:PT1H\",\n    \"name\" : \"power2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MDPPM_KWH_M3\",\n    \"name\" : \"NRGVol\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT1H\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Initialize variables\\nBigDecimal total=0;\\nBigDecimal avgPower=0;\\nBigDecimal avgEnergyVol=0;\\nint count=0;\\nif(25.0<avgInstFlow.value){\\n    //Match timestamps of power values from both power monitors\\n    TagInputPair tip = new TagInputPair(power1,power2,\\\"PT1M\\\");\\n    for(DataPair pair:tip.pairs){\\n        if(null!=pair.a.value && null!=pair.b.value)\\n        {\\n            //Keep running total of sum of time-matched power values\\n            total += pair.a.value+pair.b.value;\\n            //context.trace(total);\\n            //Keep running count of number of matched pairs\\n            count++;\\n            //context.trace(count);\\n        }\\n    }\\n    //Prevent division by 0\\n    if(count!=0){\\n        //Calculate average power value\\n        avgPower=total/count;\\n        //context.trace(avgPower);\\n        //Prevent division by 0\\n        //Divide average power by average flow to get kW/(L/s)=kJ/L\\n        //Multiply result by 1000 to convert to kJ/m3\\n        //Divide result by 3600 to convert to kWh (1 kWh = 3600 kJ)\\n        avgEnergyVol=(avgPower/avgInstFlow.value)*1000/3600;\\n        //context.trace(\\\"avgEnergyVol: \\\" +avgEnergyVol);\\n    }\\n    //Output result\\n    NRGVol.value=avgEnergyVol;\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2014-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",avgInstFlow,__results__,power1,power2\",\n    \"outputs\" : \",NRGVol\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"d9f8d1d4-0828-4a76-a8ea-877c4117387e\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MDPPM_KWH_M3\",\"name\":\"NRGVol\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT1H\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Middleton Hydro Hourly Billing Estimate\",\n  \"description\" : \"Estimates hourly hydro bill for Middleton WTP\",\n  \"schedule\" : \"20 * * * *\",\n  \"lastRunMessage\" : \"33bc274e-851b-4b82-9cda-51e5b7775ac0\",\n  \"constant\" : [ \"CNDAdjustmentFactor\", \"CNDAdminFee\", \"CNDDebtRetire\", \"CNDDistribkWCharge\", \"CNDMnthlyServiceChrg\", \"CNDProvLineTransConn\", \"CNDRateRider\", \"CNDRateRidersVol\", \"CNDTransformAllow\", \"CNDWhlslMrkt\", \"CNDProvNtwrkTransRate\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MDPH.MDPSCDA.MDPCB00FIQ01.F_CV:average:PT1H\",\n    \"name\" : \"flow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT4H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.GlobalAdjustmentFirstEstimate:first:P1M\",\n    \"name\" : \"gaFirst\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P0M\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:PT1H\",\n    \"name\" : \"hoep\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT5H\",\n    \"duration\" : \"PT2H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPPM0100VKR.F_CV:average:PT1H\",\n    \"name\" : \"kWh1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT4H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPPM0200VKR.F_CV:average:PT1H\",\n    \"name\" : \"kWh2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT4H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"ET.MDPH.MDPSCDA.MDPPM_QPV_MAX15:first:PT1H\",\n    \"name\" : \"maxkVAFifteenRoll\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P0M\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"ET.MDPH.MDPSCDA.MDPPMVKR_MAX15:first:PT1H\",\n    \"name\" : \"maxkWFifteenRoll\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P0M\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MDPPM_MTHLY_BILLED_DMD\",\n    \"name\" : \"billedDemandOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT4H\",\n    \"scale\" : 6\n  }, {\n    \"value\" : \"ET.MDPPM_HRLY_ENERGY_CHARGE\",\n    \"name\" : \"electChargeOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT4H\",\n    \"scale\" : 6\n  }, {\n    \"value\" : \"ET.MDPPM_TOT_CHRGE_M3_EST\",\n    \"name\" : \"flowCharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT4H\",\n    \"scale\" : 6\n  }, {\n    \"value\" : \"ET.MDPPM_TOT_HRLY_CHARGE_EST\",\n    \"name\" : \"totalChargeOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT4H\",\n    \"scale\" : 6\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//SECTION 1:MAXIMUM kVA DETERMINATIONS\\n//Create list for storing hourly maximums of rolling 15 minute average kVA values\\nList MaxkVAList = new ArrayList();\\n//Create list for storing hourly maximum of rolling 15 minute average kVA values during peak hours only\\nList MaxPeakkVAList = new ArrayList();\\n//Create variable to store reference date of calculation\\nLong refDateA = maxkVAFifteenRoll.referenceDate;\\n//Create new date format\\nSimpleDateFormat df = new SimpleDateFormat(\\\"yyyy-MM-dd'T'HH:mm:ss\\\");\\n//Parse reference date into new date format and create new Rdate 3 hours prior to reference date\\nDate Rdate = new Date(df.parse(refDateA).getTime()-(3*60*60*1000));\\n//context.trace(Rdate);\\n//Create calendar for tracking time of kVA values\\nCalendar kVAPeakcal = GregorianCalendar.getInstance();\\n//Iterate through array of hourly maximums of rolling 15 minute average kVA values\\nforeach(element:maxkVAFifteenRoll.array){\\n    //Allow value if timestamped more than 3 hours prior to reference date\\n    if(element.getTime().before(Rdate)){\\n        //Add value to MaxkVAList\\n        MaxkVAList.add(element.value);\\n        //context.trace(MaxkVAList);\\n        //Set the kVAPeakcal calendar to the time of the array element\\n        kVAPeakcal.setTime(element.time);\\n        //context.trace(kVAPeakcal);\\n        //Retrieve the hour of the day from the kVAPeakcal calendar\\n        int hour = kVAPeakcal.get(Calendar.HOUR_OF_DAY);\\n        //Retrieve the day of the week from the kVAPeakcal calendar\\n        int dow = kVAPeakcal.get(Calendar.DAY_OF_WEEK);\\n        //context.trace(\\\"dow=\\\"+dow);\\n        //context.trace(\\\"hour=\\\"+hour);\\n        //Check if the time is between 7 am and 7 pm Monday-Friday\\n        if(hour >= 7 && hour < 19 && dow >=2 && dow <=6){\\n            //If it is between 7 am and 7 pm Monday-Friday, add the value to the \\\"MaxPeakkVAList\\\"\\n            MaxPeakkVAList.add(element.value);\\n            //context.trace(MaxPeakkVAList);\\n        }\\n    }\\n}\\n//Retrieve and store the maximum value from the MaxkVAList\\nBigDecimal maxMaxkVAFifteen = Collections.max(MaxkVAList);\\n//context.trace(\\\"MaxMaxkVAFifteen:\\\" +MaxMaxkVAFifteen);\\n//Retrieve and store the maximum value from the MaxkVAList\\nBigDecimal maxMaxPeakkVAFifteen = Collections.max(MaxPeakkVAList);\\ncontext.trace(\\\"maxMaxPeakkVAFifteen:\\\" +maxMaxPeakkVAFifteen);\\n//SECTION 2: MAXIMUM kW DETERMINATIONS\\n//Create list for storing hourly maximums of rolling 15 minute average kW values\\nList MaxkWList = new ArrayList();\\n//Create list for storing hourly maximum of rolling 15 minute average kW values during peak hours only\\nList MaxPeakkWList = new ArrayList();\\n//Create calendar for tracking time of kW values\\nCalendar kWPeakcal = GregorianCalendar.getInstance();\\n//Iterate through array of hourly maximums of rolling 15 minute average kVA values\\nforeach(element:maxkWFifteenRoll.array){\\n    //Allow value if timestamped more than 3 hours prior to reference date\\n    if(element.getTime().before(Rdate);\\n      ){\\n        //Add value to MaxkVAList\\n        MaxkWList.add(element.value);\\n        //context.trace(MaxkVAList);\\n        //Set the kWPeakcal calendar to the time of the array element\\n        kWPeakcal.setTime(element.time);\\n        //context.trace(kWPeakcal);\\n        //Retrieve the hour of the day from the kWPeakcal calendar\\n        int hour = kWPeakcal.get(Calendar.HOUR_OF_DAY);\\n        //Retrieve the day of the week from the kWPeakcal calendar\\n        int dow = kWPeakcal.get(Calendar.DAY_OF_WEEK);\\n        //context.trace(\\\"dow=\\\"+dow);\\n        //context.trace(\\\"hour=\\\"+hour);\\n        //Check if the time is between 7 am and 7 pm Monday-Friday\\n        if(hour >= 7 && hour < 19 && dow >=2 && dow <=6){\\n            //If it is between 7 am and 7 pm Monday-Friday, add the value to the \\\"MaxPeakkWList\\\"\\n            MaxPeakkWList.add(element.value);\\n            //context.trace(MaxPeakkWList);\\n        }\\n    }\\n}\\n//Retrieve and store the maximum value from the MaxkWList\\nBigDecimal maxMaxkWFifteen = Collections.max(MaxkWList);\\n//context.trace(\\\"MaxkWList size: \\\" +MaxkWList.size);\\n//context.trace(\\\"MaxMaxkWFifteen:\\\" +MaxMaxkWFifteen);\\n//Retrieve and store the maximum value from the MaxkWList\\nBigDecimal maxMaxPeakkWFifteen = Collections.max(MaxPeakkWList);\\ncontext.trace(\\\"maxMaxPeakkWFifteen:\\\" +maxMaxPeakkWFifteen);\\n//SECTION 3: BILLED DEMAND DETERMINATIONS\\n//Initialize variable for overall billed demand\\nBigDecimal billedDemand;\\n//If 90% of maximum kVA is greater than maximum kW\\nif(0.9*maxMaxkVAFifteen>maxMaxkWFifteen){\\n    //Set billed demand to 90% of maximum kVA\\n    billedDemand=0.9*maxMaxkVAFifteen;\\n}\\nelse{\\n    //If not, set billed demand to maximum kW\\n    billedDemand = maxMaxkWFifteen}\\ncontext.trace(\\\"billedDemand:\\\" +billedDemand);\\n//Initialize variable for billed demand (peak hours)\\nBigDecimal billedPeakHrDemand;\\n//If 90% of maximum kVA (peak hours) is greater than maximum kW (peak hours)\\nif(0.9*maxMaxPeakkVAFifteen>maxMaxPeakkWFifteen){\\n    //Set billed demand (peak hours) to 90% of maximum kVA (peak hours)\\n    billedPeakHrDemand=0.9*maxMaxPeakkVAFifteen;\\n}\\nelse{\\n    //If not, set billed demand (peak hours) to maximum kW (peak hours)\\n    billedPeakHrDemand = maxMaxPeakkWFifteen}\\n//context.trace(\\\"BilledPeakHrDemand:\\\" +BilledPeakHrDemand);\\n//Initialize value for the Provincial Network Transmission Fee\\n//SECTION 4: CALCULATION OF CHARGES\\n//Sum energy consumption from Power Monitor 1 and Power Monitor 2\\nBigDecimal electConsumptTotal=kWh1.value + kWh2.value;\\n//context.trace(ElectConsumptHour);\\n//The Hourly Ontario Energy Price (hoep) is always quoted in Standard Time\\n//Create calendar named kWhcal for determining whether daylight saving time is in effect\\nCalendar kWhcal = GregorianCalendar.getInstance();\\n//Set the kWhcal calendar to the timestamp of the input variable kWh1\\nkWhcal.setTime(kWh1.time);\\n//Initialize variable \\\"daylightSave\\\" to store DST_OFFSET property from kWhcal calendar\\nint daylightSave = kWhcal.get(Calendar.DST_OFFSET);\\n//context.trace(kWhcal);\\n//context.trace (daySave);\\n//Calculate \\\"Usage This Bill\\\" by multilpying total electricity consumption by Adjustment Factor\\nBigDecimal adjustedUsage = electConsumptTotal*($(CNDAdjustmentFactor));\\n//Initialize local variable to store the dollar amount of the Electricity charge\\nBigDecimal electCharge;\\n//If daylightSave equals 3600000 (milliseconds), Daylight Saving Time is in effect\\nif(daylightSave==3600000){\\n    //Apply usage adjustment factor to total energy consumption\\n    //Calculate Electricity Charge based on earlier hoep price (adjust hoep to $/kWh)\\n    electCharge= adjustedUsage* hoep.array[0].value/1000;\\n}\\n//If daylightSave equals 0, DST is not in effect\\nelse if(daylightSave==0){\\n    //Apply usage adjustment factor to total energy consumption\\n    //Calculate Electricity Charge based on later hoep price\\n    electCharge= adjustedUsage*hoep.array[1].value/1000;\\n}\\n//context.trace(electConsumptTotal);\\ncontext.trace(\\\"electCharge:\\\" +electCharge);\\n//Create new calendar called \\\"hcal\\\" for determining the number of hours in the month\\nCalendar hcal = GregorianCalendar.getInstance();\\n//Set hcal to the timestamp of gaFirst (i.e. midnight of the first day of the month)\\nhcal.setTime(gaFirst.time);\\n//Create variable Time1 to store time at beginning of the month (in milliseconds since Jan 1., 1970)\\nBigDecimal time1=hcal.time.getTime();\\n//Add one month to hcal\\nhcal.add(Calendar.MONTH,1);\\n//Create variable Time2 to store new time of hcal (in milliseconds since Jan 1., 1970)\\nBigDecimal time2 = hcal.time.getTime();\\n//Obtain number of hours in the month by subtracting Time 1 from Time 2 and converting from milliseconds to hours\\nBigDecimal hoursInMonth = (time2-time1)/(60*60*1000);\\ncontext.trace(\\\"hoursInMonth:\\\" +hoursInMonth);\\n//Multiply peak power demand by Provincial Network Transmission Fee Rate\\nBigDecimal provNetwrkTrans = billedPeakHrDemand*$(CNDProvNtwrkTransRate)/hoursInMonth;\\n//context.trace(\\\"ProvNetwrkTrans:\\\" +ProvNetwrkTrans);\\n//Calculate Global Adjustment charge based on Global Adjustment First Estimate and \\\"Adjusted Usage\\\"\\nBigDecimal globalAdj = (gaFirst.value/1000)*adjustedUsage;\\ncontext.trace(\\\"globalAdj:\\\" +globalAdj);\\n//Intialize variable for Monthly Service Charges\\nBigDecimal monthlyService = ($(CNDMnthlyServiceChrg)+$(CNDAdminFee))/hoursInMonth;\\n//Initialize variable for Rate Rider\\nBigDecimal rateRider;\\nrateRider = ($(CNDRateRider)+$(CNDRateRidersVol))*billedDemand/hoursInMonth;\\ncontext.trace(\\\"rateRider:\\\" +rateRider);\\n//Initialize variable for Distribution kW Charge\\nBigDecimal distribkW;\\ndistribkW = $(CNDDistribkWCharge)*billedDemand/hoursInMonth;\\n//context.trace(\\\"distribkW:\\\" +distribkW);\\n//Initialize variable for Provinical Line & Transformation Connection\\nBigDecimal provLineTransCon;\\nprovLineTransCon = $(CNDProvLineTransConn)*billedDemand/hoursInMonth;\\n//Initialize variable for debt retirement charge\\nBigDecimal debtRetire;\\ndebtRetire = electConsumptTotal*$(CNDDebtRetire);\\n//Initialize variable for Wholesale Market charge\\nBigDecimal wholesaleMarket;\\nwholesaleMarket = adjustedUsage*$(CNDWhlslMrkt);\\n//Initialize variable for transformer allowance\\nBigDecimal transformAllow;\\n//Calculate the transformer allowance from the maximum peak fifteen minute average; the transformer allowance is deducted from the total bill\\ntransformAllow = billedPeakHrDemand*$(CNDTransformAllow)/hoursInMonth;\\n//context.trace(TransformAllow);\\n//Initialize variable for Delivery Charges\\nBigDecimal delivery;\\ndelivery = rateRider+distribkW+provNetwrkTrans+provLineTransCon;\\ncontext.trace(\\\"Delivery:\\\" +delivery);\\n//Initialize variable for Total Charges\\nBigDecimal totalCharges=0;\\n//Add subtotals for total charge and apply HST\\ntotalCharges =monthlyService+(electCharge+globalAdj+delivery+wholesaleMarket+debtRetire+transformAllow)*1.13;\\n//context.trace(\\\"Total Charges is \\\" +totalCharges);\\n//OUTPUTS\\n//Current billed demand\\nbilledDemandOut.value=billedDemand;\\n//Electricity Charge\\nelectChargeOut.value=electCharge;\\n//Estimate total charge(converted to cents/m3)\\nif(25.0<flow.value){\\n    flowCharge.value= (totalCharges*100)/(flow.value*3600/1000);\\n}\\n//Estimated total hourly charge\\ntotalChargeOut.value=totalCharges;\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-09-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : false,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"33bc274e-851b-4b82-9cda-51e5b7775ac0\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"CNDAdjustmentFactor\",\n  \"description\" : \"Cambridge North Dumfries Hydro Adjustment Factor Applied To Actual Consumption\",\n  \"units\" : \"\",\n  \"defaultValue\" : 1.0355,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"CNDAdminFee\",\n  \"description\" : \"Cambridge North Dumfries Admin Fee - Standard Supply Service\",\n  \"units\" : \"$/month\",\n  \"defaultValue\" : 0.25,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"CNDDebtRetire\",\n  \"description\" : \"Cambridge North Dumfries Debt Retirement Charge\",\n  \"units\" : \"$/kWh\",\n  \"defaultValue\" : 0.0070,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 3.5368,\n    \"start\" : \"2015-11-01T00:00:00.000\",\n    \"end\" : \"2020-11-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"CNDDistribkWCharge\",\n  \"description\" : \"Cambridge North Dumfries Distribution kW Charge\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : 3.4920,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 1004.00,\n    \"start\" : \"2015-11-01T00:00:00.000\",\n    \"end\" : \"2020-11-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"CNDMnthlyServiceChrg\",\n  \"description\" : \"Cambridge North Dumfries Hydro Monthly Service Charge\",\n  \"units\" : \"$\",\n  \"defaultValue\" : 991.12,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 1.8148,\n    \"start\" : \"2015-11-01T00:00:00.000\",\n    \"end\" : \"2020-11-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"CNDProvLineTransConn\",\n  \"description\" : \"Cambridge North Dumfries Hydro Provincial Line and Transformation Connection Rate\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : 1.8788,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 1.4728,\n    \"start\" : \"2015-11-01T00:00:00.000\",\n    \"end\" : \"2020-11-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"CNDRateRider\",\n  \"description\" : \"Cambridge North Dumfries Hydro Rate Riders Rate\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : -2.0161,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 0.0577,\n    \"start\" : \"2015-11-01T00:00:00.000\",\n    \"end\" : \"2020-11-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"CNDRateRidersVol\",\n  \"description\" : \"Cambridge North Dumfries Hydro Rate Riders Volumetric Rate\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : -2.4124,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"CNDTransformAllow\",\n  \"description\" : \"Cambridge North Dumfries Hydro Transformer Allowance Rate\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : -0.60,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"CNDWhlslMrkt\",\n  \"description\" : \"Cambridge North Dumfries Wholesale Market\",\n  \"units\" : \"$/kWh\",\n  \"defaultValue\" : 0.0057,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 2.800,\n    \"start\" : \"2015-11-01T00:00:00.000\",\n    \"end\" : \"2020-11-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"CNDProvNtwrkTransRate\",\n  \"description\" : \"Cambridge North Dumfries Provincial Network Transmission Rate\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : 2.8711,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPPM_MTHLY_BILLED_DMD\",\"name\":\"billedDemandOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT4H\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPPM_HRLY_ENERGY_CHARGE\",\"name\":\"electChargeOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT4H\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPPM_TOT_CHRGE_M3_EST\",\"name\":\"flowCharge\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT4H\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPPM_TOT_HRLY_CHARGE_EST\",\"name\":\"totalChargeOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT4H\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Middleton Power Hourly 15 Minute Rolling Averages Maximums\",\n  \"description\" : \"Calculates hourly maximum 15 minute rolling averages based on five minute maximums\",\n  \"schedule\" : \"30 * * * *\",\n  \"lastRunMessage\" : \"0cc1197e-ec05-49c6-a7e8-a4ee2a5600d2\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MDPH.MDPSCDA.MDPPM0100VPV.F_CV:maximum:PT5M\",\n    \"name\" : \"kVA1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT95M\",\n    \"duration\" : \"PT70M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPPM0200VPV.F_CV:maximum:PT5M\",\n    \"name\" : \"kVA2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT95M\",\n    \"duration\" : \"PT70M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPPM0100VKR.F_CV:maximum:PT5M\",\n    \"name\" : \"kW1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT95M\",\n    \"duration\" : \"PT70M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPPM0200VKR.F_CV:maximum:PT5M\",\n    \"name\" : \"kW2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT95M\",\n    \"duration\" : \"PT70M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MDPH.MDPSCDA.MDPPM_QPV_MAX15\",\n    \"name\" : \"MaxkVAFifteenRoll\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT90M\",\n    \"scale\" : 6\n  }, {\n    \"value\" : \"ET.MDPH.MDPSCDA.MDPPMVKR_MAX15\",\n    \"name\" : \"MaxkWFifteenRoll\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT90M\",\n    \"scale\" : 6\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//**CALCULATION 1: Calculating hourly maximum 15 minute rolling averages **\\n//Initialize list for sum of five minute power maximums\\nList FiveMintPwrMax= new ArrayList();\\n//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(kW1,kW2,30);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs) {\\n    //Add the sum of the input pair to the list \\\"FiveMintPwrMax\\\"\\n    FiveMintPwrMax.add(pair.a.value + pair.b.value);\\n    //context.trace(FiveMintPwrMax);\\n}\\n//Initialize variable for rolling 15 minute average\\nBigDecimal FifteenAvg = 0;\\n//Initialize variable for maximum of the rolling 15 minute averages\\nBigDecimal MaxFifteen=0;\\n//Iterate through array of 5 minute maximum power readings\\nfor(int i=1;\\n    i<FiveMintPwrMax.size()-1;\\n    i++){\\n    //Calculate the average of each block of 3 five minute maximums to get a 15 minute rolling average\\n    FifteenAvg = (FiveMintPwrMax.get(i-1)+FiveMintPwrMax.get(i)+FiveMintPwrMax.get(i+1))/3;\\n    //Store maximum fifteen minute rolling average\\n    if(FifteenAvg > MaxFifteen){\\n        MaxFifteen = FifteenAvg;\\n    }\\n}\\nMaxkWFifteenRoll.value=MaxFifteen;\\n//context.trace(\\\"MaxFifteen is \\\" + MaxkWFifteenRoll.value);\\n//Initialize list for sum of five minute apparent power maximums\\nList FiveMintkVAMax= new ArrayList();\\n//Tag pair of primary and secondary tag\\nTagInputPair tipb = new TagInputPair(kVA1,kVA2,30);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tipb.pairs) {\\n    //Add the sum of the input pair to the list \\\"FiveMintPwrMax\\\"\\n    FiveMintkVAMax.add(pair.a.value + pair.b.value);\\n    //context.trace(FiveMintlVAMax);\\n}\\n//context.trace(\\\"FiveMintkVAMax is\\\" + FiveMintkVAMax );\\n//Initialize variable for rolling 15 minute kVA average\\nBigDecimal FifteenkVAAvg = 0;\\n//Initialize variable for maximum of the rolling 15 minute kVA averages\\nBigDecimal MaxkVAFifteen=0;\\nfor(int i=1;\\n    i<FiveMintkVAMax.size()-1;\\n    i++){\\n    //Calculate the average of each block of 3 five minute kVA maximums to get a 15 minute rolling average \\n    FifteenkVAAvg = (FiveMintkVAMax.get(i-1)+FiveMintkVAMax.get(i)+FiveMintkVAMax.get(i+1))/3;\\n    //Store maximum fifteen minute rolling average\\n    if(FifteenkVAAvg > MaxkVAFifteen){\\n        MaxkVAFifteen = FifteenkVAAvg;\\n    }\\n}\\nMaxkVAFifteenRoll.value=MaxkVAFifteen;\\n//context.trace(\\\"MaxkVAFifteen is \\\" + MaxkVAFifteenRoll.value);\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-07-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",kW1,kW2,kVA1,kVA2,__results__\",\n    \"outputs\" : \",MaxkVAFifteenRoll,MaxkWFifteenRoll\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"0cc1197e-ec05-49c6-a7e8-a4ee2a5600d2\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MDPH.MDPSCDA.MDPPM_QPV_MAX15\",\"name\":\"MaxkVAFifteenRoll\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT90M\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPH.MDPSCDA.MDPPMVKR_MAX15\",\"name\":\"MaxkWFifteenRoll\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT90M\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Min Colour Highlight\",\n  \"description\" : \"Highlights the minimum value in a results set\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"89cc2614-58a5-49fc-8a6a-cc53aee5da2e\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"ET.VTS.CBWG004AIQ01.MMIN:raw:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P6M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"int i=0;\\nint minIndex = 0;\\nBigDecimal min = 999;\\nforeach(element:__source__.array){\\n    if(element.value<min){\\n        min=element.value;\\n        minIndex=i;\\n    }\\n    i++;\\n}\\n__source__.array[minIndex].setColour(\\\"orange\\\");\\n__source__.array[minIndex].addFlag(\\\"MIN\\\");\\n\",\n    \"version\" : 1,\n    \"start\" : \"2005-11-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"89cc2614-58a5-49fc-8a6a-cc53aee5da2e\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2005-11-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Min Max Average\",\n  \"description\" : \"Adds flag STC if minimum, maximum and average are within 0.0001 of each other.\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"1a6483f1-d982-4ac9-a09d-1c42f85ca298\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MTPH.MTPSCDA.KIWK024UVQDS.F_CV:rawByTime:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.KIWK024UVQDS.F_CV:average:P1D\",\n    \"name\" : \"average\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.KIWK024UVQDS.F_CV:maximum:P1D\",\n    \"name\" : \"maximum\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.KIWK024UVQDS.F_CV:minimum:P1D\",\n    \"name\" : \"minimum\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"if((average.value-maximum.value<0.0001 && maximum.value-average.value<0.0001) && (average.value-minimum.value<0.0001 && minimum-average<0.0001)){\\n    __source__.addFlag(\\\"STC\\\");\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"//Check whether the minimum, maximum and average are within 0.0001 of each other\\nif((average.value-maximum.value<0.0001 && maximum.value-average.value<0.0001) && (average.value-minimum.value<0.0001 && minimum.value-average.value<0.0001)){\\n    //If true, add an STC flag to the first value in the array\\n    __source__.addFlag(\\\"STC\\\");\\n}\\n\",\n    \"version\" : 2,\n    \"start\" : \"2015-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"//Check whether the minimum, maximum and average are within 0.0001 of each other\\r\\nif((average.value - maximum.value < 0.0001 && maximum.value - average.value < 0.0001) &&\\r\\n   (average.value - minimum.value < 0.0001 && minimum.value - average.value < 0.0001)){\\r\\n    //Don't flag if source value already contains SNF or WST flag\\r\\n    if(null != __source__){\\r\\n        context.trace(__source__.flags.contains(\\\"Hello\\\"));\\r\\n    if(!__source__.flags.contains(\\\"SNF\\\") && !__source__.flags.contains(\\\"WST\\\")){\\r\\n        //Add an STC flag to the first value in the array\\r\\n        __source__.addFlag(\\\"STC\\\");\\r\\n    }\\r\\n    }\\r\\n}\\r\\n\",\n    \"version\" : 3,\n    \"start\" : \"2015-10-02T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"1a6483f1-d982-4ac9-a09d-1c42f85ca298\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2009-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"dependant\":[],\"id\":\"da4332ba-d878-4ee9-905c-2555c6a738a1\",\"source\":\"Min Max Average\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Min/Max and Relative Difference Flagging\",\n  \"description\" : \"Flags primary input for min and max. Compares primary to secondary tag and applies flag if relative diff. is greater than specified %.\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"412fd560-fdca-4a25-9fc9-162bd1ae4feb\",\n  \"constant\" : [ \"HeidelbergMaxFlow\", \"HeidelbergMinFlow\", \"TenPercent\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"SJPH.SJPSCDA.HEPTWL1TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"@.HEPWELLTT.F_CV:first:P1D\",\n    \"name\" : \"second\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Primary loop for source tag\\nfor (Data PD: __source__.array){\\n    //Check if above maximum\\n    if(PD.value > $(HeidelbergMaxFlow)) {\\n        PD.addFlag(\\\"MAX\\\");\\n    }\\n    //Check if below minimum\\n    if (PD.value < $(HeidelbergMinFlow)) {\\n        PD.addFlag(\\\"MIN\\\");\\n    }\\n}\\n//Initialize variables to hold relative difference calculations\\nBigDecimal relDiff = 0;\\nBigDecimal relDiff2 = 0;\\n//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(__source__, second, 60);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs){\\n    //Calculate difference relative to first value\\n    if(pair.a.value!=0){\\n        relDiff = ((pair.a.value-pair.b.value)/pair.a.value);\\n    }\\n    if(pair.b.value!=0){\\n        //Calculate difference relative to second value\\n        relDiff2 = ((pair.a.value-pair.b.value)/pair.b.value);\\n    }\\n    //Flag value if relative difference is greater than 10%\\n    if(relDiff > 0.10||relDiff < -0.10||relDiff2 > 0.10||relDiff2 < -0.10)\\n        pair.a.addFlag(\\\"OUT\\\");\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2005-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"//Iterate through each element of the input array\\nfor (Data PD: __source__.array){\\n    //If the value of the element is above threshold\\n    BigDecimal heidelbergMaxFlow = HeidelbergMaxFlow.getValue(PD);\\n    context.trace(HeidelbergMaxFlow.getValue(PD));\\n    if(PD.value > heidelbergMaxFlow) {\\n        //Apply \\\"MAX\\\" flag to data element\\n        PD.addFlag(\\\"MAX\\\");\\n    }\\n    //If the value of the element is below threshold\\n    BigDecimal heidelbergMinFlow = HeidelbergMinFlow.getValue(PD);\\n    if (PD.value < heidelbergMinFlow) {\\n        //Apply \\\"MIN\\\" flag to data element\\n        PD.addFlag(\\\"MIN\\\");\\n    }\\n}\\n//Initialize variables to hold relative difference calculations\\nBigDecimal relDiff = 0;\\n//BigDecimal relDiff2 = 0;\\n//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(__source__, second, 60);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs){\\n    //Calculate difference relative to first value\\n    if(pair.a.value!=0){\\n        relDiff = ((pair.a.value-pair.b.value)/pair.a.value);\\n        context.trace(relDiff);\\n        BigDecimal tenPercent = TenPercent.getValue(pair);\\n        if(Math.abs(relDiff) > tenPercent){\\n            pair.a.addFlag(\\\"OUT\\\");\\n        }\\n    }\\n}\\n\",\n    \"version\" : 2,\n    \"start\" : \"2015-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : false\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"412fd560-fdca-4a25-9fc9-162bd1ae4feb\",\n  \"owner\" : \"ralbasel@regionofwaterloo.ca\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2005-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"HeidelbergMaxFlow\",\n  \"description\" : \"Heidelberg Maximum Flow\",\n  \"units\" : \"M^3\",\n  \"defaultValue\" : 1374,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"HeidelbergMinFlow\",\n  \"description\" : \"Heidelberg Minimum Flow\",\n  \"units\" : \"M^3\",\n  \"defaultValue\" : 0,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"TenPercent\",\n  \"description\" : \"Percentage for relative difference flagging\",\n  \"units\" : \"\",\n  \"defaultValue\" : 0.10,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"No Flow Flagging\",\n  \"description\" : \"Adds flag to values during no flow condition\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"7fd70cc4-87b3-4a3f-9d18-6320683244a4\",\n  \"constant\" : [ \"NoFlowThreshold\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR3.W07W0008RF01QVA.F_CV:rawByTime:PT2M\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.W07W0008RF01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.W07W0008FI01QVA.F_CV:rawByTime:PT2M\",\n    \"name\" : \"second\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.W07W0008FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\r\\nTagInputPair tip = new TagInputPair(__source__, second, \\\"PT2M\\\");\\r\\n//Loop to run through all of the tag data\\r\\nfor (DataPair pair: tip.pairs) {\\r\\n    //If value of secondary tag is less than 1 \\r\\n    if(null == pair.b || ($(NoFlowThreshold) >= pair.b.value)){\\r\\n        //Add \\\"Status No Flow\\\" flag to primary tag\\r\\n        pair.a.addFlag(\\\"SNF\\\");\\r\\n        //check quality\\r\\n    \\tif(null != pair.b && pair.b.quality != 100){\\r\\n      \\t\\t//second.addFlag(\\\"DataGap\\\");\\r\\n            pair.a.addFlag(\\\"DataGap\\\");\\r\\n      \\t}\\r\\n    }\\r\\n}\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2014-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"7fd70cc4-87b3-4a3f-9d18-6320683244a4\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2014-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"NoFlowThreshold\",\n  \"description\" : \"Threshold for defining no flow condition\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 1.00,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"88929aae-9293-4046-9d47-3cc025e424f5\",\"source\":\"No Flow Flagging\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"P10A and P19 Runtimes\",\n  \"description\" : \"Checking when the runtimes are over 4 hours for either well\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"2a5f6885-aea3-425e-b4a7-8723ba81da3d\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.P10W010A0000QRN.F_CV:periodTotal:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.P10W010A0000QRN.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.PTPW00190000QRN.F_CV:periodTotal:P1D\",\n    \"name\" : \"P19\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.PTPW00190000QRN.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//define runtime threshold value\\r\\nBigDecimal runtime = 4.0;\\r\\n\\r\\n//pair the input tags together\\r\\nTagInputPair tip = new TagInputPair(__source__, P19, \\\"P1D\\\");\\r\\n\\r\\n//loop qulity check\\r\\nfor(DataPair pair : tip.pairs){\\r\\n    if (pair.good ){\\r\\n        if(4 < __source__.value){\\r\\n            pair.a.addFlag (\\\"P10A\\\");\\r\\n        }\\r\\n        if(4 < P19.value){\\r\\n            pair.a.addFlag (\\\"P19\\\");\\r\\n        }\\r\\n        else runtime = null;\\r\\n    }\\r\\n}\\r\\n\\r\\n\\r\\n\\r\\n//Variable to store the start of the low flow\\r\\n//Data firstLowFlow = null;\\r\\n//for (Data inTag: __source__.array){\\r\\n    // check if value is below 5 L/s\\r\\n//    if(5 > inTag.value && null == firstLowFlow) {\\r\\n      //record the first low flow\\r\\n//      firstLowFlow = inTag;\\r\\n//    }else if(5 > inTag.value && null != firstLowFlow && \\r\\n//      (inTag.timeInSeconds - firstLowFlow.timeInSeconds) >= 604800){\\r\\n        //when the flow is below 5 for 1 week then add a flag\\r\\n//           inTag.addFlag(\\\"VIC\\\");\\r\\n//    }else if(5 <= inTag.value){\\r\\n      //reset if flow goes above 5\\r\\n//      firstLowFlow = null;\\r\\n//    }\\r\\n//}\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2024-03-21T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"2a5f6885-aea3-425e-b4a7-8723ba81da3d\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"1970-01-01T00:00:01.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"dependant\":[],\"id\":\"7286ecb6-52e6-4d21-803f-ab4dd8c114f5\",\"source\":\"P10A and P19 Runtimes\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Pinebush combined P10 P11 P17\",\n  \"description\" : \"Pinebush combined P10 P11 P17\",\n  \"schedule\" : \"0 4 * * *\",\n  \"lastRunMessage\" : \"61139fc9-e6f1-45b8-847d-7d9192c3ac27\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.P10W0010FI01QFL.F_CV:periodTotal:P1D\",\n    \"name\" : \"P10\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.P10W0010FI01QFL.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.P11W0011FI01QFL.F_CV:periodTotal:P1D\",\n    \"name\" : \"P11\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.P11W0011FI01QFL.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.P11W0017FI01QFL.F_CV:periodTotal:P1D\",\n    \"name\" : \"P17\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.P11W0017FI01QFL.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.CBWPCOMBINEDTT\",\n    \"name\" : \"PCombined\",\n    \"type\" : \"tag\",\n    \"description\" : \"TOTALIZED FLOW COMBINED (P10 P11 P17)\",\n    \"units\" : \"M^3\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 2\n  } ],\n  \"code\" : [ {\n    \"value\" : \"BigDecimal sum = 0;\\r\\nTagInputTriplet triplet1 = new TagInputTriplet(P10, P11, P17, \\\"PT1M\\\");\\r\\nfor(DataTriplet trip : triplet1.triplets){\\r\\n    if(trip.aValue != null){\\r\\n        sum = trip.aValue;\\r\\n    }\\r\\n    if(trip.bValue != null){\\r\\n        sum += trip.bValue;\\r\\n    }\\r\\n    if(trip.cValue != null){\\r\\n        sum += trip.cValue;\\r\\n    }\\r\\n    PCombined.add(new Data(trip.aTime,(sum, 100)));\\r\\n}\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",P11,P17,__results__,P10\",\n    \"outputs\" : \",PCombined\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"61139fc9-e6f1-45b8-847d-7d9192c3ac27\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.CBWPCOMBINEDTT\",\"name\":\"PCombined\",\"type\":\"tag\",\"description\":\"TOTALIZED FLOW COMBINED (P10 P11 P17)\",\"units\":\"M^3\",\"saveOffset\":\"P1D\",\"scale\":2}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"PlantDischargeFlowTotal\",\n  \"description\" : \"PlantDischargeFlowTotal\",\n  \"schedule\" : \"0 2 * * *\",\n  \"lastRunMessage\" : \"c9eeeb20-cdcf-491b-942f-ffe899f22d0b\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"SJPH.SJPSCDA.HEPTWL1TT.F_CV:interpolated:PT1M\",\n    \"name\" : \"InpVariable\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.HEPTWL1TT_TOTAL\",\n    \"name\" : \"OutVariable\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Count of the Array index\\nBigDecimal Count = 0;\\n//Value before the reset of the counter\\nBigDecimal ValueBeforeReset = 0;\\n//Hold Valid tag value\\nBigDecimal ValidValue = null;\\n//Reset Occured\\nBoolean RST = 0;\\n//Loop through the values.\\nfor (ID:InpVariable.array){\\n    //Make sure that there is a number for InpVariable\\n    if(ID.value != null){\\n        //The counter does not equal 0\\n        if (Count > 0){\\n            if(ID.value < InpVariable.getValue(Count-1) ){\\n                ValueBeforeReset = InpVariable.getValue(Count-1);\\n                RST = 1;\\n            }\\n            else if(ID.value > InpVariable.getValue(Count-1)  ){\\n                ValidValue = ID.value;\\n            }\\n        }\\n        else if (Count == 0 ){\\n            ValidValue = ID.value;\\n        }\\n    }\\n    //Array Index Counter\\n    Count =+ 1;\\n}\\nif (RST ==1){\\n    ValidValue = ValueBeforeReset + ID.Value;\\n}\\n//Outputs Tags\\nOutVariable.value = ValidValue;\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"c9eeeb20-cdcf-491b-942f-ffe899f22d0b\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2014-03-20T02:00:00.000\",\n  \"enabled\" : false,\n  \"type\" : \"DIRECT\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.HEPTWL1TT_TOTAL\",\"name\":\"OutVariable\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Quality check against second tag flags\",\n  \"description\" : \"Adds QLTY flag to source tag if second tag contains any flags\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"62aa490a-5909-439f-9078-be54bc2908e9\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"KWCRH.KWCR_KIWK051TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"@.KWCRH.KWCR_KIWK051TT.F_CV_PREP:average:P1D\",\n    \"name\" : \"second\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(__source__, second,60);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs) {\\n    //Summing the two tags together\\n    if(pair.b.limit!=\\\"\\\"){\\n        pair.a.addFlag(\\\"QLTY\\\")\\n    }\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"62aa490a-5909-439f-9078-be54bc2908e9\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2015-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Quality check against second tag quality\",\n  \"description\" : \"Adds QLTY flag if second tag has quality less than 100\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"70fd967d-1217-4bcd-a27a-577b4f211e99\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"SJPH.SJPSCDA.HEPTWL1TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"SJPH.SJPSCDA.HEPTWL1TT.F_CV:lab:P1D\",\n    \"name\" : \"second\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(__source__, second,60);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs) {\\n    //Summing the two tags together\\n    if(pair.b.quality<100){\\n        pair.a.addFlag(\\\"QLTY\\\")\\n    }\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"70fd967d-1217-4bcd-a27a-577b4f211e99\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2015-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Subtract Two Tags\",\n  \"description\" : \"Calc to subtract two tags\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"2b03a358-1f04-4b3a-a154-f5011fab8af2\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.MDPWELLFXQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.MDPWELLFXQ01.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G15W0015FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"second\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G15W0015FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\r\\nTagInputPair tip = new TagInputPair(__source__, second, 60);\\r\\n//Loop to run through all of the tag data\\r\\nfor (DataPair pair: tip.pairs) {\\r\\n    //Subtracting the two tags apart\\r\\n    pair.a.value = pair.a.value - pair.b.value;\\r\\n}\",\n    \"version\" : 1,\n    \"start\" : \"2010-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"2b03a358-1f04-4b3a-a154-f5011fab8af2\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2022-06-28T09:29:49.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Sum Five Tags\",\n  \"description\" : \"\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"79a5b57b-1b89-4ece-ad80-b231e657fa28\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.G01W0001FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G01W0001FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G14W0014FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"fifth\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G14W0014FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G03W0003FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"fourth\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G03W0003FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G02W0002FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"second\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G02W0002FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G01W001AFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"third\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G01W001AFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\r\\nTagInputPair tip = new TagInputPair(__source__, second, 60);\\r\\n//Loop to run through all of the tag data\\r\\nfor (DataPair pair: tip.pairs){\\r\\n    //Summing the two tags together\\r\\n    pair.a.Value = pair.a.Value + pair.b.Value;\\r\\n}\\r\\n//Repeat same procedure using third input tag\\r\\nTagInputPair tipb = new TagInputPair(__source__, third, 60);\\r\\nfor (DataPair pairb: tipb.pairs){\\r\\n    pairb.a.Value = pairb.a.Value + pairb.b.Value;\\r\\n}\\r\\n//Repeat same procedure using fourth input tag\\r\\nTagInputPair tipb = new TagInputPair(__source__, fourth, 60);\\r\\nfor (DataPair pairb: tipb.pairs){\\r\\n    pairb.a.Value = pairb.a.Value + pairb.b.Value;\\r\\n}\\r\\n//Repeat same procedure using fifth input tag\\r\\nTagInputPair tipb = new TagInputPair(__source__, fifth, 60);\\r\\nfor (DataPair pairb: tipb.pairs){\\r\\n    pairb.a.Value = pairb.a.Value + pairb.b.Value;\\r\\n}\",\n    \"version\" : 1,\n    \"start\" : \"2010-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"79a5b57b-1b89-4ece-ad80-b231e657fa28\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2022-06-28T14:34:59.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Sum Four Tags\",\n  \"description\" : \"\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"9e4b8f80-2a3b-42b1-8749-9cd0c298984b\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MDPH.MDPSCDA.MDPG001TTV01.F_CV:periodTotal:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPG014TTV01.F_CV:periodTotal:P1D\",\n    \"name\" : \"fourth\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPG002TTV01.F_CV:periodTotal:P1D\",\n    \"name\" : \"second\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.MDPG003TTV01.F_CV:periodTotal:P1D\",\n    \"name\" : \"third\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(__source__, second, 60);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs){\\n    //Summing the two tags together\\n    pair.a.Value = pair.a.Value + pair.b.Value;\\n}\\n//Repeat same procedure using third input tag\\nTagInputPair tipb = new TagInputPair(__source__, third, 60);\\nfor (DataPair pairb: tipb.pairs){\\n    pairb.a.Value = pairb.a.Value + pairb.b.Value;\\n}\\n//Repeat same procedure using fourth input tag\\nTagInputPair tipb = new TagInputPair(__source__, fourth, 60);\\nfor (DataPair pairb: tipb.pairs){\\n    pairb.a.Value = pairb.a.Value + pairb.b.Value;\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2005-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"9e4b8f80-2a3b-42b1-8749-9cd0c298984b\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2005-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Sum Six Tags\",\n  \"description\" : \"\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"e83dc917-740b-40ff-8315-4eea9167dfdc\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.G01W0001FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G01W0001FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G14W0014FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"fifth\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G14W0014FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G03W0003FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"fourth\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G03W0003FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G01W001AFI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"second\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G01W001AFI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G14W0014FI02QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"sixth\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G14W0014FI02QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.G02W0002FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"third\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.G02W0002FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\r\\nTagInputPair tip = new TagInputPair(__source__, second, 60);\\r\\n//Loop to run through all of the tag data\\r\\nfor (DataPair pair: tip.pairs){\\r\\n    //Summing the two tags together\\r\\n    pair.a.Value = pair.a.Value + pair.b.Value;\\r\\n}\\r\\n//Repeat same procedure using third input tag\\r\\nTagInputPair tipb = new TagInputPair(__source__, third, 60);\\r\\nfor (DataPair pairb: tipb.pairs){\\r\\n    pairb.a.Value = pairb.a.Value + pairb.b.Value;\\r\\n}\\r\\n//Repeat same procedure using fourth input tag\\r\\nTagInputPair tipb = new TagInputPair(__source__, fourth, 60);\\r\\nfor (DataPair pairb: tipb.pairs){\\r\\n    pairb.a.Value = pairb.a.Value + pairb.b.Value;\\r\\n}\\r\\n//Repeat same procedure using fifth input tag\\r\\nTagInputPair tipb = new TagInputPair(__source__, fifth, 60);\\r\\nfor (DataPair pairb: tipb.pairs){\\r\\n    pairb.a.Value = pairb.a.Value + pairb.b.Value;\\r\\n}\\r\\n//Repeat same procedure using sixth input tag\\r\\nTagInputPair tipb = new TagInputPair(__source__, sixth, 60);\\r\\nfor (DataPair pairb: tipb.pairs){\\r\\n    pairb.a.Value = pairb.a.Value + pairb.b.Value;\\r\\n}\",\n    \"version\" : 1,\n    \"start\" : \"2010-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"e83dc917-740b-40ff-8315-4eea9167dfdc\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2022-06-28T14:46:51.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Sum Three Tags\",\n  \"description\" : \"\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"98034081-9e5c-4fa4-a37c-24b7f64bb4a6\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"SJPH.SJPSCDA.WHPWY01TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"SJPH.SJPSCDA.WHPWY05TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"second\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"SJPH.SJPSCDA.WHPWY06TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"third\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(__source__, second, 60);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs){\\n    //Summing the two tags together\\n    pair.a.Value = pair.a.Value + pair.b.Value;\\n}\\n//Repeat same procedure using third input tag\\nTagInputPair tipb = new TagInputPair(__source__, third, 60);\\nfor (DataPair pairb: tipb.pairs){\\n    pairb.a.Value = pairb.a.Value + pairb.b.Value;\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"98034081-9e5c-4fa4-a37c-24b7f64bb4a6\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2009-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Sum Two Tags\",\n  \"description\" : \"\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"2db4fc9b-65cf-4e91-841a-a245ed9bc1a4\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"SJPH.SJPSCDA.CPSC003TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"SJPH.SJPSCDA.CPSC004TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"second\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary and secondary tag\\nTagInputPair tip = new TagInputPair(__source__, second, 60);\\n//Loop to run through all of the tag data\\nfor (DataPair pair: tip.pairs) {\\n    //Summing the two tags together\\n    pair.a.value = pair.a.value + pair.b.value;\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"2db4fc9b-65cf-4e91-841a-a245ed9bc1a4\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2009-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Tag Check Against Flow and Calibration\",\n  \"description\" : \"\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"14e1ae39-86dc-4db9-8137-af92798edab8\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"SJPH.HEPOIT1.HEPCFR2AIQ01:interpolated:PT2M\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"SJPH.SJPSCDA.HEPCFR1AIDCP.F_CV:interpolated:PT2M\",\n    \"name\" : \"calibration\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"SJPH.HEPOIT1.HEPTWL1FIQ01:interpolated:PT2M\",\n    \"name\" : \"flow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Tag pair of primary tag and flow tag\\nTagInputPair tip1 = new TagInputPair (__source__, flow, 59);\\n//Loop to run thorugh all of the flow tag data\\nfor (DataPair pair1: tip1.pairs){\\n    //If no flow give bad quality to primary tag\\n    if (0 >= pair1.b.value){\\n        pair1.a.quality = 0;\\n        //Flag with No Flow\\n        //pair1.a.addFlag(\\\"NOFL\\\");\\n    }\\n}\\n//Tag pair of primary tag and calibration tag\\nTagInputPair tip2 = new TagInputPair (__source__, calibration, 59);\\n//Loop to run through all of the calibration tag data\\nfor (DataPair pair2: tip2.pairs){\\n    //If calibration mode is on give bad quality to primary tag\\n    if (1 == pair2.b.value){\\n        pair2.a.quality = 0;\\n        //Flag with Calibration Mode On\\n        pair2.a.addFlag(\\\"CAL\\\");\\n    }\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2010-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"14e1ae39-86dc-4db9-8137-af92798edab8\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2014-08-18T19:31:37.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Turnbull Combined Flow (G16 G17 G18)\",\n  \"description\" : \"Turnbull Combined Flow (G16 G17 G18)\",\n  \"schedule\" : \"0 4 * * *\",\n  \"lastRunMessage\" : \"52ab6d40-0d27-4e10-a996-0823600584a4\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MDPH.MDPSCDA.CBWG016TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"input1\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.CBWG017TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"input2\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.CBWG018TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"input3\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.CBWGCOMBINEDTT\",\n    \"name\" : \"output1\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"BigDecimal sum = 0;\\nif(input1.value != null){\\n    sum = input1.value;\\n}\\nif(input2.value != null){\\n    sum += input2.value;\\n}\\nif(input3.value != null){\\n    sum += input3.value:\\n}\\nif(sum != null){\\n    output1.value = sum;\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-05-19T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",input3,input2,input1,__results__\",\n    \"outputs\" : \",output1\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"52ab6d40-0d27-4e10-a996-0823600584a4\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.CBWGCOMBINEDTT\",\"name\":\"output1\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Turnbull Energy per Volume\",\n  \"description\" : \"Outputs kWh/m3 of water produced\",\n  \"schedule\" : \"45 * * * *\",\n  \"lastRunMessage\" : \"baf38999-0544-46b9-bd6c-35ba43fd5a36\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"KWCRH.KWCR_TUPCB00FIQ01.F_CV:average:PT1H\",\n    \"name\" : \"avgInstFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.TUPPM0100VKR.F_CV:average:PT1H\",\n    \"name\" : \"avgPower\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT1H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.TUPP_KWH_M3\",\n    \"name\" : \"NRGVOL\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT30M\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Prevent division by zero\\r\\nif(1.0<avgInstFlow.value){\\r\\n    //Divide power by flow to get kW/(L/s) = kJ/L\\r\\n    //Multiply result by 1000 to convert to m3\\r\\n    //Divide result by 3600 to get kWh (1 kWh = 3600 kJ)\\r\\n    NRGVOL.value=(avgPower.value/avgInstFlow.value)*1000/3600;\\r\\n}\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-05-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",avgPower,avgInstFlow,__results__\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"baf38999-0544-46b9-bd6c-35ba43fd5a36\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.TUPP_KWH_M3\",\"name\":\"NRGVOL\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT30M\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"4e7cdacc-8838-4f0a-b47c-21339a9ab87e\",\"source\":\"Turnbull Energy per Volume\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Turnbull Hydro Hourly Billing Estimate\",\n  \"description\" : \"\",\n  \"schedule\" : \"35 * * * *\",\n  \"lastRunMessage\" : \"33bc274e-851b-4b82-9cda-51e5b7775ac1\",\n  \"constant\" : [ \"CNDAdjustmentFactor\", \"CNDAdminFee\", \"CNDDebtRetire\", \"CNDDistribkWCharge\", \"CNDMnthlyServiceChrg\", \"CNDProvLineTransConn\", \"CNDRateRider\", \"CNDRateRidersVol\", \"CNDTransformAllow\", \"CNDWhlslMrkt\", \"CNDProvNtwrkTransRate\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MDPH.MDPSCDA.TUPCB00FIQ01.F_CV:average:PT1H\",\n    \"name\" : \"flow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT4H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.GlobalAdjustmentFirstEstimate:first:P1M\",\n    \"name\" : \"gaFirst\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P0M\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"IESO.IESO.HOEP:first:PT1H\",\n    \"name\" : \"hoep\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT5H\",\n    \"duration\" : \"PT2H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.TUPPM0100VKR.F_CV:average:PT1H\",\n    \"name\" : \"kWh\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT4H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"ET.MDPH.MDPSCDA.TUPPM0100VPV_MAX15:first:PT1H\",\n    \"name\" : \"maxkVAFifteenRoll\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P0M\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"ET.MDPH.MDPSCDA.TUPPM0100VKR_MAX15:first:PT1H\",\n    \"name\" : \"maxkWFifteenRoll\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P0M\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.TUPPM0100QMP.F_CV:average:PT1H\",\n    \"name\" : \"pf\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT4H\",\n    \"duration\" : \"PT1H\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.TUPPM_MTHLY_BILLED_DMD\",\n    \"name\" : \"billedDemandOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT4H\",\n    \"scale\" : 6\n  }, {\n    \"value\" : \"ET.TUPPM_HRLY_ENERGY_CHARGE\",\n    \"name\" : \"electChargeOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT4H\",\n    \"scale\" : 6\n  }, {\n    \"value\" : \"ET.TUPPM_TOT_CHRGE_M3_EST\",\n    \"name\" : \"flowCharge\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT4H\",\n    \"scale\" : 6\n  }, {\n    \"value\" : \"ET.TUPPM_TOT_HRLY_CHARGE_EST\",\n    \"name\" : \"totalChargeOut\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT4H\",\n    \"scale\" : 6\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//SECTION 1:MAXIMUM kVA DETERMINATIONS\\n//Create list for storing hourly maximums of rolling 15 minute average kVA values\\nList MaxkVAList = new ArrayList();\\n//Create list for storing hourly maximum of rolling 15 minute average kVA values during peak hours only\\nList MaxPeakkVAList = new ArrayList();\\n//Create variable to store reference date of calculation\\nLong refDateA = maxkVAFifteenRoll.referenceDate;\\n//Create new date format\\nSimpleDateFormat df = new SimpleDateFormat(\\\"yyyy-MM-dd'T'HH:mm:ss\\\");\\n//Parse reference date into new date format and create new Rdate 3 hours prior to reference date\\nDate Rdate = new Date(df.parse(refDateA).getTime()-(3*60*60*1000));\\n//context.trace(Rdate);\\n//Create calendar for tracking time of kVA values\\nCalendar kVAPeakcal = GregorianCalendar.getInstance();\\n//Iterate through array of hourly maximums of rolling 15 minute average kVA values\\nforeach(element:maxkVAFifteenRoll.array){\\n    //Allow value if timestamped more than 3 hours prior to reference date\\n    if(element.getTime().before(Rdate)){\\n        //Add value to MaxkVAList\\n        MaxkVAList.add(element.value);\\n        //context.trace(MaxkVAList);\\n        //Set the kVAPeakcal calendar to the time of the array element\\n        kVAPeakcal.setTime(element.time);\\n        //context.trace(kVAPeakcal);\\n        //Retrieve the hour of the day from the kVAPeakcal calendar\\n        int hour = kVAPeakcal.get(Calendar.HOUR_OF_DAY);\\n        //Retrieve the day of the week from the kVAPeakcal calendar\\n        int dow = kVAPeakcal.get(Calendar.DAY_OF_WEEK);\\n        //context.trace(\\\"dow=\\\"+dow);\\n        //context.trace(\\\"hour=\\\"+hour);\\n        //Check if the time is between 7 am and 7 pm Monday-Friday\\n        if(hour >= 7 && hour < 19 && dow >=2 && dow <=6){\\n            //If it is between 7 am and 7 pm Monday-Friday, add the value to the \\\"MaxPeakkVAList\\\"\\n            MaxPeakkVAList.add(element.value);\\n            //context.trace(MaxPeakkVAList);\\n        }\\n    }\\n}\\n//Retrieve and store the maximum value from the MaxkVAList\\nBigDecimal maxMaxkVAFifteen = Collections.max(MaxkVAList);\\n//context.trace(\\\"MaxMaxkVAFifteen:\\\" +MaxMaxkVAFifteen);\\n//Retrieve and store the maximum value from the MaxkVAList\\nBigDecimal maxMaxPeakkVAFifteen = Collections.max(MaxPeakkVAList);\\ncontext.trace(\\\"maxMaxPeakkVAFifteen:\\\" +maxMaxPeakkVAFifteen);\\n//SECTION 2: MAXIMUM kW DETERMINATIONS\\n//Create list for storing hourly maximums of rolling 15 minute average kW values\\nList MaxkWList = new ArrayList();\\n//Create list for storing hourly maximum of rolling 15 minute average kW values during peak hours only\\nList MaxPeakkWList = new ArrayList();\\n//Create calendar for tracking time of kW values\\nCalendar kWPeakcal = GregorianCalendar.getInstance();\\n//Iterate through array of hourly maximums of rolling 15 minute average kVA values\\nforeach(element:maxkWFifteenRoll.array){\\n    //Allow value if timestamped more than 3 hours prior to reference date\\n    if(element.getTime().before(Rdate);\\n      ){\\n        //Add value to MaxkVAList\\n        MaxkWList.add(element.value);\\n        //context.trace(MaxkVAList);\\n        //Set the kWPeakcal calendar to the time of the array element\\n        kWPeakcal.setTime(element.time);\\n        //context.trace(kWPeakcal);\\n        //Retrieve the hour of the day from the kWPeakcal calendar\\n        int hour = kWPeakcal.get(Calendar.HOUR_OF_DAY);\\n        //Retrieve the day of the week from the kWPeakcal calendar\\n        int dow = kWPeakcal.get(Calendar.DAY_OF_WEEK);\\n        //context.trace(\\\"dow=\\\"+dow);\\n        //context.trace(\\\"hour=\\\"+hour);\\n        //Check if the time is between 7 am and 7 pm Monday-Friday\\n        if(hour >= 7 && hour < 19 && dow >=2 && dow <=6){\\n            //If it is between 7 am and 7 pm Monday-Friday, add the value to the \\\"MaxPeakkWList\\\"\\n            MaxPeakkWList.add(element.value);\\n            //context.trace(MaxPeakkWList);\\n        }\\n    }\\n}\\n//Retrieve and store the maximum value from the MaxkWList\\nBigDecimal maxMaxkWFifteen = Collections.max(MaxkWList);\\n//context.trace(\\\"MaxkWList size: \\\" +MaxkWList.size);\\n//context.trace(\\\"MaxMaxkWFifteen:\\\" +MaxMaxkWFifteen);\\n//Retrieve and store the maximum value from the MaxkWList\\nBigDecimal maxMaxPeakkWFifteen = Collections.max(MaxPeakkWList);\\ncontext.trace(\\\"maxMaxPeakkWFifteen:\\\" +maxMaxPeakkWFifteen);\\n//SECTION 3: BILLED DEMAND DETERMINATIONS\\n//Initialize variable for overall billed demand\\nBigDecimal billedDemand;\\n//If 90% of maximum kVA is greater than maximum kW\\nif(0.9*maxMaxkVAFifteen>maxMaxkWFifteen){\\n    //Set billed demand to 90% of maximum kVA\\n    billedDemand=0.9*maxMaxkVAFifteen;\\n}\\nelse{\\n    //If not, set billed demand to maximum kW\\n    billedDemand = maxMaxkWFifteen}\\ncontext.trace(\\\"billedDemand:\\\" +billedDemand);\\n//Initialize variable for billed demand (peak hours)\\nBigDecimal billedPeakHrDemand;\\n//If 90% of maximum kVA (peak hours) is greater than maximum kW (peak hours)\\nif(0.9*maxMaxPeakkVAFifteen>maxMaxPeakkWFifteen){\\n    //Set billed demand (peak hours) to 90% of maximum kVA (peak hours)\\n    billedPeakHrDemand=0.9*maxMaxPeakkVAFifteen;\\n}\\nelse{\\n    //If not, set billed demand (peak hours) to maximum kW (peak hours)\\n    billedPeakHrDemand = maxMaxPeakkWFifteen}\\n//context.trace(\\\"BilledPeakHrDemand:\\\" +BilledPeakHrDemand);\\n//Initialize value for the Provincial Network Transmission Fee\\n//SECTION 4: CALCULATION OF CHARGES\\n//Calculate energy consumption by subtracting G17 consumption from overall consumption\\n//G17 has a rating of 600V and 48amps; multiplying by square root of 3 and average power factor\\n//for the hour yields an estimate of the kWh consumed by G17 for that hour\\nBigDecimal electConsumptTotal=kWh.value-pf.value.abs()*Math.sqrt(3)*600*48/1000;\\n//context.trace(ElectConsumptHour);\\n//The Hourly Ontario Energy Price (hoep) is always quoted in Standard Time\\n//Create calendar named kWhcal for determining whether daylight saving time is in effect\\nCalendar kWhcal = GregorianCalendar.getInstance();\\n//Set the kWhcal calendar to the timestamp of the input variable kWh\\nkWhcal.setTime(kWh.time);\\n//Initialize variable \\\"daylightSave\\\" to store DST_OFFSET property from kWhcal calendar\\nint daylightSave = kWhcal.get(Calendar.DST_OFFSET);\\n//context.trace(kWhcal);\\n//context.trace (daySave);\\n//Calculate \\\"Usage This Bill\\\" by multilpying total electricity consumption by Adjustment Factor\\nBigDecimal adjustedUsage = electConsumptTotal*($(CNDAdjustmentFactor));\\n//Initialize local variable to store the dollar amount of the Electricity charge\\nBigDecimal electCharge;\\n//If daylightSave equals 3600000 (milliseconds), Daylight Saving Time is in effect\\nif(daylightSave==3600000){\\n    //Apply usage adjustment factor to total energy consumption\\n    //Calculate Electricity Charge based on earlier hoep price (adjust hoep to $/kWh)\\n    electCharge= adjustedUsage* hoep.array[0].value/1000;\\n}\\n//If daylightSave equals 0, DST is not in effect\\nelse if(daylightSave==0){\\n    //Apply usage adjustment factor to total energy consumption\\n    //Calculate Electricity Charge based on later hoep price\\n    electCharge= adjustedUsage*hoep.array[1].value/1000;\\n}\\n//context.trace(electConsumptTotal);\\ncontext.trace(\\\"electCharge:\\\" +electCharge);\\n//Create new calendar called \\\"hcal\\\" for determining the number of hours in the month\\nCalendar hcal = GregorianCalendar.getInstance();\\n//Set hcal to the timestamp of gaFirst (i.e. midnight of the first day of the month)\\nhcal.setTime(gaFirst.time);\\n//Create variable Time1 to store time at beginning of the month (in milliseconds since Jan 1., 1970)\\nBigDecimal time1=hcal.time.getTime();\\n//Add one month to hcal\\nhcal.add(Calendar.MONTH,1);\\n//Create variable Time2 to store new time of hcal (in milliseconds since Jan 1., 1970)\\nBigDecimal time2 = hcal.time.getTime();\\n//Obtain number of hours in the month by subtracting Time 1 from Time 2 and converting from milliseconds to hours\\nBigDecimal hoursInMonth = (time2-time1)/(60*60*1000);\\ncontext.trace(\\\"hoursInMonth:\\\" +hoursInMonth);\\n//Multiply peak power demand by Provincial Network Transmission Fee Rate\\nBigDecimal provNetwrkTrans = billedPeakHrDemand*$(CNDProvNtwrkTransRate)/hoursInMonth;\\n//context.trace(\\\"ProvNetwrkTrans:\\\" +ProvNetwrkTrans);\\n//Calculate Global Adjustment charge based on Global Adjustment First Estimate and \\\"Adjusted Usage\\\"\\nBigDecimal globalAdj = (gaFirst.value/1000)*adjustedUsage;\\ncontext.trace(\\\"globalAdj:\\\" +globalAdj);\\n//Intialize variable for Monthly Service Charges\\nBigDecimal monthlyService = ($(CNDMnthlyServiceChrg)+$(CNDAdminFee))/hoursInMonth;\\n//Initialize variable for Rate Rider\\nBigDecimal rateRider;\\nrateRider = ($(CNDRateRider)+$(CNDRateRidersVol))*billedDemand/hoursInMonth;\\ncontext.trace(\\\"rateRider:\\\" +rateRider);\\n//Initialize variable for Distribution kW Charge\\nBigDecimal distribkW;\\ndistribkW = $(CNDDistribkWCharge)*billedDemand/hoursInMonth;\\n//context.trace(\\\"distribkW:\\\" +distribkW);\\n//Initialize variable for Provinical Line & Transformation Connection\\nBigDecimal provLineTransCon;\\nprovLineTransCon = $(CNDProvLineTransConn)*billedDemand/hoursInMonth;\\n//Initialize variable for debt retirement charge\\nBigDecimal debtRetire;\\ndebtRetire = electConsumptTotal*$(CNDDebtRetire);\\n//Initialize variable for Wholesale Market charge\\nBigDecimal wholesaleMarket;\\nwholesaleMarket = adjustedUsage*$(CNDWhlslMrkt);\\n//Initialize variable for transformer allowance\\nBigDecimal transformAllow;\\n//Calculate the transformer allowance from the maximum peak fifteen minute average; the transformer allowance is deducted from the total bill\\ntransformAllow = billedPeakHrDemand*$(CNDTransformAllow)/hoursInMonth;\\n//context.trace(TransformAllow);\\n//Initialize variable for Delivery Charges\\nBigDecimal delivery;\\ndelivery = rateRider+distribkW+provNetwrkTrans+provLineTransCon;\\ncontext.trace(\\\"Delivery:\\\" +delivery);\\n//Initialize variable for Total Charges\\nBigDecimal totalCharges=0;\\n//Add subtotals for total charge and apply HST\\ntotalCharges =monthlyService+(electCharge+globalAdj+delivery+wholesaleMarket+debtRetire+transformAllow)*1.13;\\n//context.trace(\\\"Total Charges is \\\" +totalCharges);\\n//OUTPUTS\\n//Current billed demand\\nbilledDemandOut.value=billedDemand;\\n//Electricity Charge\\nelectChargeOut.value=electCharge;\\n//Estimate total charge(converted to cents/m3)\\nif(1.0<flow.value){\\n    flowCharge.value= (totalCharges*100)/(flow.value*3600/1000);\\n}\\n//Estimated total hourly charge\\ntotalChargeOut.value=totalCharges;\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-09-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : false,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"33bc274e-851b-4b82-9cda-51e5b7775ac1\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"CNDAdjustmentFactor\",\n  \"description\" : \"Cambridge North Dumfries Hydro Adjustment Factor Applied To Actual Consumption\",\n  \"units\" : \"\",\n  \"defaultValue\" : 1.0355,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"CNDAdminFee\",\n  \"description\" : \"Cambridge North Dumfries Admin Fee - Standard Supply Service\",\n  \"units\" : \"$/month\",\n  \"defaultValue\" : 0.25,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"CNDDebtRetire\",\n  \"description\" : \"Cambridge North Dumfries Debt Retirement Charge\",\n  \"units\" : \"$/kWh\",\n  \"defaultValue\" : 0.0070,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 3.5368,\n    \"start\" : \"2015-11-01T00:00:00.000\",\n    \"end\" : \"2020-11-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"CNDDistribkWCharge\",\n  \"description\" : \"Cambridge North Dumfries Distribution kW Charge\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : 3.4920,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 1004.00,\n    \"start\" : \"2015-11-01T00:00:00.000\",\n    \"end\" : \"2020-11-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"CNDMnthlyServiceChrg\",\n  \"description\" : \"Cambridge North Dumfries Hydro Monthly Service Charge\",\n  \"units\" : \"$\",\n  \"defaultValue\" : 991.12,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 1.8148,\n    \"start\" : \"2015-11-01T00:00:00.000\",\n    \"end\" : \"2020-11-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"CNDProvLineTransConn\",\n  \"description\" : \"Cambridge North Dumfries Hydro Provincial Line and Transformation Connection Rate\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : 1.8788,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 1.4728,\n    \"start\" : \"2015-11-01T00:00:00.000\",\n    \"end\" : \"2020-11-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"CNDRateRider\",\n  \"description\" : \"Cambridge North Dumfries Hydro Rate Riders Rate\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : -2.0161,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 0.0577,\n    \"start\" : \"2015-11-01T00:00:00.000\",\n    \"end\" : \"2020-11-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"CNDRateRidersVol\",\n  \"description\" : \"Cambridge North Dumfries Hydro Rate Riders Volumetric Rate\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : -2.4124,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"CNDTransformAllow\",\n  \"description\" : \"Cambridge North Dumfries Hydro Transformer Allowance Rate\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : -0.60,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"CNDWhlslMrkt\",\n  \"description\" : \"Cambridge North Dumfries Wholesale Market\",\n  \"units\" : \"$/kWh\",\n  \"defaultValue\" : 0.0057,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ {\n    \"value\" : 2.800,\n    \"start\" : \"2015-11-01T00:00:00.000\",\n    \"end\" : \"2020-11-01T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"CNDProvNtwrkTransRate\",\n  \"description\" : \"Cambridge North Dumfries Provincial Network Transmission Rate\",\n  \"units\" : \"$/kW\",\n  \"defaultValue\" : 2.8711,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.TUPPM_MTHLY_BILLED_DMD\",\"name\":\"billedDemandOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT4H\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.TUPPM_HRLY_ENERGY_CHARGE\",\"name\":\"electChargeOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT4H\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.TUPPM_TOT_CHRGE_M3_EST\",\"name\":\"flowCharge\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT4H\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.TUPPM_TOT_HRLY_CHARGE_EST\",\"name\":\"totalChargeOut\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT4H\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Turnbull Power Multiplier\",\n  \"description\" : \"Accounts for error in CT ratio configuration prior to May 27 2015\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"3a60917a-388a-49eb-b8cf-43973ec00303\",\n  \"constant\" : [ \"TurnbullPMMultiplier\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"KWCRH.KWCR_TUPPM0100QKR.F_CV:sample:PT2M\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"foreach(element:__source__.array){\\n    element.value=element.value*$(TurnbullPMMultiplier);\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2012-09-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"3a60917a-388a-49eb-b8cf-43973ec00303\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2012-09-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ {\n    \"value\" : 12,\n    \"start\" : \"2008-01-01T00:00:00.000\",\n    \"end\" : \"2015-05-27T00:00:00.000\",\n    \"effectiveStartMonth\" : null,\n    \"effectiveStartDay\" : null,\n    \"effectiveEndMonth\" : null,\n    \"effectiveEndDay\" : null\n  } ],\n  \"name\" : \"TurnbullPMMultiplier\",\n  \"description\" : \"Multiplier for Turnbull Power Monitor\",\n  \"units\" : \"\",\n  \"defaultValue\" : 1,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Turnbull PS Power Hourly 15 Minute Rolling Averages Maximums\",\n  \"description\" : \"Calculates hourly maximum 15 minute rolling averages based on five minute maximums\",\n  \"schedule\" : \"30 * * * *\",\n  \"lastRunMessage\" : \"8d8364cd-9325-4fb2-9c3f-78da06388f51\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MDPH.MDPSCDA.TUPPM0100VPV.F_CV:maximum:PT5M\",\n    \"name\" : \"kVA\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT95M\",\n    \"duration\" : \"PT70M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.TUPPM0100VKR.F_CV:maximum:PT5M\",\n    \"name\" : \"kW\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT95M\",\n    \"duration\" : \"PT70M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.TUPPM0100QMP.F_CV:average:PT5M\",\n    \"name\" : \"pf\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"PT95M\",\n    \"duration\" : \"PT70M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MDPH.MDPSCDA.TUPPM0100VPV_MAX15\",\n    \"name\" : \"maxkVAFifteenRoll\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT90M\",\n    \"scale\" : 6\n  }, {\n    \"value\" : \"ET.MDPH.MDPSCDA.TUPPM0100VKR_MAX15\",\n    \"name\" : \"maxkWFifteenRoll\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"PT90M\",\n    \"scale\" : 6\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Initialize variable for rolling 15 minute average\\nBigDecimal fifteenAvg = 0;\\n//Initialize variable for maximum of the rolling 15 minute averages\\nBigDecimal maxFifteen=0;\\nint i;\\n//Initialize variable for storing the apparent power (constant) of the G17 power equation\\n//G17 is rated at 48 amps and 600 V\\nBigDecimal g17Const = Math.sqrt(3)*48*600/1000;\\ncontext.trace(g17Const);\\n//Define a function for calculating the maximum 15 minute rolling average\\nfor(i=1;\\n    i<(kVA.array.size-1);\\n    i++){\\n    //Calculate the average of each block of 3 five minute maximums to get a 15 minute rolling average\\n    //Subtract the portion of the apparent power consumed by G17 \\n    fifteenAvg = (kVA.asc[i-1].value-g17Const+kVA.asc[i].value-g17Const\\n                  +kVA.asc[i+1].value-g17Const)/3;\\n    //Store maximum fifteen minute rolling average\\n    if(fifteenAvg > maxFifteen){\\n        maxFifteen = fifteenAvg;\\n    }\\n}\\n//Output result\\nmaxkVAFifteenRoll.value=maxFifteen;\\nfifteenAvg=0;\\nmaxFifteen=0;\\nfor(i=1;\\n    i<(kW.array.size-1);\\n    i++){\\n    //Calculate the average of each block of 3 five minute maximums to get a 15 minute rolling average\\n    //Subtract the portion of the real power consumed by G17 by multiplying the power factor by the apparent power\\n    fifteenAvg = (kW.asc[i-1].value-((pf.asc[i-1].value.abs())*g17Const)+kW.asc[i].value-((pf.asc[i].value.abs())*g17Const)\\n                  +kW.asc[i+1].value-((pf.asc[i+1].value.abs())*g17Const))/3;\\n    //Store maximum fifteen minute rolling average\\n    if(fifteenAvg > maxFifteen){\\n        maxFifteen = fifteenAvg;\\n    }\\n}\\n//Output result\\nmaxkWFifteenRoll.value=maxFifteen;\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-09-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",pf,kVA,kW,__results__\",\n    \"outputs\" : \",maxkVAFifteenRoll,maxkWFifteenRoll\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"8d8364cd-9325-4fb2-9c3f-78da06388f51\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MDPH.MDPSCDA.TUPPM0100VPV_MAX15\",\"name\":\"maxkVAFifteenRoll\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT90M\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPH.MDPSCDA.TUPPM0100VKR_MAX15\",\"name\":\"maxkWFifteenRoll\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"PT90M\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"UV K23 Calculation\",\n  \"description\" : \"\",\n  \"schedule\" : \"0 4 * * *\",\n  \"lastRunMessage\" : \"05415e52-5c93-4e33-93ec-051418a5909f\",\n  \"constant\" : [ \"K23UVCCL\", \"K23TurbHI\", \"K23UVFlowHI\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR3.K23TWL01NI01QVA.F_CV:maximum:PT2M\",\n    \"name\" : \"Discharge_NTU\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K23TWL01NI01QVA.F_CV\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K23UV001UVDSQVA.F_CV:minimum:PT2M\",\n    \"name\" : \"UV_Dose\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K23UV001UVDSQVA.F_CV\\\",\\\"mode\\\":\\\"minimum\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR3.K23TWL01FI01QVA.F_CV:average:PT2M\",\n    \"name\" : \"UV_Flow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.K23TWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"average\\\",\\\"interval\\\":\\\"PT2M\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.K23 _Discharge_Daily_Compliance_Duration\",\n    \"name\" : \"Daily_Duration\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K23_Discharge_Daily_Compliance_Total_Flow\",\n    \"name\" : \"Daily_Flow\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K23_Discharge_Total_Flow_Compliance_Duration\",\n    \"name\" : \"Flow_Duration\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K23_Discharge_Total_Flow_Compliance_MAX\",\n    \"name\" : \"Flow_Max\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K23_Discharge_Total_Flow_Compliance_Total_Flow\",\n    \"name\" : \"Flow_Total\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K23_Discharge_NTU_Compliance_Duration\",\n    \"name\" : \"NTU_Duration\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K23_Discharge_NTU_Compliance_Total_Flow\",\n    \"name\" : \"NTU_Flow\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K23_Discharge_NTU_Compliance_MAX\",\n    \"name\" : \"NTU_Max\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K23_Discharge_UV_Dosage_Compliance_Total_Flow\",\n    \"name\" : \"UV_DFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K23_Discharge_UV_Dosage_Compliance_Duration\",\n    \"name\" : \"UV_Duration\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.K23_Discharge_UV_Dosage_Compliance_MIN\",\n    \"name\" : \"UV_Min\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Variables\\r\\n//\\r\\n//Event Tracking\\r\\n// null indicates no current event\\r\\nData NTU_Event_MAX = null;\\r\\nData NTU_Event_Duration = null;\\r\\nData NTU_Event_Flow = null;\\r\\n// null indicates no current event\\r\\nData UV_Event_MIN = null;\\r\\nData UV_Event_Duration = null;\\r\\nData UV_Event_Flow = null;\\r\\n//null indicates no current activity\\r\\nData Flow_Event_Max = null;\\r\\nData Flow_Event_Duration = null;\\r\\nData Flow_Event_Flow = null;\\r\\nDaily_Duration.value = 0;\\r\\nDaily_Flow.value = 0.0;\\r\\ndef endFlowEvent() {\\r\\n    if (Flow_Event_Max != null) {\\r\\n        context.trace(\\\"Flow Event time,Max,Duration,Flow: \\\"+Flow_Event_Max.time+\\\", \\\"+Flow_Event_Max.value+\\\", \\\"+Flow_Event_Duration.value+\\\", \\\"+Flow_Event_Flow.value);\\r\\n        Flow_Event_Max = null;\\r\\n    }\\r\\n}\\r\\ndef endNTUEvent() {\\r\\n    if (NTU_Event_MAX != null) {\\r\\n        context.trace(\\\"NTU Event time,MAX,Duration,Flow: \\\"+NTU_Event_MAX.time+\\\", \\\"+NTU_Event_MAX.value+\\\", \\\"+NTU_Event_Duration.value+\\\", \\\"+NTU_Event_Flow.value);\\r\\n        NTU_Event_MAX = null;\\r\\n    }\\r\\n}\\r\\ndef endUVEvent() {\\r\\n    if (UV_Event_MIN != null) {\\r\\n        context.trace(\\\"UV Event time,MIN,Duration,Flow: \\\"+UV_Event_MIN.time+\\\", \\\"+UV_Event_MIN.value+\\\", \\\"+UV_Event_Duration.value+\\\", \\\"+UV_Event_Flow.value);\\r\\n        UV_Event_MIN = null;\\r\\n    }\\r\\n}\\r\\n//Fill in any data gaps\\r\\nfor (TagInput input: inputs ) {\\r\\n    input.fillGaps(\\\"PT2M\\\", 0, 0);\\r\\n}\\r\\nint iterations = UV_Flow.array.size();\\r\\n//loop over the data\\r\\nfor(int index = 0;\\r\\n    index < iterations;\\r\\n    index++){\\r\\n    Data Flow = UV_Flow.asc.get(index);\\r\\n    Data NTU = Discharge_NTU.asc.get(index);\\r\\n    Data Dose = UV_Dose.asc.get(index);\\r\\n    //see if there is any flow\\r\\n    boolean activeFlow = (Flow.good && Flow.value > 5);\\r\\n    //get the time from the flow\\r\\n    XMLGregorianCalendar time = Flow.time;\\r\\n    if(activeFlow){\\r\\n        //calculate interval flow (may need per event)\\r\\n        BigDecimal intervalFlowRate = 0.0;\\r\\n        if(Flow.good  && Flow.value > 5)\\r\\n            intervalFlowRate += Flow.value;\\r\\n        //Flow Compliance check\\r\\n        if(intervalFlowRate > K23UVFlowHI.value){\\r\\n            //an event\\r\\n            if(Flow_Event_Max == null){\\r\\n                Flow_Event_Max = new Data(time, intervalFlowRate, 100);\\r\\n                Flow_Event_Duration = new Data(time, 2, 100);\\r\\n                Flow_Event_Flow = new Data(time, (intervalFlowRate * 120 / 1000), 100);\\r\\n                Flow_Max.add(Flow_Event_Max);\\r\\n                Flow_Duration.add(Flow_Event_Duration);\\r\\n                Flow_Total.add(Flow_Event_Flow);\\r\\n            }\\r\\n            else{\\r\\n                if(intervalFlowRate > Flow_Event_Max.value)\\r\\n                    Flow_Event_Max.value = intervalFlowRate;\\r\\n                Flow_Event_Duration.value += 2;\\r\\n                Flow_Event_Flow.value += (intervalFlowRate * 120/1000);\\r\\n            }\\r\\n        }\\r\\n        else{\\r\\n            //Flow Event has ended (if there was one)\\r\\n            endFlowEvent();\\r\\n        }\\r\\n        //UV Dose Checks\\r\\n        BigDecimal UV_Value = null;\\r\\n        if(Dose.good && Dose.value < K23UVCCL.value){\\r\\n            UV_Value = Dose.value;\\r\\n        }\\r\\n        if(UV_Value != null){\\r\\n            //an event\\r\\n            if(UV_Event_MIN == null){\\r\\n                UV_Event_MIN = new Data(time, UV_Value, 100);\\r\\n                UV_Event_Duration = new Data(time, 2, 100);\\r\\n                UV_Event_Flow = new Data(time, (intervalFlowRate * 120 / 1000), 100);\\r\\n                UV_Min.add(UV_Event_MIN);\\r\\n                UV_Duration.add(UV_Event_Duration);\\r\\n                UV_DFlow.add(UV_Event_Flow);\\r\\n            }\\r\\n            else {\\r\\n                if (UV_Value < UV_Event_MIN.value)\\r\\n                    UV_Event_MIN.value = UV_Value;\\r\\n                UV_Event_Duration.value += 2;\\r\\n                UV_Event_Flow.value += (intervalFlowRate * 120/1000);\\r\\n            }\\r\\n        }\\r\\n        else {\\r\\n            // UV event has ended (if there is one)\\r\\n            endUVEvent();\\r\\n        }\\r\\n        //Turbidity Checks\\r\\n        BigDecimal NTU_Value = null;\\r\\n        if(NTU.value >  K23TurbHI.value){\\r\\n            NTU_Value = NTU.value;\\r\\n        }\\r\\n        // if this is an event\\r\\n        if(NTU_Value != null){\\r\\n            if(NTU_Event_MAX == null){\\r\\n                NTU_Event_MAX = new Data(time, NTU_Value, 100);\\r\\n                NTU_Event_Duration = new Data(time, 2, 100);\\r\\n                NTU_Event_Flow = new Data(time, (intervalFlowRate * 120 /1000), 100);\\r\\n                NTU_Max.add(NTU_Event_MAX);\\r\\n                NTU_Duration.add(NTU_Event_Duration);\\r\\n                NTU_Flow.add(NTU_Event_Flow);\\r\\n            }\\r\\n            else {\\r\\n                if (NTU_Value > NTU_Event_MAX.value) {\\r\\n                    NTU_Event_MAX.value = NTU_Value;\\r\\n                }\\r\\n                NTU_Event_Duration.value += 2;\\r\\n                NTU_Event_Flow.value += (intervalFlowRate * 120/1000);\\r\\n            }\\r\\n        }\\r\\n        else {\\r\\n            // NTU event has ended (if there is one)\\r\\n            endNTUEvent();\\r\\n        }\\r\\n        //\\r\\n        //\\r\\n        // Update Daily Totals...\\r\\n        if (NTU_Event_MAX != null || UV_Event_MIN != null || Flow_Event_Max != null) {\\r\\n            Daily_Duration.value += 2;\\r\\n            Daily_Flow.value += (intervalFlowRate * 120/1000);\\r\\n        }\\r\\n    }\\r\\n    else {\\r\\n        // check if there are any events, and end them\\r\\n        endNTUEvent();\\r\\n        endUVEvent();\\r\\n        endFlowEvent();\\r\\n    }\\r\\n}\\r\\nendNTUEvent();\\r\\nendUVEvent();\\r\\nendFlowEvent();\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2017-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",UV_Flow,Discharge_NTU,UV_Dose,__results__\",\n    \"outputs\" : \",UV_Min,NTU_Flow,UV_DFlow,NTU_Max,NTU_Duration,Daily_Flow,Daily_Duration,UV_Duration\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"05415e52-5c93-4e33-93ec-051418a5909f\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"DIRECT\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K23UVCCL\",\n  \"description\" : \"Critical control limit for K23 UV Dose\",\n  \"units\" : \"mJ/cm2\",\n  \"defaultValue\" : 42,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K23TurbHI\",\n  \"description\" : \"K23 turbidity high limit\",\n  \"units\" : \"NTU\",\n  \"defaultValue\" : 0.8,\n  \"referenceOffset\" : \"P0D\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"K23UVFlowHI\",\n  \"description\" : \"K23 UV Max Flow Limit\",\n  \"units\" : \"L/s\",\n  \"defaultValue\" : 76,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K23 _Discharge_Daily_Compliance_Duration\",\"name\":\"Daily_Duration\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K23_Discharge_Daily_Compliance_Total_Flow\",\"name\":\"Daily_Flow\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K23_Discharge_Total_Flow_Compliance_Duration\",\"name\":\"Flow_Duration\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K23_Discharge_Total_Flow_Compliance_MAX\",\"name\":\"Flow_Max\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K23_Discharge_Total_Flow_Compliance_Total_Flow\",\"name\":\"Flow_Total\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K23_Discharge_NTU_Compliance_Duration\",\"name\":\"NTU_Duration\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K23_Discharge_NTU_Compliance_Total_Flow\",\"name\":\"NTU_Flow\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K23_Discharge_NTU_Compliance_MAX\",\"name\":\"NTU_Max\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K23_Discharge_UV_Dosage_Compliance_Total_Flow\",\"name\":\"UV_DFlow\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K23_Discharge_UV_Dosage_Compliance_Duration\",\"name\":\"UV_Duration\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.K23_Discharge_UV_Dosage_Compliance_MIN\",\"name\":\"UV_Min\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"dependant\":[],\"id\":\"b6fa3437-952e-47cf-81cd-564ce792f8c6\",\"source\":\"UV K23 Calculation\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"UV Lamp Replacement Counters [NEW] [WATH4800]\",\n  \"description\" : \"UV Lamp Replacement Counters [NEW] [WATH4800]\",\n  \"schedule\" : \"15 4 * * *\",\n  \"lastRunMessage\" : \"6063d317-e02c-4519-89e8-2b0ad5d380bc\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"#UVLAMP:WATH4800:maximum:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tagDescriptor\",\n    \"description\" : null,\n    \"startOffset\" : \"P2D\",\n    \"duration\" : \"P2D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[\\\"UVLAMP:WATH4800\\\"],\\\"tag\\\":\\\"\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Create an event type table and save data to it\\r\\ncontext.setSaveEvents(true);\\r\\nDouble intRunTime = 0;\\r\\nDouble vFirst = 0;\\r\\nDouble vLast = 0;\\r\\nDouble fivepct = 0.05;\\r\\nDouble tenpct = 0.1;\\r\\nDouble fifteenpct = 0.15;\\r\\nDouble twentypct = 0.2;\\r\\nDouble twentyfivepct = 0.25;\\r\\nString strAsset = \\\"\\\";\\r\\n//lookup table name\\r\\nString assetLookup = \\\"Lucity_Asset_Lookup\\\";\\r\\nString runtimeLookup = \\\"UV_Runtime_Trigger_Lookup\\\";\\r\\nString stationLookup = \\\"UV_Lamp_Station_Lookup\\\";\\r\\n//target table name\\r\\nString strTarget = \\\"UVLampCounters\\\";\\r\\nString myTag = \\\"\\\";\\r\\nString strNotes = \\\"\\\";\\r\\nString strStartDate = \\\"\\\";\\r\\nString station = \\\"\\\";\\r\\n\\r\\n//loop through tags in descriptor\\r\\nfor(Data ti : __source__.tags) {\\r\\n\\t//fill gaps\\r\\n    ti.fillGaps(\\\"P1D\\\",0,0);\\r\\n    myTag = ti.tagName;\\r\\n    context.trace(myTag);\\r\\n   \\r\\n    //get runtime trigger from lookup table\\r\\n    intRunTime = context.lookup(runtimeLookup, myTag);\\r\\n    //get asset from lookup table\\r\\n    strAsset = context.lookup(assetLookup, myTag);\\r\\n    //get station from lookup table\\r\\n    station = context.lookup(stationLookup, myTag);\\r\\n    \\r\\n\\tcontext.trace(intRunTime + \\\", \\\" + strAsset + \\\", \\\" + station);\\r\\n    \\r\\n    if (station == \\\"MWTP\\\") {\\r\\n        \\r\\n        Integer falloutCounter = 0;\\r\\n        Integer triggeredCounter = 0;\\r\\n        Integer zero_fiveCounter = 0;\\r\\n        Integer five_tenCounter = 0;\\r\\n        Integer ten_fifteenCounter = 0;\\r\\n        Integer fifteen_twentyCounter = 0;\\r\\n        Integer twenty_twentyfiveCounter = 0;\\r\\n        Integer overTwentyFiveCounter = 0;\\r\\n    \\r\\n    \\t//loop through the array for each tag in the descriptor\\r\\n    \\r\\n        for (Integer i=0; i < ti.array.size-1; i++) {\\r\\n\\r\\n            strStartDate = ti.array[i].time;\\r\\n            if (ti.array[i].quality !=0) {\\r\\n                vFirst = ti.array[i].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vFirst = 0;\\r\\n            }\\r\\n\\r\\n            if (ti.array[i+1].quality !=0) {\\r\\n                vLast = ti.array[i+1].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vLast = 0;\\r\\n            }\\r\\n            context.trace(vFirst + \\\", \\\" + vLast);\\r\\n\\r\\n            // Run the counter if vFirst is greater than the trigger value\\r\\n            if (vFirst >= intRunTime) {\\r\\n                falloutCounter += 1;\\r\\n            }\\r\\n\\r\\n            // write to log when last value is greater than/equal to trigger\\r\\n            // AND first value is less than trigger\\r\\n            if (vLast >= intRunTime &&  intRunTime > vFirst) {\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"DESC Write to DB\\\" + strNotes);\\r\\n\\r\\n                //Update the trigger counter\\r\\n                triggeredCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 0% and 5% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 0 and 5 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 0-5 pct counter\\r\\n                zero_fiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct < ((intRunTime-vLast)/intRunTime)) && (tenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 5% and 10% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 5% and 10% Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 5-10 pct counter\\r\\n                five_tenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (tenpct < ((intRunTime-vLast)/intRunTime)) && (fifteenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 10% and 15% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 10 and 15 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 10-15 pct counter\\r\\n                ten_fifteenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fifteenpct < ((intRunTime-vLast)/intRunTime)) && (twentypct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 15% and 20% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 15 and 20 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 15-20 pct counter\\r\\n                fifteen_twentyCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentypct < ((intRunTime-vLast)/intRunTime)) && (twentyfivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 20% and 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 20 and 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 20-25 pct counter\\r\\n                twenty_twentyfiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentyfivepct < ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is more than 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Over 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the over 25 pct counter\\r\\n                overTwentyFiveCounter += 1;\\r\\n\\r\\n            }\\r\\n        }\\r\\n        \\r\\n        Event event = context.createEvent(ti);\\r\\n        event.type = strTarget;\\r\\n\\r\\n        event.set(\\\"startDate\\\", ti.startDate);\\r\\n        event.set(\\\"station\\\", \\\"MWTP\\\");\\r\\n        event.set(\\\"Triggered\\\", triggeredCounter);\\r\\n        event.set(\\\"0005Pct\\\", zero_fiveCounter);\\r\\n        event.set(\\\"0510Pct\\\", five_tenCounter);\\r\\n        event.set(\\\"1015Pct\\\", ten_fifteenCounter);\\r\\n        event.set(\\\"1520Pct\\\", fifteen_twentyCounter);\\r\\n        event.set(\\\"2025Pct\\\", twenty_twentyfiveCounter);\\r\\n        event.set(\\\"Over25Pct\\\", overTwentyFiveCounter);\\r\\n        event.commit();\\r\\n    }\\r\\n    \\r\\n    if (station == \\\"K23\\\") {\\r\\n        \\r\\n        Integer falloutCounter = 0;\\r\\n        Integer triggeredCounter = 0;\\r\\n        Integer zero_fiveCounter = 0;\\r\\n        Integer five_tenCounter = 0;\\r\\n        Integer ten_fifteenCounter = 0;\\r\\n        Integer fifteen_twentyCounter = 0;\\r\\n        Integer twenty_twentyfiveCounter = 0;\\r\\n        Integer overTwentyFiveCounter = 0;\\r\\n        \\r\\n    \\t//loop through the array for each tag in the descriptor\\r\\n    \\r\\n        for (Integer i=0; i < ti.array.size-1; i++) {\\r\\n\\r\\n            strStartDate = ti.array[i].time;\\r\\n            if (ti.array[i].quality !=0) {\\r\\n                vFirst = ti.array[i].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vFirst = 0;\\r\\n            }\\r\\n\\r\\n            if (ti.array[i+1].quality !=0) {\\r\\n                vLast = ti.array[i+1].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vLast = 0;\\r\\n            }\\r\\n            context.trace(vFirst + \\\", \\\" + vLast);\\r\\n\\r\\n            // Run the counter if vFirst is greater than the trigger value\\r\\n            if (vFirst >= intRunTime) {\\r\\n                falloutCounter += 1;\\r\\n            }\\r\\n\\r\\n            // write to log when last value is greater than/equal to trigger\\r\\n            // AND first value is less than trigger\\r\\n            if (vLast >= intRunTime &&  intRunTime > vFirst) {\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"DESC Write to DB\\\" + strNotes);\\r\\n\\r\\n                //Update the trigger counter\\r\\n                triggeredCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 0% and 5% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 0 and 5 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 0-5 pct counter\\r\\n                zero_fiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct < ((intRunTime-vLast)/intRunTime)) && (tenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 5% and 10% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 5% and 10% Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 5-10 pct counter\\r\\n                five_tenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (tenpct < ((intRunTime-vLast)/intRunTime)) && (fifteenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 10% and 15% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 10 and 15 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 10-15 pct counter\\r\\n                ten_fifteenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fifteenpct < ((intRunTime-vLast)/intRunTime)) && (twentypct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 15% and 20% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 15 and 20 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 15-20 pct counter\\r\\n                fifteen_twentyCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentypct < ((intRunTime-vLast)/intRunTime)) && (twentyfivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 20% and 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 20 and 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 20-25 pct counter\\r\\n                twenty_twentyfiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentyfivepct < ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is more than 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Over 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the over 25 pct counter\\r\\n                overTwentyFiveCounter += 1;\\r\\n\\r\\n            }\\r\\n        }\\r\\n        \\r\\n        Event event = context.createEvent(ti);\\r\\n        event.type = strTarget;\\r\\n\\r\\n        event.set(\\\"startDate\\\", ti.startDate);\\r\\n        event.set(\\\"station\\\", \\\"K23\\\");\\r\\n        event.set(\\\"Triggered\\\", triggeredCounter);\\r\\n        event.set(\\\"0005Pct\\\", zero_fiveCounter);\\r\\n        event.set(\\\"0510Pct\\\", five_tenCounter);\\r\\n        event.set(\\\"1015Pct\\\", ten_fifteenCounter);\\r\\n        event.set(\\\"1520Pct\\\", fifteen_twentyCounter);\\r\\n        event.set(\\\"2025Pct\\\", twenty_twentyfiveCounter);\\r\\n        event.set(\\\"Over25Pct\\\", overTwentyFiveCounter);\\r\\n        event.commit();\\r\\n    }\\r\\n    \\r\\n    if (station == \\\"K26\\\") {\\r\\n        \\r\\n        Integer falloutCounter = 0;\\r\\n        Integer triggeredCounter = 0;\\r\\n        Integer zero_fiveCounter = 0;\\r\\n        Integer five_tenCounter = 0;\\r\\n        Integer ten_fifteenCounter = 0;\\r\\n        Integer fifteen_twentyCounter = 0;\\r\\n        Integer twenty_twentyfiveCounter = 0;\\r\\n        Integer overTwentyFiveCounter = 0;\\r\\n        \\r\\n    \\t//loop through the array for each tag in the descriptor\\r\\n    \\r\\n        for (Integer i=0; i < ti.array.size-1; i++) {\\r\\n\\r\\n            strStartDate = ti.array[i].time;\\r\\n            if (ti.array[i].quality !=0) {\\r\\n                vFirst = ti.array[i].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vFirst = 0;\\r\\n            }\\r\\n\\r\\n            if (ti.array[i+1].quality !=0) {\\r\\n                vLast = ti.array[i+1].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vLast = 0;\\r\\n            }\\r\\n            context.trace(vFirst + \\\", \\\" + vLast);\\r\\n\\r\\n            // Run the counter if vFirst is greater than the trigger value\\r\\n            if (vFirst >= intRunTime) {\\r\\n                falloutCounter += 1;\\r\\n            }\\r\\n\\r\\n            // write to log when last value is greater than/equal to trigger\\r\\n            // AND first value is less than trigger\\r\\n            if (vLast >= intRunTime &&  intRunTime > vFirst) {\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"DESC Write to DB\\\" + strNotes);\\r\\n\\r\\n                //Update the trigger counter\\r\\n                triggeredCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 0% and 5% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 0 and 5 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 0-5 pct counter\\r\\n                zero_fiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct < ((intRunTime-vLast)/intRunTime)) && (tenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 5% and 10% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 5% and 10% Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 5-10 pct counter\\r\\n                five_tenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (tenpct < ((intRunTime-vLast)/intRunTime)) && (fifteenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 10% and 15% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 10 and 15 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 10-15 pct counter\\r\\n                ten_fifteenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fifteenpct < ((intRunTime-vLast)/intRunTime)) && (twentypct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 15% and 20% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 15 and 20 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 15-20 pct counter\\r\\n                fifteen_twentyCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentypct < ((intRunTime-vLast)/intRunTime)) && (twentyfivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 20% and 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 20 and 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 20-25 pct counter\\r\\n                twenty_twentyfiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentyfivepct < ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is more than 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Over 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the over 25 pct counter\\r\\n                overTwentyFiveCounter += 1;\\r\\n\\r\\n            }\\r\\n        }\\r\\n        \\r\\n        Event event = context.createEvent(ti);\\r\\n        event.type = strTarget;\\r\\n\\r\\n        event.set(\\\"startDate\\\", ti.startDate);\\r\\n        event.set(\\\"station\\\", \\\"K26\\\");\\r\\n        event.set(\\\"Triggered\\\", triggeredCounter);\\r\\n        event.set(\\\"0005Pct\\\", zero_fiveCounter);\\r\\n        event.set(\\\"0510Pct\\\", five_tenCounter);\\r\\n        event.set(\\\"1015Pct\\\", ten_fifteenCounter);\\r\\n        event.set(\\\"1520Pct\\\", fifteen_twentyCounter);\\r\\n        event.set(\\\"2025Pct\\\", twenty_twentyfiveCounter);\\r\\n        event.set(\\\"Over25Pct\\\", overTwentyFiveCounter);\\r\\n        event.commit();\\r\\n    }\\r\\n    \\r\\n    if (station == \\\"W10\\\") {\\r\\n        \\r\\n        Integer falloutCounter = 0;\\r\\n        Integer triggeredCounter = 0;\\r\\n        Integer zero_fiveCounter = 0;\\r\\n        Integer five_tenCounter = 0;\\r\\n        Integer ten_fifteenCounter = 0;\\r\\n        Integer fifteen_twentyCounter = 0;\\r\\n        Integer twenty_twentyfiveCounter = 0;\\r\\n        Integer overTwentyFiveCounter = 0;\\r\\n        \\r\\n    \\t//loop through the array for each tag in the descriptor\\r\\n    \\r\\n        for (Integer i=0; i < ti.array.size-1; i++) {\\r\\n\\r\\n            strStartDate = ti.array[i].time;\\r\\n            if (ti.array[i].quality !=0) {\\r\\n                vFirst = ti.array[i].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vFirst = 0;\\r\\n            }\\r\\n\\r\\n            if (ti.array[i+1].quality !=0) {\\r\\n                vLast = ti.array[i+1].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vLast = 0;\\r\\n            }\\r\\n            context.trace(vFirst + \\\", \\\" + vLast);\\r\\n\\r\\n            // Run the counter if vFirst is greater than the trigger value\\r\\n            if (vFirst >= intRunTime) {\\r\\n                falloutCounter += 1;\\r\\n            }\\r\\n\\r\\n            // write to log when last value is greater than/equal to trigger\\r\\n            // AND first value is less than trigger\\r\\n            if (vLast >= intRunTime &&  intRunTime > vFirst) {\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"DESC Write to DB\\\" + strNotes);\\r\\n\\r\\n                //Update the trigger counter\\r\\n                triggeredCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 0% and 5% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 0 and 5 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 0-5 pct counter\\r\\n                zero_fiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct < ((intRunTime-vLast)/intRunTime)) && (tenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 5% and 10% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 5% and 10% Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 5-10 pct counter\\r\\n                five_tenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (tenpct < ((intRunTime-vLast)/intRunTime)) && (fifteenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 10% and 15% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 10 and 15 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 10-15 pct counter\\r\\n                ten_fifteenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fifteenpct < ((intRunTime-vLast)/intRunTime)) && (twentypct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 15% and 20% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 15 and 20 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 15-20 pct counter\\r\\n                fifteen_twentyCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentypct < ((intRunTime-vLast)/intRunTime)) && (twentyfivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 20% and 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 20 and 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 20-25 pct counter\\r\\n                twenty_twentyfiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentyfivepct < ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is more than 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Over 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the over 25 pct counter\\r\\n                overTwentyFiveCounter += 1;\\r\\n\\r\\n            }\\r\\n        }\\r\\n        \\r\\n        Event event = context.createEvent(ti);\\r\\n        event.type = strTarget;\\r\\n\\r\\n        event.set(\\\"startDate\\\", ti.startDate);\\r\\n        event.set(\\\"station\\\", \\\"W10\\\");\\r\\n        event.set(\\\"Triggered\\\", triggeredCounter);\\r\\n        event.set(\\\"0005Pct\\\", zero_fiveCounter);\\r\\n        event.set(\\\"0510Pct\\\", five_tenCounter);\\r\\n        event.set(\\\"1015Pct\\\", ten_fifteenCounter);\\r\\n        event.set(\\\"1520Pct\\\", fifteen_twentyCounter);\\r\\n        event.set(\\\"2025Pct\\\", twenty_twentyfiveCounter);\\r\\n        event.set(\\\"Over25Pct\\\", overTwentyFiveCounter);\\r\\n        event.commit();\\r\\n    }\\r\\n    \\r\\n    if (station == \\\"Shades Mill\\\") {\\r\\n        \\r\\n        Integer falloutCounter = 0;\\r\\n        Integer triggeredCounter = 0;\\r\\n        Integer zero_fiveCounter = 0;\\r\\n        Integer five_tenCounter = 0;\\r\\n        Integer ten_fifteenCounter = 0;\\r\\n        Integer fifteen_twentyCounter = 0;\\r\\n        Integer twenty_twentyfiveCounter = 0;\\r\\n        Integer overTwentyFiveCounter = 0;\\r\\n        \\r\\n    \\t//loop through the array for each tag in the descriptor\\r\\n    \\r\\n        for (Integer i=0; i < ti.array.size-1; i++) {\\r\\n\\r\\n            strStartDate = ti.array[i].time;\\r\\n            if (ti.array[i].quality !=0) {\\r\\n                vFirst = ti.array[i].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vFirst = 0;\\r\\n            }\\r\\n\\r\\n            if (ti.array[i+1].quality !=0) {\\r\\n                vLast = ti.array[i+1].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vLast = 0;\\r\\n            }\\r\\n            context.trace(vFirst + \\\", \\\" + vLast);\\r\\n\\r\\n            // Run the counter if vFirst is greater than the trigger value\\r\\n            if (vFirst >= intRunTime) {\\r\\n                falloutCounter += 1;\\r\\n            }\\r\\n\\r\\n            // write to log when last value is greater than/equal to trigger\\r\\n            // AND first value is less than trigger\\r\\n            if (vLast >= intRunTime &&  intRunTime > vFirst) {\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"DESC Write to DB\\\" + strNotes);\\r\\n\\r\\n                //Update the trigger counter\\r\\n                triggeredCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 0% and 5% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 0 and 5 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 0-5 pct counter\\r\\n                zero_fiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct < ((intRunTime-vLast)/intRunTime)) && (tenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 5% and 10% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 5% and 10% Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 5-10 pct counter\\r\\n                five_tenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (tenpct < ((intRunTime-vLast)/intRunTime)) && (fifteenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 10% and 15% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 10 and 15 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 10-15 pct counter\\r\\n                ten_fifteenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fifteenpct < ((intRunTime-vLast)/intRunTime)) && (twentypct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 15% and 20% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 15 and 20 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 15-20 pct counter\\r\\n                fifteen_twentyCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentypct < ((intRunTime-vLast)/intRunTime)) && (twentyfivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 20% and 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 20 and 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 20-25 pct counter\\r\\n                twenty_twentyfiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentyfivepct < ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is more than 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Over 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the over 25 pct counter\\r\\n                overTwentyFiveCounter += 1;\\r\\n\\r\\n            }\\r\\n        }\\r\\n        \\r\\n        Event event = context.createEvent(ti);\\r\\n        event.type = strTarget;\\r\\n\\r\\n        event.set(\\\"startDate\\\", ti.startDate);\\r\\n        event.set(\\\"station\\\", \\\"Shades Mill\\\");\\r\\n        event.set(\\\"Triggered\\\", triggeredCounter);\\r\\n        event.set(\\\"0005Pct\\\", zero_fiveCounter);\\r\\n        event.set(\\\"0510Pct\\\", five_tenCounter);\\r\\n        event.set(\\\"1015Pct\\\", ten_fifteenCounter);\\r\\n        event.set(\\\"1520Pct\\\", fifteen_twentyCounter);\\r\\n        event.set(\\\"2025Pct\\\", twenty_twentyfiveCounter);\\r\\n        event.set(\\\"Over25Pct\\\", overTwentyFiveCounter);\\r\\n        event.commit();\\r\\n    }\\r\\n}\",\n    \"version\" : 1,\n    \"start\" : \"2011-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",__results__\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"6063d317-e02c-4519-89e8-2b0ad5d380bc\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"UV Lamp Replacement Counters [NEW] [WATH7800]\",\n  \"description\" : \"UV Lamp Replacement Counters [NEW] [WATH7800]\",\n  \"schedule\" : \"0 4 * * *\",\n  \"lastRunMessage\" : \"e1931af3-f3e8-422a-9ac2-0ff6711f0ea7\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"#UVLAMP:WATH7800:maximum:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tagDescriptor\",\n    \"description\" : null,\n    \"startOffset\" : \"P2D\",\n    \"duration\" : \"P2D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[\\\"UVLAMP:WATH7800\\\"],\\\"tag\\\":\\\"\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Create an event type table and save data to it\\r\\ncontext.setSaveEvents(true);\\r\\nDouble intRunTime = 0;\\r\\nDouble vFirst = 0;\\r\\nDouble vLast = 0;\\r\\nDouble fivepct = 0.05;\\r\\nDouble tenpct = 0.1;\\r\\nDouble fifteenpct = 0.15;\\r\\nDouble twentypct = 0.2;\\r\\nDouble twentyfivepct = 0.25;\\r\\nString strAsset = \\\"\\\";\\r\\n//lookup table name\\r\\nString assetLookup = \\\"Lucity_Asset_Lookup\\\";\\r\\nString runtimeLookup = \\\"UV_Runtime_Trigger_Lookup\\\";\\r\\nString stationLookup = \\\"UV_Lamp_Station_Lookup\\\";\\r\\n//target table name\\r\\nString strTarget = \\\"UVLampCounters\\\";\\r\\nString myTag = \\\"\\\";\\r\\nString strNotes = \\\"\\\";\\r\\nString strStartDate = \\\"\\\";\\r\\nString station = \\\"\\\";\\r\\n\\r\\n//loop through tags in descriptor\\r\\nfor(Data ti : __source__.tags) {\\r\\n\\t//fill gaps\\r\\n    ti.fillGaps(\\\"P1D\\\",0,0);\\r\\n    myTag = ti.tagName;\\r\\n    context.trace(myTag);\\r\\n   \\r\\n    //get runtime trigger from lookup table\\r\\n    intRunTime = context.lookup(runtimeLookup, myTag);\\r\\n    //get asset from lookup table\\r\\n    strAsset = context.lookup(assetLookup, myTag);\\r\\n    //get station from lookup table\\r\\n    station = context.lookup(stationLookup, myTag);\\r\\n    \\r\\n\\tcontext.trace(intRunTime + \\\", \\\" + strAsset + \\\", \\\" + station);\\r\\n    \\r\\n    if (station == \\\"G4\\\") {\\r\\n        \\r\\n        Integer falloutCounter = 0;\\r\\n        Integer triggeredCounter = 0;\\r\\n        Integer zero_fiveCounter = 0;\\r\\n        Integer five_tenCounter = 0;\\r\\n        Integer ten_fifteenCounter = 0;\\r\\n        Integer fifteen_twentyCounter = 0;\\r\\n        Integer twenty_twentyfiveCounter = 0;\\r\\n        Integer overTwentyFiveCounter = 0;\\r\\n        \\r\\n    \\t//loop through the array for each tag in the descriptor\\r\\n    \\r\\n        for (Integer i=0; i < ti.array.size-1; i++) {\\r\\n\\r\\n            strStartDate = ti.array[i].time;\\r\\n            if (ti.array[i].quality !=0) {\\r\\n                vFirst = ti.array[i].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vFirst = 0;\\r\\n            }\\r\\n\\r\\n            if (ti.array[i+1].quality !=0) {\\r\\n                vLast = ti.array[i+1].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vLast = 0;\\r\\n            }\\r\\n            context.trace(vFirst + \\\", \\\" + vLast);\\r\\n\\r\\n            // Run the counter if vFirst is greater than the trigger value\\r\\n            if (vFirst >= intRunTime) {\\r\\n                falloutCounter += 1;\\r\\n            }\\r\\n\\r\\n            // write to log when last value is greater than/equal to trigger\\r\\n            // AND first value is less than trigger\\r\\n            if (vLast >= intRunTime &&  intRunTime > vFirst) {\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"DESC Write to DB\\\" + strNotes);\\r\\n\\r\\n                //Update the trigger counter\\r\\n                triggeredCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 0% and 5% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 0 and 5 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 0-5 pct counter\\r\\n                zero_fiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct < ((intRunTime-vLast)/intRunTime)) && (tenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 5% and 10% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 5% and 10% Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 5-10 pct counter\\r\\n                five_tenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (tenpct < ((intRunTime-vLast)/intRunTime)) && (fifteenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 10% and 15% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 10 and 15 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 10-15 pct counter\\r\\n                ten_fifteenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fifteenpct < ((intRunTime-vLast)/intRunTime)) && (twentypct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 15% and 20% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 15 and 20 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 15-20 pct counter\\r\\n                fifteen_twentyCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentypct < ((intRunTime-vLast)/intRunTime)) && (twentyfivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 20% and 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 20 and 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 20-25 pct counter\\r\\n                twenty_twentyfiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentyfivepct < ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is more than 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Over 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the over 25 pct counter\\r\\n                overTwentyFiveCounter += 1;\\r\\n\\r\\n            }\\r\\n        }\\r\\n        \\r\\n        Event event = context.createEvent(ti);\\r\\n        event.type = strTarget;\\r\\n\\r\\n        event.set(\\\"startDate\\\", ti.startDate);\\r\\n        event.set(\\\"station\\\", \\\"G4\\\");\\r\\n        event.set(\\\"Triggered\\\", triggeredCounter);\\r\\n        event.set(\\\"0005Pct\\\", zero_fiveCounter);\\r\\n        event.set(\\\"0510Pct\\\", five_tenCounter);\\r\\n        event.set(\\\"1015Pct\\\", ten_fifteenCounter);\\r\\n        event.set(\\\"1520Pct\\\", fifteen_twentyCounter);\\r\\n        event.set(\\\"2025Pct\\\", twenty_twentyfiveCounter);\\r\\n        event.set(\\\"Over25Pct\\\", overTwentyFiveCounter);\\r\\n        event.commit();\\r\\n    }  \\r\\n}\",\n    \"version\" : 1,\n    \"start\" : \"2011-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",__results__\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"e1931af3-f3e8-422a-9ac2-0ff6711f0ea7\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"UV Lamp Replacement Counters [NEW] [WATH8800 Greenbrook]\",\n  \"description\" : \"UV Lamp Replacement Counters [NEW] [WATH8800 Greenbrook]\",\n  \"schedule\" : \"30 4 * * *\",\n  \"lastRunMessage\" : \"3bb59b88-6d73-426f-a84e-afaa3e84a0db\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"#UVLAMP:WATH8800GB:maximum:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tagDescriptor\",\n    \"description\" : null,\n    \"startOffset\" : \"P2D\",\n    \"duration\" : \"P2D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[\\\"UVLAMP:WATH8800GB\\\"],\\\"tag\\\":\\\"\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Create an event type table and save data to it\\r\\ncontext.setSaveEvents(true);\\r\\nDouble intRunTime = 0;\\r\\nDouble vFirst = 0;\\r\\nDouble vLast = 0;\\r\\nDouble fivepct = 0.05;\\r\\nDouble tenpct = 0.1;\\r\\nDouble fifteenpct = 0.15;\\r\\nDouble twentypct = 0.2;\\r\\nDouble twentyfivepct = 0.25;\\r\\nString strAsset = \\\"\\\";\\r\\n//lookup table name\\r\\nString assetLookup = \\\"Lucity_Asset_Lookup\\\";\\r\\nString runtimeLookup = \\\"UV_Runtime_Trigger_Lookup\\\";\\r\\nString stationLookup = \\\"UV_Lamp_Station_Lookup\\\";\\r\\n//target table name\\r\\nString strTarget = \\\"UVLampCounters\\\";\\r\\nString myTag = \\\"\\\";\\r\\nString strNotes = \\\"\\\";\\r\\nString strStartDate = \\\"\\\";\\r\\nString station = \\\"\\\";\\r\\n\\r\\n//loop through tags in descriptor\\r\\nfor(Data ti : __source__.tags) {\\r\\n\\t//fill gaps\\r\\n    ti.fillGaps(\\\"P1D\\\",0,0);\\r\\n    myTag = ti.tagName;\\r\\n    context.trace(myTag);\\r\\n   \\r\\n    //get runtime trigger from lookup table\\r\\n    intRunTime = context.lookup(runtimeLookup, myTag);\\r\\n    //get asset from lookup table\\r\\n    strAsset = context.lookup(assetLookup, myTag);\\r\\n    //get station from lookup table\\r\\n    station = context.lookup(stationLookup, myTag);\\r\\n    \\r\\n\\tcontext.trace(intRunTime + \\\", \\\" + strAsset + \\\", \\\" + station);\\r\\n    \\r\\n    if (station == \\\"Greenbrook\\\") {\\r\\n        \\r\\n        Integer falloutCounter = 0;\\r\\n        Integer triggeredCounter = 0;\\r\\n        Integer zero_fiveCounter = 0;\\r\\n        Integer five_tenCounter = 0;\\r\\n        Integer ten_fifteenCounter = 0;\\r\\n        Integer fifteen_twentyCounter = 0;\\r\\n        Integer twenty_twentyfiveCounter = 0;\\r\\n        Integer overTwentyFiveCounter = 0;\\r\\n        \\r\\n    \\t//loop through the array for each tag in the descriptor\\r\\n    \\r\\n        for (Integer i=0; i < ti.array.size-1; i++) {\\r\\n\\r\\n            strStartDate = ti.array[i].time;\\r\\n            if (ti.array[i].quality !=0) {\\r\\n                vFirst = ti.array[i].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vFirst = 0;\\r\\n            }\\r\\n\\r\\n            if (ti.array[i+1].quality !=0) {\\r\\n                vLast = ti.array[i+1].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vLast = 0;\\r\\n            }\\r\\n            context.trace(vFirst + \\\", \\\" + vLast);\\r\\n\\r\\n            // Run the counter if vFirst is greater than the trigger value\\r\\n            if (vFirst >= intRunTime) {\\r\\n                falloutCounter += 1;\\r\\n            }\\r\\n\\r\\n            // write to log when last value is greater than/equal to trigger\\r\\n            // AND first value is less than trigger\\r\\n            if (vLast >= intRunTime &&  intRunTime > vFirst) {\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"DESC Write to DB\\\" + strNotes);\\r\\n\\r\\n                //Update the trigger counter\\r\\n                triggeredCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 0% and 5% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 0 and 5 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 0-5 pct counter\\r\\n                zero_fiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct < ((intRunTime-vLast)/intRunTime)) && (tenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 5% and 10% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 5% and 10% Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 5-10 pct counter\\r\\n                five_tenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (tenpct < ((intRunTime-vLast)/intRunTime)) && (fifteenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 10% and 15% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 10 and 15 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 10-15 pct counter\\r\\n                ten_fifteenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fifteenpct < ((intRunTime-vLast)/intRunTime)) && (twentypct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 15% and 20% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 15 and 20 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 15-20 pct counter\\r\\n                fifteen_twentyCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentypct < ((intRunTime-vLast)/intRunTime)) && (twentyfivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 20% and 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 20 and 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 20-25 pct counter\\r\\n                twenty_twentyfiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentyfivepct < ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is more than 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Over 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the over 25 pct counter\\r\\n                overTwentyFiveCounter += 1;\\r\\n\\r\\n            }\\r\\n        }\\r\\n        \\r\\n        Event event = context.createEvent(ti);\\r\\n        event.type = strTarget;\\r\\n\\r\\n        event.set(\\\"startDate\\\", ti.startDate);\\r\\n        event.set(\\\"station\\\", \\\"Greenbrook\\\");\\r\\n        event.set(\\\"Triggered\\\", triggeredCounter);\\r\\n        event.set(\\\"0005Pct\\\", zero_fiveCounter);\\r\\n        event.set(\\\"0510Pct\\\", five_tenCounter);\\r\\n        event.set(\\\"1015Pct\\\", ten_fifteenCounter);\\r\\n        event.set(\\\"1520Pct\\\", fifteen_twentyCounter);\\r\\n        event.set(\\\"2025Pct\\\", twenty_twentyfiveCounter);\\r\\n        event.set(\\\"Over25Pct\\\", overTwentyFiveCounter);\\r\\n        event.commit();\\r\\n    }\\r\\n}\",\n    \"version\" : 1,\n    \"start\" : \"2011-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",__results__\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"3bb59b88-6d73-426f-a84e-afaa3e84a0db\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"UV Lamp Replacement Counters [NEW] [WATH8800 Middleton]\",\n  \"description\" : \"UV Lamp Replacement Counters [NEW] [WATH8800 Middleton]\",\n  \"schedule\" : \"45 4 * * *\",\n  \"lastRunMessage\" : \"3d26ae0c-7990-4565-8785-f982488e29d9\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"#UVLAMP:WATH8800:maximum:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tagDescriptor\",\n    \"description\" : null,\n    \"startOffset\" : \"P2D\",\n    \"duration\" : \"P2D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[\\\"UVLAMP:WATH8800\\\"],\\\"tag\\\":\\\"\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Create an event type table and save data to it\\r\\ncontext.setSaveEvents(true);\\r\\nDouble intRunTime = 0;\\r\\nDouble vFirst = 0;\\r\\nDouble vLast = 0;\\r\\nDouble fivepct = 0.05;\\r\\nDouble tenpct = 0.1;\\r\\nDouble fifteenpct = 0.15;\\r\\nDouble twentypct = 0.2;\\r\\nDouble twentyfivepct = 0.25;\\r\\nString strAsset = \\\"\\\";\\r\\n//lookup table name\\r\\nString assetLookup = \\\"Lucity_Asset_Lookup\\\";\\r\\nString runtimeLookup = \\\"UV_Runtime_Trigger_Lookup\\\";\\r\\nString stationLookup = \\\"UV_Lamp_Station_Lookup\\\";\\r\\n//target table name\\r\\nString strTarget = \\\"UVLampCounters\\\";\\r\\nString myTag = \\\"\\\";\\r\\nString strNotes = \\\"\\\";\\r\\nString strStartDate = \\\"\\\";\\r\\nString station = \\\"\\\";\\r\\n\\r\\n//loop through tags in descriptor\\r\\nfor(Data ti : __source__.tags) {\\r\\n\\t//fill gaps\\r\\n    ti.fillGaps(\\\"P1D\\\",0,0);\\r\\n    myTag = ti.tagName;\\r\\n    context.trace(myTag);\\r\\n   \\r\\n    //get runtime trigger from lookup table\\r\\n    intRunTime = context.lookup(runtimeLookup, myTag);\\r\\n    //get asset from lookup table\\r\\n    strAsset = context.lookup(assetLookup, myTag);\\r\\n    //get station from lookup table\\r\\n    station = context.lookup(stationLookup, myTag);\\r\\n    \\r\\n\\tcontext.trace(intRunTime + \\\", \\\" + strAsset + \\\", \\\" + station);\\r\\n    \\r\\n    if (station == \\\"Middleton\\\") {\\r\\n        \\r\\n        Integer falloutCounter = 0;\\r\\n        Integer triggeredCounter = 0;\\r\\n        Integer zero_fiveCounter = 0;\\r\\n        Integer five_tenCounter = 0;\\r\\n        Integer ten_fifteenCounter = 0;\\r\\n        Integer fifteen_twentyCounter = 0;\\r\\n        Integer twenty_twentyfiveCounter = 0;\\r\\n        Integer overTwentyFiveCounter = 0;\\r\\n        \\r\\n    \\t//loop through the array for each tag in the descriptor\\r\\n    \\r\\n        for (Integer i=0; i < ti.array.size-1; i++) {\\r\\n\\r\\n            strStartDate = ti.array[i].time;\\r\\n            if (ti.array[i].quality !=0) {\\r\\n                vFirst = ti.array[i].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vFirst = 0;\\r\\n            }\\r\\n\\r\\n            if (ti.array[i+1].quality !=0) {\\r\\n                vLast = ti.array[i+1].value.setScale(0, RoundingMode.HALF_UP);\\r\\n            } else {\\r\\n                vLast = 0;\\r\\n            }\\r\\n            context.trace(vFirst + \\\", \\\" + vLast);\\r\\n\\r\\n            // Run the counter if vFirst is greater than the trigger value\\r\\n            if (vFirst >= intRunTime) {\\r\\n                falloutCounter += 1;\\r\\n            }\\r\\n\\r\\n            // write to log when last value is greater than/equal to trigger\\r\\n            // AND first value is less than trigger\\r\\n            if (vLast >= intRunTime &&  intRunTime > vFirst) {\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"DESC Write to DB\\\" + strNotes);\\r\\n\\r\\n                //Update the trigger counter\\r\\n                triggeredCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 0% and 5% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 0 and 5 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 0-5 pct counter\\r\\n                zero_fiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct < ((intRunTime-vLast)/intRunTime)) && (tenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 5% and 10% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 5% and 10% Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 5-10 pct counter\\r\\n                five_tenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (tenpct < ((intRunTime-vLast)/intRunTime)) && (fifteenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 10% and 15% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 10 and 15 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 10-15 pct counter\\r\\n                ten_fifteenCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (fifteenpct < ((intRunTime-vLast)/intRunTime)) && (twentypct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 15% and 20% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 15 and 20 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 15-20 pct counter\\r\\n                fifteen_twentyCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentypct < ((intRunTime-vLast)/intRunTime)) && (twentyfivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is between 20% and 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Between 20 and 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the 20-25 pct counter\\r\\n                twenty_twentyfiveCounter += 1;\\r\\n\\r\\n            } else if (vFirst < intRunTime &&  vLast < intRunTime && (twentyfivepct < ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n                //write to log when both values are lesser than the trigger and vLast value is more than 25% away\\r\\n                //from trigger value\\r\\n                strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n                context.trace(\\\"Over 25 % Away\\\" + strNotes);\\r\\n\\r\\n                //Update the over 25 pct counter\\r\\n                overTwentyFiveCounter += 1;\\r\\n\\r\\n            }\\r\\n        }\\r\\n        \\r\\n        Event event = context.createEvent(ti);\\r\\n        event.type = strTarget;\\r\\n\\r\\n        event.set(\\\"startDate\\\", ti.startDate);\\r\\n        event.set(\\\"station\\\", \\\"Middleton\\\");\\r\\n        event.set(\\\"Triggered\\\", triggeredCounter);\\r\\n        event.set(\\\"0005Pct\\\", zero_fiveCounter);\\r\\n        event.set(\\\"0510Pct\\\", five_tenCounter);\\r\\n        event.set(\\\"1015Pct\\\", ten_fifteenCounter);\\r\\n        event.set(\\\"1520Pct\\\", fifteen_twentyCounter);\\r\\n        event.set(\\\"2025Pct\\\", twenty_twentyfiveCounter);\\r\\n        event.set(\\\"Over25Pct\\\", overTwentyFiveCounter);\\r\\n        event.commit();\\r\\n    }\\r\\n}\",\n    \"version\" : 1,\n    \"start\" : \"2011-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",__results__\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"3d26ae0c-7990-4565-8785-f982488e29d9\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"UV Lamp Replacement Log [WATH4800]\",\n  \"description\" : \"UV Lamp Replacement Log [WATH4800]\",\n  \"schedule\" : \"0 5 * * *\",\n  \"lastRunMessage\" : \"bf713fe9-0b60-490c-b744-8ca031608988\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"#UVLAMP:WATH4800:maximum:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tagDescriptor\",\n    \"description\" : null,\n    \"startOffset\" : \"P2D\",\n    \"duration\" : \"P2D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[\\\"UVLAMP:WATH4800\\\"],\\\"tag\\\":\\\"\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Create an event type table and save data to it\\r\\ncontext.setSaveEvents(true);\\r\\nDouble intRunTime = 0;\\r\\nDouble vFirst = 0;\\r\\nDouble vLast = 0;\\r\\nDouble fivepct = 0.05;\\r\\nDouble tenpct = 0.1;\\r\\nDouble fifteenpct = 0.15;\\r\\nDouble twentypct = 0.2;\\r\\nDouble twentyfivepct = 0.25;\\r\\nString strAsset = \\\"\\\";\\r\\n//lookup table name\\r\\nString assetLookup = \\\"Lucity_Asset_Lookup\\\";\\r\\nString runtimeLookup = \\\"UV_Runtime_Trigger_Lookup\\\";\\r\\nString stationLookup = \\\"UV_Lamp_Station_Lookup\\\";\\r\\n//target table name\\r\\nString strTarget = \\\"UVLampReplacementLog\\\";\\r\\nString myTag = \\\"\\\";\\r\\nString strNotes = \\\"\\\";\\r\\nString strStartDate = \\\"\\\";\\r\\nInteger falloutCounter = 0;\\r\\n\\r\\n//loop through tags in descriptor\\r\\nfor(Data ti : __source__.tags) {\\r\\n\\t//fill gaps\\r\\n    ti.fillGaps(\\\"P1D\\\",0,0);\\r\\n    myTag = ti.tagName;\\r\\n    context.trace(myTag);\\r\\n   \\r\\n    //get runtime trigger from lookup table\\r\\n    intRunTime = context.lookup(runtimeLookup, myTag);\\r\\n    //get asset from lookup table\\r\\n    strAsset = context.lookup(assetLookup, myTag);\\r\\n    //get station from lookup table\\r\\n    station = context.lookup(stationLookup, myTag);\\r\\n    \\r\\n\\tcontext.trace(intRunTime + \\\", \\\" + strAsset + \\\", \\\" + station);\\r\\n    \\r\\n    //loop through the array for each tag in the descriptor\\r\\n    \\r\\n    for (Integer i=0; i < ti.array.size-1; i++) {\\r\\n        context.trace(ti.array[i]);\\r\\n        strStartDate = ti.array[i].time;\\r\\n        if (ti.array[i].quality !=0) {\\r\\n            vFirst = ti.array[i].value.setScale(0, RoundingMode.HALF_UP);\\r\\n        } else {\\r\\n            vFirst = 0;\\r\\n        }\\r\\n\\r\\n        if (ti.array[i+1].quality !=0) {\\r\\n            vLast = ti.array[i+1].value.setScale(0, RoundingMode.HALF_UP);\\r\\n        } else {\\r\\n            vLast = 0;\\r\\n        }\\r\\n        \\r\\n        // Run the counter if vFirst is greater than the trigger value\\r\\n        if (intRunTime != null && intRunTime != \\\"\\\" && vFirst >= intRunTime) {\\r\\n\\r\\n            falloutCounter += 1;\\r\\n        }\\r\\n       \\r\\n        // write to log when last value is greater than/equal to trigger\\r\\n        // AND first value is less than trigger\\r\\n\\r\\n        if (intRunTime != null && intRunTime != \\\"\\\"){\\r\\n        if (vLast >= intRunTime &&  intRunTime > vFirst) {\\r\\n\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"DESC Write to DB\\\" + strNotes);\\r\\n            \\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"Triggered\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 0% and 5% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 0 and 5 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"0005Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct < ((intRunTime-vLast)/intRunTime)) && (tenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 5% and 10% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 5% and 10% Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"0510Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (tenpct < ((intRunTime-vLast)/intRunTime)) && (fifteenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 10% and 15% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 10 and 15 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"1015Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (fifteenpct < ((intRunTime-vLast)/intRunTime)) && (twentypct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 15% and 20% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 15 and 20 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"1520Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (twentypct < ((intRunTime-vLast)/intRunTime)) && (twentyfivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 20% and 25% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 20 and 25 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"2025Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (twentyfivepct < ((intRunTime-vLast)/intRunTime))) {\\r\\n\\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is more than 25% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Over 25 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"Over25Away\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t}\\r\\n        }\\r\\n    } \\r\\n}\\r\\n\\r\\ncontext.trace(falloutCounter);\",\n    \"version\" : 1,\n    \"start\" : \"2011-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : false\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"bf713fe9-0b60-490c-b744-8ca031608988\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"dependant\":[],\"id\":\"10bb7819-cab0-4d2f-b572-b9230add36e7\",\"source\":\"UV Lamp Replacement Log [WATH4800]\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"UV Lamp Replacement Log [WATH7800]\",\n  \"description\" : \"UV Lamp Replacement Log [WATH7800]\",\n  \"schedule\" : \"30 5 * * *\",\n  \"lastRunMessage\" : \"b04ad390-eccb-407c-ab26-fdfbf55d17f5\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"#UVLAMP:WATH7800:maximum:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tagDescriptor\",\n    \"description\" : null,\n    \"startOffset\" : \"P2D\",\n    \"duration\" : \"P2D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[\\\"UVLAMP:WATH7800\\\"],\\\"tag\\\":\\\"\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Create an event type table and save data to it\\r\\ncontext.setSaveEvents(true);\\r\\nDouble intRunTime = 0;\\r\\nDouble vFirst = 0;\\r\\nDouble vLast = 0;\\r\\nDouble fivepct = 0.05;\\r\\nDouble tenpct = 0.1;\\r\\nDouble fifteenpct = 0.15;\\r\\nDouble twentypct = 0.2;\\r\\nDouble twentyfivepct = 0.25;\\r\\nString strAsset = \\\"\\\";\\r\\n//lookup table name\\r\\nString assetLookup = \\\"Lucity_Asset_Lookup\\\";\\r\\nString runtimeLookup = \\\"UV_Runtime_Trigger_Lookup\\\";\\r\\nString stationLookup = \\\"UV_Lamp_Station_Lookup\\\";\\r\\n//target table name\\r\\nString strTarget = \\\"UVLampReplacementLog\\\";\\r\\nString myTag = \\\"\\\";\\r\\nString strNotes = \\\"\\\";\\r\\nString strStartDate = \\\"\\\";\\r\\nInteger falloutCounter = 0;\\r\\n\\r\\n//loop through tags in descriptor\\r\\nfor(Data ti : __source__.tags) {\\r\\n\\t//fill gaps\\r\\n    ti.fillGaps(\\\"P1D\\\",0,0);\\r\\n    myTag = ti.tagName;\\r\\n    context.trace(myTag);\\r\\n   \\r\\n    //get runtime trigger from lookup table\\r\\n    intRunTime = context.lookup(runtimeLookup, myTag);\\r\\n    //get asset from lookup table\\r\\n    strAsset = context.lookup(assetLookup, myTag);\\r\\n    //get station from lookup table\\r\\n    station = context.lookup(stationLookup, myTag);\\r\\n    \\r\\n\\tcontext.trace(intRunTime + \\\", \\\" + strAsset + \\\", \\\" + station);\\r\\n    \\r\\n    //loop through the array for each tag in the descriptor\\r\\n    \\r\\n    for (Integer i=0; i < ti.array.size-1; i++) {\\r\\n        context.trace(ti.array[i]);\\r\\n        strStartDate = ti.array[i].time;\\r\\n        if (ti.array[i].quality !=0) {\\r\\n            vFirst = ti.array[i].value.setScale(0, RoundingMode.HALF_UP);\\r\\n        } else {\\r\\n            vFirst = 0;\\r\\n        }\\r\\n\\r\\n        if (ti.array[i+1].quality !=0) {\\r\\n            vLast = ti.array[i+1].value.setScale(0, RoundingMode.HALF_UP);\\r\\n        } else {\\r\\n            vLast = 0;\\r\\n        }\\r\\n        \\r\\n        // Run the counter if vFirst is greater than the trigger value\\r\\n        if (vFirst >= intRunTime) {\\r\\n            falloutCounter += 1;\\r\\n        }\\r\\n       \\r\\n        // write to log when last value is greater than/equal to trigger\\r\\n        // AND first value is less than trigger\\r\\n    \\tif (vLast >= intRunTime &&  intRunTime > vFirst) {\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"DESC Write to DB\\\" + strNotes);\\r\\n            \\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"Triggered\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 0% and 5% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 0 and 5 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"0005Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct < ((intRunTime-vLast)/intRunTime)) && (tenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 5% and 10% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 5% and 10% Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"0510Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (tenpct < ((intRunTime-vLast)/intRunTime)) && (fifteenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 10% and 15% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 10 and 15 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"1015Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (fifteenpct < ((intRunTime-vLast)/intRunTime)) && (twentypct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 15% and 20% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 15 and 20 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"1520Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (twentypct < ((intRunTime-vLast)/intRunTime)) && (twentyfivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 20% and 25% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 20 and 25 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"2025Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (twentyfivepct < ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is more than 25% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Over 25 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"Over25Away\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t}\\r\\n    } \\r\\n}\\r\\n\\r\\ncontext.trace(falloutCounter);\",\n    \"version\" : 1,\n    \"start\" : \"2011-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",__results__\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"b04ad390-eccb-407c-ab26-fdfbf55d17f5\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"UV Lamp Replacement Log [WATH8800 Greenbrook]\",\n  \"description\" : \"UV Lamp Replacement Log [WATH8800 Greenbrook]\",\n  \"schedule\" : \"15 5 * * *\",\n  \"lastRunMessage\" : \"af5e4f1a-7fdc-4b62-aaca-bf68877c2d2d\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"#UVLAMP:WATH8800GB:maximum:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tagDescriptor\",\n    \"description\" : null,\n    \"startOffset\" : \"P2D\",\n    \"duration\" : \"P2D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[\\\"UVLAMP:WATH8800GB\\\"],\\\"tag\\\":\\\"\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Create an event type table and save data to it\\r\\ncontext.setSaveEvents(true);\\r\\nDouble intRunTime = 0;\\r\\nDouble vFirst = 0;\\r\\nDouble vLast = 0;\\r\\nDouble fivepct = 0.05;\\r\\nDouble tenpct = 0.1;\\r\\nDouble fifteenpct = 0.15;\\r\\nDouble twentypct = 0.2;\\r\\nDouble twentyfivepct = 0.25;\\r\\nString strAsset = \\\"\\\";\\r\\n//lookup table name\\r\\nString assetLookup = \\\"Lucity_Asset_Lookup\\\";\\r\\nString runtimeLookup = \\\"UV_Runtime_Trigger_Lookup\\\";\\r\\nString stationLookup = \\\"UV_Lamp_Station_Lookup\\\";\\r\\n//target table name\\r\\nString strTarget = \\\"UVLampReplacementLog\\\";\\r\\nString myTag = \\\"\\\";\\r\\nString strNotes = \\\"\\\";\\r\\nString strStartDate = \\\"\\\";\\r\\nInteger falloutCounter = 0;\\r\\n\\r\\n//loop through tags in descriptor\\r\\nfor(Data ti : __source__.tags) {\\r\\n\\t//fill gaps\\r\\n    ti.fillGaps(\\\"P1D\\\",0,0);\\r\\n    myTag = ti.tagName;\\r\\n    context.trace(myTag);\\r\\n   \\r\\n    //get runtime trigger from lookup table\\r\\n    intRunTime = context.lookup(runtimeLookup, myTag);\\r\\n    //get asset from lookup table\\r\\n    strAsset = context.lookup(assetLookup, myTag);\\r\\n    //get station from lookup table\\r\\n    station = context.lookup(stationLookup, myTag);\\r\\n    \\r\\n\\tcontext.trace(intRunTime + \\\", \\\" + strAsset + \\\", \\\" + station);\\r\\n    \\r\\n    //loop through the array for each tag in the descriptor\\r\\n    \\r\\n    for (Integer i=0; i < ti.array.size-1; i++) {\\r\\n        context.trace(ti.array[i]);\\r\\n        strStartDate = ti.array[i].time;\\r\\n        if (ti.array[i].quality !=0) {\\r\\n            vFirst = ti.array[i].value.setScale(0, RoundingMode.HALF_UP);\\r\\n        } else {\\r\\n            vFirst = 0;\\r\\n        }\\r\\n\\r\\n        if (ti.array[i+1].quality !=0) {\\r\\n            vLast = ti.array[i+1].value.setScale(0, RoundingMode.HALF_UP);\\r\\n        } else {\\r\\n            vLast = 0;\\r\\n        }\\r\\n        \\r\\n        // Run the counter if vFirst is greater than the trigger value\\r\\n        if (vFirst >= intRunTime) {\\r\\n            falloutCounter += 1;\\r\\n        }\\r\\n       \\r\\n        // write to log when last value is greater than/equal to trigger\\r\\n        // AND first value is less than trigger\\r\\n    \\tif (vLast >= intRunTime &&  intRunTime > vFirst) {\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"DESC Write to DB\\\" + strNotes);\\r\\n            \\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"Triggered\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 0% and 5% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 0 and 5 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"0005Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct < ((intRunTime-vLast)/intRunTime)) && (tenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 5% and 10% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 5% and 10% Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"0510Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (tenpct < ((intRunTime-vLast)/intRunTime)) && (fifteenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 10% and 15% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 10 and 15 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"1015Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (fifteenpct < ((intRunTime-vLast)/intRunTime)) && (twentypct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 15% and 20% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 15 and 20 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"1520Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (twentypct < ((intRunTime-vLast)/intRunTime)) && (twentyfivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 20% and 25% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 20 and 25 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"2025Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (twentyfivepct < ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is more than 25% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Over 25 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"Over25Away\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t}\\r\\n    } \\r\\n}\\r\\n\\r\\ncontext.trace(falloutCounter);\",\n    \"version\" : 1,\n    \"start\" : \"2021-06-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",__results__\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"af5e4f1a-7fdc-4b62-aaca-bf68877c2d2d\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"UV Lamp Replacement Log [WATH8800 Middleton]\",\n  \"description\" : \"UV Lamp Replacement Log [WATH8800 Middleton]\",\n  \"schedule\" : \"45 5 * * *\",\n  \"lastRunMessage\" : \"7e8e3676-cc5c-411b-a832-e8511654c698\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"#UVLAMP:WATH8800:maximum:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tagDescriptor\",\n    \"description\" : null,\n    \"startOffset\" : \"P2D\",\n    \"duration\" : \"P2D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[\\\"UVLAMP:WATH8800\\\"],\\\"tag\\\":\\\"\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Create an event type table and save data to it\\r\\ncontext.setSaveEvents(true);\\r\\nDouble intRunTime = 0;\\r\\nDouble vFirst = 0;\\r\\nDouble vLast = 0;\\r\\nDouble fivepct = 0.05;\\r\\nDouble tenpct = 0.1;\\r\\nDouble fifteenpct = 0.15;\\r\\nDouble twentypct = 0.2;\\r\\nDouble twentyfivepct = 0.25;\\r\\nString strAsset = \\\"\\\";\\r\\n//lookup table name\\r\\nString assetLookup = \\\"Lucity_Asset_Lookup\\\";\\r\\nString runtimeLookup = \\\"UV_Runtime_Trigger_Lookup\\\";\\r\\nString stationLookup = \\\"UV_Lamp_Station_Lookup\\\";\\r\\n//target table name\\r\\nString strTarget = \\\"UVLampReplacementLog\\\";\\r\\nString myTag = \\\"\\\";\\r\\nString strNotes = \\\"\\\";\\r\\nString strStartDate = \\\"\\\";\\r\\nInteger falloutCounter = 0;\\r\\n\\r\\n//loop through tags in descriptor\\r\\nfor(Data ti : __source__.tags) {\\r\\n\\t//fill gaps\\r\\n    ti.fillGaps(\\\"P1D\\\",0,0);\\r\\n    myTag = ti.tagName;\\r\\n    context.trace(myTag);\\r\\n   \\r\\n    //get runtime trigger from lookup table\\r\\n    intRunTime = context.lookup(runtimeLookup, myTag);\\r\\n    //get asset from lookup table\\r\\n    strAsset = context.lookup(assetLookup, myTag);\\r\\n    //get station from lookup table\\r\\n    station = context.lookup(stationLookup, myTag);\\r\\n    \\r\\n\\tcontext.trace(intRunTime + \\\", \\\" + strAsset + \\\", \\\" + station);\\r\\n    \\r\\n    //loop through the array for each tag in the descriptor\\r\\n    \\r\\n    for (Integer i=0; i < ti.array.size-1; i++) {\\r\\n        context.trace(ti.array[i]);\\r\\n        strStartDate = ti.array[i].time;\\r\\n        if (ti.array[i].quality !=0) {\\r\\n            vFirst = ti.array[i].value.setScale(0, RoundingMode.HALF_UP);\\r\\n        } else {\\r\\n            vFirst = 0;\\r\\n        }\\r\\n\\r\\n        if (ti.array[i+1].quality !=0) {\\r\\n            vLast = ti.array[i+1].value.setScale(0, RoundingMode.HALF_UP);\\r\\n        } else {\\r\\n            vLast = 0;\\r\\n        }\\r\\n        \\r\\n        // Run the counter if vFirst is greater than the trigger value\\r\\n        if (vFirst >= intRunTime) {\\r\\n            falloutCounter += 1;\\r\\n        }\\r\\n       \\r\\n        // write to log when last value is greater than/equal to trigger\\r\\n        // AND first value is less than trigger\\r\\n    \\tif (vLast >= intRunTime &&  intRunTime > vFirst) {\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"DESC Write to DB\\\" + strNotes);\\r\\n            \\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"Triggered\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 0% and 5% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 0 and 5 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"0005Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (fivepct < ((intRunTime-vLast)/intRunTime)) && (tenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 5% and 10% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 5% and 10% Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"0510Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (tenpct < ((intRunTime-vLast)/intRunTime)) && (fifteenpct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 10% and 15% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 10 and 15 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"1015Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (fifteenpct < ((intRunTime-vLast)/intRunTime)) && (twentypct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 15% and 20% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 15 and 20 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"1520Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (twentypct < ((intRunTime-vLast)/intRunTime)) && (twentyfivepct >= ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is between 20% and 25% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Between 20 and 25 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"2025Pct\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t} else if (vFirst < intRunTime &&  vLast < intRunTime && (twentyfivepct < ((intRunTime-vLast)/intRunTime))) {\\r\\n        \\r\\n        \\t//write to log when both values are lesser than the trigger and vLast value is more than 25% away\\r\\n        \\t//from trigger value\\r\\n        \\tstrNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\", \\\" + \\\"Start Date = \\\" + strStartDate;\\r\\n       \\t\\tcontext.trace(\\\"Over 25 % Away\\\" + strNotes);\\r\\n        \\t\\r\\n            //Create an event\\r\\n    \\t\\tEvent event = context.createEvent(ti.array[i]);\\r\\n    \\t\\tevent.type = strTarget;\\r\\n        \\r\\n        \\t//write EventData to EvenType = strTarget\\r\\n            event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        \\tevent.set(\\\"TagName\\\", myTag);\\r\\n        \\tevent.set(\\\"Station\\\", station);\\r\\n        \\tevent.set(\\\"CurrentValue\\\", vLast);\\r\\n        \\tevent.set(\\\"TriggerValue\\\", intRunTime);\\r\\n            event.set(\\\"Asset\\\", strAsset);\\r\\n            event.set(\\\"StartDate\\\", strStartDate);\\r\\n            event.set(\\\"isProcessed\\\", 0);\\r\\n            event.set(\\\"Over25Away\\\", \\\"yes\\\");\\r\\n        \\tevent.commit();\\t\\r\\n    \\t}\\r\\n    } \\r\\n}\\r\\n\\r\\ncontext.trace(falloutCounter);\",\n    \"version\" : 1,\n    \"start\" : \"2011-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",__results__\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"7e8e3676-cc5c-411b-a832-e8511654c698\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"UV Monitor Rule By Descriptor\",\n  \"description\" : \"UV Monitor write record to database when the runtime is greater than trigger value\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"06750b26-0ed7-4b14-a882-01fe4160d031\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"#UVLAMP:WATH4800:maximum:P1D,#UVLAMP:WATH8800GB:maximum:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tagDescriptor\",\n    \"description\" : null,\n    \"startOffset\" : \"P2D\",\n    \"duration\" : \"P2D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[\\\"UVLAMP:WATH4800\\\",\\\"UVLAMP:WATH8800GB\\\"],\\\"tag\\\":\\\"\\\",\\\"mode\\\":\\\"maximum\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//context.setSaveEvents(true);\\r\\nInteger intRunTime = 0;\\r\\nBigDecimal vFirst = 0;\\r\\nBigDecimal vLast = 0;\\r\\nString strAsset=\\\"\\\";\\r\\n//lookup table name\\r\\nString assetLookup = \\\"Lucity_Asset_Lookup\\\";\\r\\nString runtimeLookup = \\\"UV_Runtime_Trigger_Lookup\\\";\\r\\nString stationLookup = \\\"UV_Lamp_Station_Lookup\\\";\\r\\n//target table name\\r\\nString strTarget = \\\"UVLampLog\\\";\\r\\nString myTag = \\\"\\\";\\r\\nString strNotes=\\\"\\\";\\r\\nString strStartDate=\\\"\\\";\\r\\nString strType = \\\"ElectricalUV\\\";\\r\\nString strPriority = \\\"medium\\\";\\r\\n\\r\\nfor(Data ti : __source__.tags){\\r\\n    //loop through tags in descriptor\\r\\n\\t//shift source to get the correct start date\\r\\n\\tTagInput inTag1 = ti.clone.offsetDates(\\\"P0D\\\",\\\"P1D\\\");\\r\\n\\tstrStartDate = inTag1.end;\\r\\n\\r\\n    ti.fillGaps(\\\"P1D\\\",0,0);\\r\\n    myTag = ti.tagName;\\r\\n    context.trace(strStartDate + \\\", \\\" + myTag);\\r\\n   \\r\\n    //get the date next to the Start Date\\r\\n    //get runtime trigger from lookup table\\r\\n    intRunTime = context.lookup(runtimeLookup , myTag);\\r\\n    //get asset from lookup table\\r\\n    strAsset = context.lookup(assetLookup , myTag);\\r\\n    //get station from lookup table\\r\\n    station = context.lookup(stationLookup, myTag);\\r\\n    \\r\\n\\tcontext.trace(intRunTime + \\\", \\\" + strAsset + \\\", \\\" + station);\\r\\n    for (Data tagValue : ti.asc){\\r\\n        if (ti.array[0].quality !=0){\\r\\n    \\t\\tvFirst =  ti.array[0].value.setScale(0, RoundingMode.HALF_UP);\\r\\n        } else \\r\\n        { vFirst = 0;\\r\\n        }\\r\\n\\r\\n         if (ti.array[1].quality !=0){\\r\\n       \\t\\tvLast =  ti.array[1].value.setScale(0, RoundingMode.HALF_UP);\\r\\n         } else {\\r\\n                 vLast = 0;\\r\\n         }\\r\\n    \\r\\n    }\\r\\n\\tcontext.trace(vFirst + \\\", \\\" + vLast);\\r\\n    // write to log when last value is greater than/equal to trigger\\r\\n    // AND first value is less than trigger\\r\\n    if (vLast >= intRunTime &&  intRunTime > vFirst ){\\r\\n        strNotes = \\\"Tag name = \\\" + myTag + \\\", \\\" + \\\"Current value = \\\" + vLast + \\\", \\\" + \\\"Trigger value = \\\" + intRunTime + \\\".\\\"; ;\\r\\n        Event event = context.createEvent(inTag1);\\r\\n       \\tcontext.trace(\\\"DESC Write to DB\\\" + strNotes);\\r\\n        /*\\r\\n        //write to EventData as EvenType = strTarget\\r\\n        event.type = strTarget;\\r\\n        event.set(\\\"Type\\\", \\\"Electrical:UV\\\");\\r\\n        event.set(\\\"Priority\\\", \\\"medium\\\");\\r\\n        event.set(\\\"Asset\\\", strAsset);\\r\\n        event.set(\\\"Notes\\\", strNotes);\\r\\n        event.set(\\\"StartDate\\\", strStartDate);\\r\\n        event.set(\\\"isProcessed\\\", 0);\\r\\n        event.commit();\\r\\n        //write to UVLampLog table\\r\\n        event.type = strTarget;\\r\\n        event.set(\\\"UVLog.UVLampLog.type\\\", strType);\\r\\n        event.set(\\\"UVLog.UVLampLog.priority\\\", strPriority);\\r\\n        event.set(\\\"UVLog.UVLampLog.station\\\", station);\\r\\n        event.set(\\\"UVLog.UVLampLog.tag\\\", myTag);\\r\\n        event.set(\\\"UVLog.UVLampLog.asset\\\", strAsset);\\r\\n        event.set(\\\"UVLog.UVLampLog.notes\\\", strNotes);\\r\\n        event.set(\\\"UVLog.UVLampLog.startdate\\\", strStartDate);\\r\\n        event.set(\\\"UVLog.UVLampLog.isprocessed\\\", 0);\\r\\n        event.commit();*/\\r\\n        \\r\\n        // Write to Lucity_WO_LOG table\\r\\n        event.type = strTarget;\\r\\n        event.set(\\\"WOLOG.tblIntegSCADAEvents.type\\\", strType);\\r\\n        event.set(\\\"WOLOG.tblIntegSCADAEvents.priority\\\", strPriority);\\r\\n        //event.set(\\\"WOLOG.tblIntegSCADAEvents.station\\\", station);\\r\\n        //event.set(\\\"WOLOG.tblIntegSCADAEvents.tag\\\", myTag);\\r\\n        event.set(\\\"WOLOG.tblIntegSCADAEvents.asset\\\", strAsset);\\r\\n        event.set(\\\"WOLOG.tblIntegSCADAEvents.notes\\\", strNotes);\\r\\n        event.set(\\\"WOLOG.tblIntegSCADAEvents.startdate\\\", strStartDate);\\r\\n        event.set(\\\"WOLOG.tblIntegSCADAEvents.isprocessed\\\", 0);\\r\\n        event.commit();\\r\\n    }\\r\\n}\\r\\n\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2000-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"06750b26-0ed7-4b14-a882-01fe4160d031\",\n  \"owner\" : \"admin\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"1970-01-01T00:00:01.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Victoria St Flow Meter Monitored Tag Rule\",\n  \"description\" : \"Calc to look for when the flow through Vic St is below 5 L/s\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"40749daa-9b2f-4ee1-b9b3-219a5cca6683\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR3.VIVVCH01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P7D\",\n    \"duration\" : \"P7D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : true,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR3.VIVVCH01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//for (Data inTag: __source__.array){\\r\\n    // check if value is below 5 L/s\\r\\n//    if(5 > inTag.value) {\\r\\n//        inTag.addFlag(\\\"Flow below 5L/s\\\");\\r\\n//    }\\r\\n//}\\r\\n\\r\\n//Variable to store the start of the low flow\\r\\nData firstLowFlow = null;\\r\\nfor (Data inTag: __source__.array){\\r\\n    // check if value is below 5 L/s\\r\\n    if(5 > inTag.value && null == firstLowFlow) {\\r\\n      //record the first low flow\\r\\n      firstLowFlow = inTag;\\r\\n    }else if(5 > inTag.value && null != firstLowFlow && \\r\\n      (inTag.timeInSeconds - firstLowFlow.timeInSeconds) >= 604800){\\r\\n        //when the flow is below 5 for 1 week then add a flag\\r\\n           inTag.addFlag(\\\"VIC\\\");\\r\\n    }else if(5 <= inTag.value){\\r\\n      //reset if flow goes above 5\\r\\n      firstLowFlow = null;\\r\\n    }\\r\\n}\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2023-11-07T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"40749daa-9b2f-4ee1-b9b3-219a5cca6683\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"1970-01-01T00:00:01.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"dependant\":[],\"id\":\"6eec8dd5-d11a-47d9-8f63-44cd2ec7be87\",\"source\":\"Victoria St Flow Meter Monitored Tag Rule\",\"sourceTaskType\":\"CALCULATION\",\"actionOnFail\":\"WAIT\",\"toField\":\"\",\"emailBody\":\"\"}","type":"TaskDependencyRegistry","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Zero Values Flagging\",\n  \"description\" : \"Adds flag if data value is equal to 0\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"ab1db791-94cf-4f72-9dad-ea4afad9be3d\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"KWCRH.KWCR_KIWK050TT.F_CV:sample:PT5S\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"//Iterate through input array\\nforeach(element:__source__.array){\\n    //If the value of an array element is equal to 0\\n    if(element.value == 0){\\n        //Set the quality of that array element to 0\\n        element.addFlag(\\\"ZERO\\\");\\n    }\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2014-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"ab1db791-94cf-4f72-9dad-ea4afad9be3d\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2014-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Wilmot_Breslau_Total\",\n  \"description\" : \"Wilmot Breslau Total Monthly Pumpage\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"6c221e83-903a-4e1e-96c4-25b51e104dd5\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"KWCRH.KWCR_KIWOL02TT.F_CV:periodTotal:P1M\",\n    \"name\" : \"Tag31\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"KWCRH.KWCR_BLMVCH1TTV01.F_CV:periodTotal:P1M\",\n    \"name\" : \"Tag33\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"KWCRH.KWCR_VIMVCH1TT.F_CV:periodTotal:P1M\",\n    \"name\" : \"Tag34\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1M\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.WIL_BRES_TOTAL\",\n    \"name\" : \"WILBRES_TOT\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"-PT0S\",\n    \"scale\" : 3\n  } ],\n  \"code\" : [ {\n    \"value\" : \"BigDecimal sum = 0;\\nif (null != Tag31.value && Tag31.quality == 100){\\n    sum = sum + Tag31.value;\\n}\\nif (null != Tag33.value && Tag33.quality == 100){\\n    sum = sum + Tag33.value;\\n}\\nif (null != Tag34.value && Tag34.quality == 100){\\n    sum = sum + Tag34.value;\\n}\\nWILBRES_TOT = sum\",\n    \"version\" : 1,\n    \"start\" : \"2015-11-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",Tag31,Tag34,Tag33\",\n    \"outputs\" : \",WILBRES_TOT\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"6c221e83-903a-4e1e-96c4-25b51e104dd5\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2016-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"DIRECT\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.WIL_BRES_TOTAL\",\"name\":\"WILBRES_TOT\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"-PT0S\",\"scale\":3}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Validated Discharge Chlorine\",\n  \"description\" : \"Validated Discharge Chlorine\",\n  \"schedule\" : \"0 2 * * *\",\n  \"lastRunMessage\" : \"ca01968b-ceff-45fe-821e-cc636fdba02d\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"SJPH.SJPSCDA.HEPCFR1AIDCP.F_CV:interpolated:PT1M\",\n    \"name\" : \"Calibration\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"SJPH.HEPOIT1.HEPCFR2AIQ01:interpolated:PT1M\",\n    \"name\" : \"DisChlor\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"SJPH.HEPOIT1.HEPTWL1FIQ01:interpolated:PT1M\",\n    \"name\" : \"DisFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.HEPCFR2AIA01\",\n    \"name\" : \"DisChlorAve\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.HEPCFR2AIH01\",\n    \"name\" : \"DisChlorMax\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.HEPCFR2AIH01\",\n    \"name\" : \"DisChlorMax\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.HEPCFR2AIN01\",\n    \"name\" : \"DisChlorMin\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Count of the Array index\\nBigDecimal Count = 0;\\n//Count of how many days there are.\\nBigDecimal ValidCount = 0;\\n//Hold Valid tag value\\nBigDecimal ValidNum = null;\\n//Total of all Valid tags values\\nBigDecimal ValidSum = 0;\\n//Maximum valid number\\nBigDecimal MaxNum = null;\\n//Minimum valid number\\nBigDecimal MinNum = null;\\n//Average valid number\\nBigDecimal AveNum = null;\\n//Loop through the values.\\nfor (ID: DisChlor.array){\\n    //Make sure that there is a number for Diacharge Chlorine\\n    if(ID.value != null){\\n        //Validate the Discharge Chlorine number by checking that there is Discharge Flow and that the Calibration is off\\n        if(DisFlow.getValue(Count) > 0 && Calibration.getValue(Count) != 1){\\n            //Holds Valid Chlorine value\\n            ValidNum = ID.Value;\\n            //Counts the number of valid chlorine values\\n            ValidCount =+ 1;\\n            //Total the number of valid chlorine values\\n            ValidSum =+ ValidNum;\\n            //Find the Maximum valid value.\\n            if (ValidNum > MaxNum || MaxNum == null){\\n                MaxNum = ValidNum;\\n            }\\n            //Find the Minimum valid value\\n            if (ValidNum < MinNum || MinNum == null){\\n                MinNum = ValidNum;\\n            }\\n        }\\n    }\\n    //Array Index Counter\\n    Count =+ 1;\\n}\\n//Calculates the Average\\nAveNum = ValidSum / ValidCount;\\n//Outputs Tags\\nDisChlorMax.value = MaxNum;\\nDisChlorMin.value = MinNum;\\nDisChlorAve.value = AveNum;\\n\",\n    \"version\" : 1,\n    \"start\" : \"2009-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",DisChlor,DisFlow,Calibration\",\n    \"outputs\" : \",DisChlorMin,DisChlorMax,DisChlorAve\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"ca01968b-ceff-45fe-821e-cc636fdba02d\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2014-08-21T02:00:00.000\",\n  \"enabled\" : false,\n  \"type\" : \"DIRECT\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.HEPCFR2AIA01\",\"name\":\"DisChlorAve\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.HEPCFR2AIH01\",\"name\":\"DisChlorMax\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.HEPCFR2AIH01\",\"name\":\"DisChlorMax\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.HEPCFR2AIN01\",\"name\":\"DisChlorMin\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Value drops flagging\",\n  \"description\" : \"Adds flag if value drops by more than 10%\",\n  \"schedule\" : \"* * * * *\",\n  \"lastRunMessage\" : \"36bbe78f-a810-4bfe-8018-d1a5f9529329\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"KWCRH.KWCR_KIWK050TT.F_CV:sample:PT30S\",\n    \"name\" : \"__source__\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"-PT0S\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ ],\n  \"code\" : [ {\n    \"value\" : \"BigDecimal prevValue=0;\\nforeach(element:__source__.array){\\n    if(0.10 < (prevValue-element.value)/element.value){\\n        element.addFlag(\\\"CHNG\\\");\\n    }\\n    prevValue = element.value;\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2014-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \"\",\n    \"outputs\" : \"\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"36bbe78f-a810-4bfe-8018-d1a5f9529329\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2014-01-01T00:00:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"RULE\"\n}","type":"Calculation","base64":null,"dependencies":[]},{"item":"{\n  \"name\" : \"Equis Well WM Site\",\n  \"description\" : \"\",\n  \"schedule\" : \"0 4 * * *\",\n  \"lastRunMessage\" : \"d77ec643-fe1f-425a-bf9b-7e5f08d36deb\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MTPH.MTPSCDA.WMHWM01RTQRN.F_CV:periodTotal:P1D\",\n    \"name\" : \"WM01\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.WMHWM02RTQRN.F_CV:periodTotal:P1D\",\n    \"name\" : \"WM02\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.WMHWM03RTQRN.F_CV:periodTotal:P1D\",\n    \"name\" : \"WM03\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.WMHWM04RTQRN.F_CV:periodTotal:P1D\",\n    \"name\" : \"WM04\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MTPH.MTPSCDA.WMHWM00TT.F_CV:periodTotal:P1D\",\n    \"name\" : \"WMFlow\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MTPSCDA.WMHWM01TT.F_CV\",\n    \"name\" : \"WM1\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 2\n  }, {\n    \"value\" : \"ET.MTPSCDA.WMHWM02TT.F_CV\",\n    \"name\" : \"WM2\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 2\n  }, {\n    \"value\" : \"ET.MTPSCDA.WMHWM03TT.F_CV\",\n    \"name\" : \"WM3\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 2\n  }, {\n    \"value\" : \"ET.MTPSCDA.WMHWM04TT.F_CV\",\n    \"name\" : \"WM4\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 2\n  } ],\n  \"code\" : [ {\n    \"value\" : \"//Define function for flow total\\ndef flowTotal(FlowIn,RT1,RT2,RT3,RT4,FlowOut){\\n    if(null != FlowIn.value && 0 != FlowIn.value){\\n        FlowOut.value = FlowIn.value * (RT1.value/(RT1.value + RT2.value + RT3.value + RT4.value));\\n    }\\n    else{\\n        FlowOut.value = 0;\\n    }\\n}\\nflowTotal(WMFlow,WM01,WM02,WM03,WM04,WM1);\\nflowTotal(WMFlow,WM02,WM01,WM03,WM04,WM2);\\nflowTotal(WMFlow,WM03,WM02,WM01,WM04,WM3);\\nflowTotal(WMFlow,WM04,WM02,WM03,WM01,WM4);\\n\",\n    \"version\" : 1,\n    \"start\" : \"2017-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",WM02,WMFlow,WM03,WM04,__results__,WM01\",\n    \"outputs\" : \",WM1,WM3,WM2,WM4\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"d77ec643-fe1f-425a-bf9b-7e5f08d36deb\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"DIRECT\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MTPSCDA.WMHWM01TT.F_CV\",\"name\":\"WM1\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":2}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MTPSCDA.WMHWM02TT.F_CV\",\"name\":\"WM2\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":2}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MTPSCDA.WMHWM03TT.F_CV\",\"name\":\"WM3\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":2}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MTPSCDA.WMHWM04TT.F_CV\",\"name\":\"WM4\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":2}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Equis Well Single sites\",\n  \"description\" : \"\",\n  \"schedule\" : \"0 4 * * *\",\n  \"lastRunMessage\" : \"8a14be1d-c778-4aa4-b801-acfb0f801a81\",\n  \"constant\" : [ \"zero\", \"one\" ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"MDPH.MDPSCDA.CBWG004FIQ01.F_CV:rawByTime:P1D\",\n    \"name\" : \"G4_G4A\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"KWCRH.KWCR_CBWG04A00SSE.F_CV:sample:PT2M\",\n    \"name\" : \"G4RT_C\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.CBWG04A00SSE.F_CV:rawByTime:PT2M\",\n    \"name\" : \"G4RT_P\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.CBWG005FIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"G5_G5A\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"KWCRH.KWCR_CBWG05A00SSE.F_CV:sample:PT2M\",\n    \"name\" : \"G5RT_C\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.CBWG05A00SSE.F_CV:rawByTime:PT2M\",\n    \"name\" : \"G5RT_P\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.CBWH004FIQ01.F_CV:rawByTime:PT2M\",\n    \"name\" : \"H4_H4A\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"KWCRH.KWCR_CBWH04A00SSE.F_CV:sample:PT2M\",\n    \"name\" : \"H4RT_C\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"MDPH.MDPSCDA.CBWH04A00SSE.F_CV:rawByTime:PT2M\",\n    \"name\" : \"H4RT_P\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MDPSCDA.CBWG004TT.F_CV\",\n    \"name\" : \"G4\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 2\n  }, {\n    \"value\" : \"ET.MDPSCDA.CBWG004ATT.F_CV\",\n    \"name\" : \"G4A\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 2\n  }, {\n    \"value\" : \"ET.MDPSCDA.CBWG005TT.F_CV\",\n    \"name\" : \"G5\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 2\n  }, {\n    \"value\" : \"ET.MDPSCDA.CBWG005ATT.F_CV\",\n    \"name\" : \"G5A\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 2\n  }, {\n    \"value\" : \"ET.MDPSCDA.CBWH004TT.F_CV\",\n    \"name\" : \"H4\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 2\n  }, {\n    \"value\" : \"ET.MDPSCDA.CBWH004ATT.F_CV\",\n    \"name\" : \"H4A\",\n    \"type\" : \"tag\",\n    \"description\" : \"\",\n    \"units\" : \"\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 2\n  } ],\n  \"code\" : [ {\n    \"value\" : \"BigDecimal total = null;\\nBigDecimal totalA = null;\\n//Define function\\ndef wellTotal(G4_G4A,G4RT_P,G4RT_C,G4,G4A){\\n    total = 0;\\n    totalA = 0;\\n    //put inputs into tag triplet\\n    TagInputTriplet triplet1 = new TagInputTriplet(G4_G4A, G4RT_P, G4RT_C, \\\"PT2M\\\");\\n    //loop through all tag data and add to total\\n    for(DataTriplet trip : triplet1.triplets){\\n        if(trip.a.good && null != trip.bValue){\\n            if(trip.bValue == zero.value){\\n                total += trip.aValue;\\n            }\\n            else if(trip.bValue == one.value){\\n                totalA += trip.aValue;\\n            }\\n        }\\n        else if(trip.a.good && null == trip.bValue && trip.c.good){\\n            if(trip.cValue == zero.value){\\n                total += trip.aValue;\\n            }\\n            else if(trip.cValue == one.value){\\n                totalA += trip.aValue;\\n            }\\n        }\\n    }\\n    G4.value = (total*120)/1000;\\n    G4A.value = (totalA*120)/1000;\\n}\\nwellTotal(G4_G4A,G4RT_P,G4RT_C,G4,G4A);\\nwellTotal(G5_G5A,G5RT_P,G5RT_C,G5,G5A);\\nwellTotal(H4_H4A,H4RT_P,H4RT_C,H4,H4A);\\n\",\n    \"version\" : 1,\n    \"start\" : \"2017-01-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",H4RT_C,G4_G4A,H4_H4A,G4RT_C,G5RT_P,G4RT_P,G5_G5A,G5RT_C,__results__,H4RT_P\",\n    \"outputs\" : \",G5A,H4A,G4A,H4,G4,G5\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"8a14be1d-c778-4aa4-b801-acfb0f801a81\",\n  \"owner\" : \"admin@eramosa.com\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"DIRECT\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"zero\",\n  \"description\" : \"used for runtime rule\",\n  \"units\" : \"\",\n  \"defaultValue\" : 0,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\n  \"value\" : [ ],\n  \"name\" : \"one\",\n  \"description\" : \"Used for runtime rule\",\n  \"units\" : \"\",\n  \"defaultValue\" : 1,\n  \"referenceOffset\" : \"\"\n}","type":"Constant","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPSCDA.CBWG004TT.F_CV\",\"name\":\"G4\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":2}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPSCDA.CBWG004ATT.F_CV\",\"name\":\"G4A\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":2}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPSCDA.CBWG005TT.F_CV\",\"name\":\"G5\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":2}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPSCDA.CBWG005ATT.F_CV\",\"name\":\"G5A\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":2}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPSCDA.CBWH004TT.F_CV\",\"name\":\"H4\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":2}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPSCDA.CBWH004ATT.F_CV\",\"name\":\"H4A\",\"type\":\"tag\",\"description\":\"\",\"units\":\"\",\"saveOffset\":\"P1D\",\"scale\":2}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Ayr Net Flow and Volume\",\n  \"description\" : \"Outputs Discharge minus Inlet plus Outlet\",\n  \"schedule\" : \"15 3 * * *\",\n  \"lastRunMessage\" : \"0dc8b4c2-d803-4a39-a5f5-3e0c71bf4ac7\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.APSTWL01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"Discharge\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.APSTWL01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.APSTWL01FI01QFL.F_CV:periodTotal:P1D\",\n    \"name\" : \"dischargeVol\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.APSTWL01FI01QFL.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.AYTETK01FI02QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"tankIn\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.AYTETK01FI02QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.AYTETK01FI02QFL.F_CV:periodTotal:P1D\",\n    \"name\" : \"tankInVol\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.AYTETK01FI02QFL.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.AYTETK01FI01QVA.F_CV:rawByTime:P1D\",\n    \"name\" : \"tankOut\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.AYTETK01FI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawByTime\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.AYTETK01FI01QFL.F_CV:periodTotal:P1D\",\n    \"name\" : \"tankOutVol\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.AYTETK01FI01QFL.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.MDPH.MDPSCDA.ATPT_NET_FLOW\",\n    \"name\" : \"netFlow\",\n    \"type\" : \"tag\",\n    \"description\" : \"Ayr Net Flow Rate: Discharge minus Inlet plus Outlet\",\n    \"units\" : \"L/s\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 6\n  }, {\n    \"value\" : \"ET.MDPH.MDPSCDA.ATPT_NET_VOLUME\",\n    \"name\" : \"netVol\",\n    \"type\" : \"tag\",\n    \"description\" : \"Ayr Net Volume: Discharge minus Inlet Plus Outlet\",\n    \"units\" : \"M^3\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 0\n  } ],\n  \"code\" : [ {\n    \"value\" : \"Discharge.fillGaps(\\\"PT1M\\\",0,0);\\r\\ntankIn.fillGaps(\\\"PT1M\\\",0,0);\\r\\ntankOut.fillGaps(\\\"PT1M\\\",0,0);\\r\\n\\r\\nTagInputTriplet triplet1 = new TagInputTriplet(Discharge, tankIn,tankOut, \\\"PT1M\\\");\\r\\nfor(DataTriplet trip: triplet1.triplets){\\r\\n    if(trip.good) {\\r\\n        trip.a.value = (trip.a.value- trip.b.value + trip.c.value);\\r\\n        netFlow.add(trip.a);\\r\\n        netFlow.add(new Data(trip.a.time, (trip.a.value - trip.b.value + trip.c.value), 100));\\r\\n    }\\r\\n}\\r\\nif(dischargeVol.value!=null && tankInVol.value!=null && tankOutVol!=null){\\r\\n    context.trace(\\\"Volume \\\" + dischargeVol.value + \\\" TankIn \\\" + tankInVol.value + \\\" TankOut \\\" + tankOutVol.value);\\r\\n    \\r\\n  netVol.value = dischargeVol.value - tankInVol.value + tankOutVol.value;\\r\\n}\\r\\n\",\n    \"version\" : 1,\n    \"start\" : \"2015-09-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",dischargeVol,tankIn,tankInVol,tankOutVol,tankOut,__results__,Discharge\",\n    \"outputs\" : \",netFlow,netVol\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"0dc8b4c2-d803-4a39-a5f5-3e0c71bf4ac7\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"SCHEDULED\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.MDPH.MDPSCDA.ATPT_NET_FLOW\",\"name\":\"netFlow\",\"type\":\"tag\",\"description\":\"Ayr Net Flow Rate: Discharge minus Inlet plus Outlet\",\"units\":\"L/s\",\"saveOffset\":\"P1D\",\"scale\":6}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.MDPH.MDPSCDA.ATPT_NET_VOLUME\",\"name\":\"netVol\",\"type\":\"tag\",\"description\":\"Ayr Net Volume: Discharge minus Inlet Plus Outlet\",\"units\":\"M^3\",\"saveOffset\":\"P1D\",\"scale\":0}","type":"OutputTag","base64":null,"dependencies":[]}]},{"item":"{\n  \"name\" : \"Ayr\",\n  \"description\" : \"Ayr Plant Produced/Consumed\",\n  \"schedule\" : \"0 2 * * *\",\n  \"lastRunMessage\" : \"1e4d790a-6451-47b1-bfc9-9e1d57401e38\",\n  \"constant\" : [ ],\n  \"outputRef\" : [ ],\n  \"input\" : [ {\n    \"value\" : \"WATH.MTPSVR2.APSTWR01LI01QVA.F_CV:rawAverage:P1D\",\n    \"name\" : \"inRes1Level\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.APSTWR01LI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawAverage\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.APSTWR02LI01QVA.F_CV:rawAverage:P1D\",\n    \"name\" : \"inRes2Level\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.APSTWR02LI01QVA.F_CV\\\",\\\"mode\\\":\\\"rawAverage\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"ET.AyrResLevel:average:P1D\",\n    \"name\" : \"inResAvgLevel\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P2D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : null\n  }, {\n    \"value\" : \"WATH.MTPSVR2.ATPW0001FI01QFL.F_CV:periodTotal:P1D\",\n    \"name\" : \"inWell1Volume\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.ATPW0001FI01QFL.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.ATPW0002FI01QFL.F_CV:periodTotal:P1D\",\n    \"name\" : \"inWell2Volume\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.ATPW0002FI01QFL.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  }, {\n    \"value\" : \"WATH.MTPSVR2.APSW0003FI01QFL.F_CV:periodTotal:P1D\",\n    \"name\" : \"inWell3Volume\",\n    \"type\" : \"tag\",\n    \"description\" : null,\n    \"startOffset\" : \"P1D\",\n    \"duration\" : \"P1D\",\n    \"useCache\" : false,\n    \"regex\" : false,\n    \"ruleSource\" : false,\n    \"metadata\" : \"{\\\"descriptors\\\":[],\\\"tag\\\":\\\"WATH.MTPSVR2.APSW0003FI01QFL.F_CV\\\",\\\"mode\\\":\\\"periodTotal\\\",\\\"interval\\\":\\\"P1D\\\"}\"\n  } ],\n  \"output\" : [ {\n    \"value\" : \"ET.AyrResLevel\",\n    \"name\" : \"outResLevel\",\n    \"type\" : \"tag\",\n    \"description\" : \"Ayr Reservoir Level (Average)\",\n    \"units\" : \"%\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.AyrResLevelDifference\",\n    \"name\" : \"outResLevelDiff\",\n    \"type\" : \"tag\",\n    \"description\" : \"Reservoir Level Difference\",\n    \"units\" : \"%\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  }, {\n    \"value\" : \"ET.AyrResVolume\",\n    \"name\" : \"outResVolume\",\n    \"type\" : \"tag\",\n    \"description\" : \"Ayr Reservoir Volume\",\n    \"units\" : \"m3\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 0\n  }, {\n    \"value\" : \"ET.AyrInletVolume\",\n    \"name\" : \"outWellVolume\",\n    \"type\" : \"tag\",\n    \"description\" : \"Ayr Total Well Inlet Volume\",\n    \"units\" : \"m3\",\n    \"saveOffset\" : \"P1D\",\n    \"scale\" : 4\n  } ],\n  \"code\" : [ {\n    \"value\" : \"if (inRes1Level.value !=null && inRes1Level.quality == 100 && inRes2Level.value !=null && inRes2Level.quality == 100){\\n    outResLevel = ((inRes1Level.value + inRes2Level.value)/2);\\n}\\n\",\n    \"version\" : 1,\n    \"start\" : \"2017-03-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",inRes2Level,inRes1Level\",\n    \"outputs\" : \",outResLevel\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : false,\n    \"enabled\" : false\n  }, {\n    \"value\" : \"BigDecimal todayAvg = 0;\\n//Reservoir Level Calculation, to add levels together and obtain average.  \\nif (null != inRes1Level.value && 100 == inRes1Level.quality && null != inRes2Level.value && 100 == inRes2Level.quality){\\n    todayAvg = ((inRes1Level.value + inRes2Level.value)/2);\\n    outResLevel.value = todayAvg;\\n    context.trace(\\\"Today avg : \\\"+todayAvg);\\n}\\n//Variable Declaration\\nBigDecimal levelDiff = 0;\\nif (null != inResAvgLevel.value && null != todayAvg){\\n    //Check last level for value\\n    levelDiff = inResAvgLevel.value - todayAvg;\\n    context.trace(\\\"Level Diff : \\\" + levelDiff);\\n    outResLevelDiff.value = levelDiff;\\n}\\nelse {\\n    outResLevelDiff.value = 100;\\n}\\n\",\n    \"version\" : 2,\n    \"start\" : \"2017-03-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",inWell2Volume,inResAvgLevel,inRes2Level,inRes1Level,inWell3Volume,inWell1Volume\",\n    \"outputs\" : \",outResLevelDiff,outResLevel\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"BigDecimal todayAvg = 0;\\n//Reservoir Level Calculation, to add levels together and obtain average.  \\nif (null != inRes1Level.value && 100 == inRes1Level.quality && null != inRes2Level.value && 100 == inRes2Level.quality){\\n    todayAvg = ((inRes1Level.value + inRes2Level.value)/2);\\n    outResLevel.value = todayAvg;\\n    context.trace(\\\"Today avg : \\\"+todayAvg);\\n}\\n//Calclation of level difference using previous day average subtracted from current day average\\n//Variable Declaration\\nBigDecimal levelDiff = 0;\\nif (null != inResAvgLevel.value && null != todayAvg){\\n    //Check last level for value\\n    levelDiff = inResAvgLevel.value - todayAvg;\\n    context.trace(\\\"Level Diff : \\\" + levelDiff);\\n    outResLevelDiff.value = levelDiff;\\n}\\nelse {\\n    context.trace(\\\"No output\\\");\\n}\\nBigDecimal inWellVolume = 0;\\n//Well Volume addition\\nif (null !=inWell1Volume.value && 100 == inWell1Volume.quality && null !=inWell2Volume.value && 100 == inWell2Volume.quality && \\n    null !=inWell3Volume.value && 100 == inWell3Volume.quality){\\n    inWellVolume = (inWell1Volume.value + inWell2Volume.value + inWell3Volume.value);\\n    outWellVolume.value = inWellVolume;\\n}\\n\",\n    \"version\" : 3,\n    \"start\" : \"2017-03-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",inWell2Volume,inResAvgLevel,inRes2Level,inRes1Level,inWell3Volume,inWell1Volume\",\n    \"outputs\" : \"outWellVolume,,outResLevelDiff,outResLevel\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  }, {\n    \"value\" : \"BigDecimal todayAvg = 0;\\r\\nBigDecimal todayVol = 0;\\r\\n//Reservoir Level Calculation, to add levels together and obtain average.  \\r\\nif (null != inRes1Level.value && 100 == inRes1Level.quality && null != inRes2Level.value && 100 == inRes2Level.quality){\\r\\n    todayAvg = ((inRes1Level.value + inRes2Level.value)/2);\\r\\n    todayVol = ((todayAvg/100) * 2500);\\r\\n    outResLevel.value = todayAvg;\\r\\n    context.trace(\\\"Today avg : \\\"+todayAvg);\\r\\n    outResVolume.value = todayVol;\\r\\n    context.trace(\\\"Today Volume : \\\"+todayVol);\\r\\n}\\r\\n//Calclation of level difference using previous day average subtracted from current day average\\r\\n//Variable Declaration\\r\\nBigDecimal levelDiff = 0;\\r\\nif (null != inResAvgLevel.value && null != todayAvg){\\r\\n    //Check last level for value\\r\\n    levelDiff = inResAvgLevel.value - todayAvg;\\r\\n    context.trace(\\\"Level Diff : \\\" + levelDiff);\\r\\n    outResLevelDiff.value = levelDiff;\\r\\n}\\r\\nelse {\\r\\n    context.trace(\\\"No output\\\");\\r\\n}\\r\\nBigDecimal inWellVolume = 0;\\r\\n//Well Volume addition\\r\\nif (null !=inWell1Volume.value && 100 == inWell1Volume.quality && null !=inWell2Volume.value && 100 == inWell2Volume.quality && \\r\\n    null !=inWell3Volume.value && 100 == inWell3Volume.quality){\\r\\n    inWellVolume = (inWell1Volume.value + inWell2Volume.value + inWell3Volume.value);\\r\\n    outWellVolume.value = inWellVolume;\\r\\n}\\r\\n\",\n    \"version\" : 4,\n    \"start\" : \"2017-03-01T00:00:00.000\",\n    \"end\" : null,\n    \"inputs\" : \",inWell2Volume,inResAvgLevel,inRes2Level,inRes1Level,inWell3Volume,inWell1Volume,__results__\",\n    \"outputs\" : \",outWellVolume,outResLevelDiff,outResLevel,outResVolume\",\n    \"language\" : \"mvel\",\n    \"activated\" : false,\n    \"verified\" : true,\n    \"enabled\" : true\n  } ],\n  \"mapping\" : [ ],\n  \"id\" : \"1e4d790a-6451-47b1-bfc9-9e1d57401e38\",\n  \"owner\" : \"aramzie\",\n  \"jsEngine\" : \"GRAAL\",\n  \"workerTimeLimit\" : \"PT1H\",\n  \"lastRun\" : \"2026-01-29T16:18:00.000\",\n  \"enabled\" : true,\n  \"type\" : \"DIRECT\"\n}","type":"Calculation","base64":null,"dependencies":[{"item":"{\"value\":\"ET.AyrResLevel\",\"name\":\"outResLevel\",\"type\":\"tag\",\"description\":\"Ayr Reservoir Level (Average)\",\"units\":\"%\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.AyrResLevelDifference\",\"name\":\"outResLevelDiff\",\"type\":\"tag\",\"description\":\"Reservoir Level Difference\",\"units\":\"%\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.AyrResVolume\",\"name\":\"outResVolume\",\"type\":\"tag\",\"description\":\"Ayr Reservoir Volume\",\"units\":\"m3\",\"saveOffset\":\"P1D\",\"scale\":0}","type":"OutputTag","base64":null,"dependencies":[]},{"item":"{\"value\":\"ET.AyrInletVolume\",\"name\":\"outWellVolume\",\"type\":\"tag\",\"description\":\"Ayr Total Well Inlet Volume\",\"units\":\"m3\",\"saveOffset\":\"P1D\",\"scale\":4}","type":"OutputTag","base64":null,"dependencies":[]}]}]